"use strict";function _get(e,t,a){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(a):i.value}})(e,t,a||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var GlobalParams={video:{zIndex:1},background:{zIndex:0}};function paella_DeferredResolved(e){return new Promise(function(t){t(e)})}function paella_DeferredRejected(e){return new Promise(function(t,a){a(e)})}function paella_DeferredNotImplemented(){return paella_DeferredRejected(new Error("not implemented"))}function DeprecatedClass(e,t,a){Class(e,a,{initialize:function(){base.log.warning(e+" is deprecated, use "+t+" instead."),this.parent.apply(this,arguments)}})}function DeprecatedFunc(e,t,a){return function(){base.log.warning(e+" is deprecated, use "+t+" instead."),a.apply(this,arguments)}}window.paella=window.paella||{},paella.player=null,paella.version="6.1.0 - build: fe29d54",function(){if(window.paella_debug_baseUrl)paella.baseUrl=window.paella_debug_baseUrl;else{var e=document.getElementsByTagName("script"),t=e[e.length-1].src.split("/");t.pop(),t.pop(),paella.baseUrl=t.join("/")+"/"}}(),paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToTime:"paella:seektotime",setTrim:"paella:settrim",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidHide:"paella:controlbardidhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",enterFullscreen:"paella:enterFullscreen",exitFullscreen:"paella:exitFullscreen",resize:"paella:resize",videoZoomChanged:"paella:videoZoomChanged",audioTagChanged:"paella:audiotagchanged",zoomAvailabilityChanged:"paella:zoomavailabilitychanged",qualityChanged:"paella:qualityChanged",singleVideoReady:"paella:singleVideoReady",singleVideoUnloaded:"paella:singleVideoUnloaded",videoReady:"paella:videoReady",videoUnloaded:"paella:videoUnloaded",controlBarLoaded:"paella:controlBarLoaded",flashVideoEvent:"paella:flashVideoEvent",captionAdded:"paella:caption:add",captionsEnabled:"paella:caption:enabled",captionsDisabled:"paella:caption:disabled",profileListChanged:"paella:profilelistchanged",setProfile:"paella:setprofile",seekAvailabilityChanged:"paella:seekAvailabilityChanged",trigger:function(e,t){$(document).trigger(e,t)},bind:function(e,t){$(document).bind(e,function(e,a){t(e,a)})},setupExternalListener:function(){window.addEventListener("message",function(e){e.data&&e.data.event&&paella.events.trigger(e.data.event,e.data.params)},!1)}},paella.events.setupExternalListener(),function(){var e=function(){function e(){var t=this;_classCallCheck(this,e),paella.events.bind("mouseup",function(e){return t.up(e)}),paella.events.bind("mousemove",function(e){return t.move(e)}),paella.events.bind("mouseover",function(e){return t.over(e)})}return _createClass(e,[{key:"targetObject",get:function(){return this._targetObject},set:function(e){this._targetObject=e}}]),_createClass(e,[{key:"down",value:function(e,t){return this.targetObject=e,this.targetObject&&this.targetObject.down&&(this.targetObject.down(t,t.pageX,t.pageY),t.cancelBubble=!0),!1}},{key:"up",value:function(e){return this.targetObject&&this.targetObject.up&&(this.targetObject.up(e,e.pageX,e.pageY),e.cancelBubble=!0),this.targetObject=null,!1}},{key:"out",value:function(e){return this.targetObject&&this.targetObject.out&&(this.targetObject.out(e,e.pageX,e.pageY),e.cancelBubble=!0),!1}},{key:"move",value:function(e){return this.targetObject&&this.targetObject.move&&(this.targetObject.move(e,e.pageX,e.pageY),e.cancelBubble=!0),!1}},{key:"over",value:function(e){return this.targetObject&&this.targetObject.over&&(this.targetObject.over(e,e.pageX,e.pageY),e.cancelBubble=!0),!1}}]),e}();paella.MouseManager=e}(),function(){var e=document.createElement("link");e.rel="stylesheet",e.href=paella.baseUrl+"resources/bootstrap/css/bootstrap.min.css",e.type="text/css",e.media="screen",e.charset="utf-8",document.head.appendChild(e)}(),paella.utils={mouseManager:new paella.MouseManager,folders:{get:function(e){if(paella.player&&paella.player.config&&paella.player.config.folders&&paella.player.config.folders[e])return paella.player.config.folders[e]},profiles:function(){return paella.baseUrl+(paella.utils.folders.get("profiles")||"config/profiles")},resources:function(){return paella.baseUrl+(paella.utils.folders.get("resources")||"resources")},skins:function(){return paella.baseUrl+(paella.utils.folders.get("skins")||paella.utils.folders.get("resources")+"/style")}},styleSheet:{removeById:function(e){var t=$(document.head).find("#"+e)[0];t&&document.head.removeChild(t)},remove:function(e){for(var t=document.head.getElementsByTagName("link"),a=0;a<t.length;++a)if(t[a].href){document.head.removeChild(t[a]);break}},add:function(e,t){var a=document.createElement("link");a.rel="stylesheet",a.href=e,a.type="text/css",a.media="screen",a.charset="utf-8",t&&(a.id=t),document.head.appendChild(a)},swap:function(e,t){this.remove(e),this.add(t)}},skin:{set:function(e){paella.utils.styleSheet.removeById("paellaSkin"),paella.utils.styleSheet.add(paella.utils.folders.skins()+"/style_"+e+".css"),base.cookies.set("skin",e)},restore:function(e){var t=base.cookies.get("skin");t&&""!=t?this.set(t):this.set(e)}},timeParse:{timeToSeconds:function(e){var t=0,a=0,n=0;return/([0-9]+)h/i.test(e)&&(t=60*parseInt(RegExp.$1)*60),/([0-9]+)m/i.test(e)&&(a=60*parseInt(RegExp.$1)),/([0-9]+)s/i.test(e)&&(n=parseInt(RegExp.$1)),t+a+n},secondsToTime:function(e){var t=~~(e/3600);t<10&&(t="0"+t);var a=~~(e%3600/60);a<10&&(a="0"+a);var n=Math.floor(e%60);return n<10&&(n="0"+n),t+":"+a+":"+n},secondsToText:function(e){if(e<=1)return base.dictionary.translate("1 second ago");if(e<60)return base.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,e);var t=Math.round(e/60);if(t<=1)return base.dictionary.translate("1 minute ago");if(t<60)return base.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,t);var a=Math.round(e/3600);if(a<=1)return base.dictionary.translate("1 hour ago");if(a<24)return base.dictionary.translate("{0} hours ago").replace(/\{0\}/g,a);var n=Math.round(e/86400);if(n<=1)return base.dictionary.translate("1 day ago");if(n<24)return base.dictionary.translate("{0} days ago").replace(/\{0\}/g,n);var i=Math.round(e/2592e3);if(i<=1)return base.dictionary.translate("1 month ago");if(i<12)return base.dictionary.translate("{0} months ago").replace(/\{0\}/g,i);var r=Math.round(e/31536e3);return r<=1?base.dictionary.translate("1 year ago"):base.dictionary.translate("{0} years ago").replace(/\{0\}/g,r)},matterhornTextDateToDate:function(e){var t=new Date;return t.setFullYear(parseInt(e.substring(0,4),10)),t.setMonth(parseInt(e.substring(5,7),10)-1),t.setDate(parseInt(e.substring(8,10),10)),t.setHours(parseInt(e.substring(11,13),10)),t.setMinutes(parseInt(e.substring(14,16),10)),t.setSeconds(parseInt(e.substring(17,19),10)),t}},objectFromString:function(e){for(var t=e.split("."),a=window||this,n=0,i=t.length;n<i;n++)a=a[t[n]];if("function"!=typeof a)throw new Error("constructor not found");return a}},function(){var e={},t=[],a=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"read",value:function(e,t,a){"function"==typeof a&&a({},!0)}},{key:"write",value:function(e,t,a,n){"function"==typeof n&&n({},!0)}},{key:"remove",value:function(e,t,a){"function"==typeof a&&a({},!0)}}]),e}();paella.DataDelegate=a,paella.dataDelegates={};var n=function(){function a(n){_classCallCheck(this,a),this._enabled=n.data.enabled;var i=[],r=function(t){var a=e[t],r=null,o=null;i.some(function(e){if(e.callback==a)return o=e.delegateName,!0})||(r=e[t](),o=r.name,paella.dataDelegates[o]=r,i.push({callback:a,delegateName:o})),n.data.dataDelegates[t]||(n.data.dataDelegates[t]=o)};for(var o in e)r(o);for(var l in n.data.dataDelegates)try{var s=n.data.dataDelegates[l],u=new(0,paella.dataDelegates[s]);t[l]=u}catch(e){console.warn("Warning: delegate not found - "+s)}this.dataDelegates.default||(this.dataDelegates.default=new paella.dataDelegates.DefaultDataDelegate)}return _createClass(a,[{key:"enabled",get:function(){return this._enabled}},{key:"dataDelegates",get:function(){return t}}]),_createClass(a,[{key:"read",value:function(e,t,a){this.getDelegate(e).read(e,t,a)}},{key:"write",value:function(e,t,a,n){this.getDelegate(e).write(e,t,a,n)}},{key:"remove",value:function(e,t,a){this.getDelegate(e).remove(e,t,a)}},{key:"getDelegate",value:function(e){return this.dataDelegates[e]?this.dataDelegates[e]:this.dataDelegates.default}}]),a}();paella.Data=n,paella.addDataDelegate=function(t,a){Array.isArray(t)?t.forEach(function(t){e[t]=a}):"string"==typeof t&&(e[t]=a)}}(),paella.addDataDelegate(["default","trimming"],function(){return paella.dataDelegates.DefaultDataDelegate=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.DataDelegate),_createClass(t,[{key:"serializeKey",value:function(e,t){return"object"==_typeof(t)&&(t=JSON.stringify(t)),e+"|"+t}},{key:"read",value:function(e,t,a){var n=this.serializeKey(e,t),i=base.cookies.get(n);try{i=unescape(i),i=JSON.parse(i)}catch(e){}"function"==typeof a&&a(i,!0)}},{key:"write",value:function(e,t,a,n){var i=this.serializeKey(e,t);"object"==_typeof(a)&&(a=JSON.stringify(a)),a=escape(a),base.cookies.set(i,a),"function"==typeof n&&n({},!0)}},{key:"remove",value:function(e,t,a){var n=this.serializeKey(e,t);"object"==("undefined"==typeof value?"undefined":_typeof(value))&&(value=JSON.stringify(value)),base.cookies.set(n,""),"function"==typeof a&&a({},!0)}}]),t}(),paella.dataDelegates.DefaultDataDelegate}),paella.data=null,function(){var e={};paella.require=function(t){return e[t]||(e[t]=new Promise(function(e,a){var n=document.createElement("script");"js"==t.split(".").pop()?(n.src=t,n.async=!1,document.head.appendChild(n),setTimeout(function(){return e()},100)):a(new Error("Unexpected file type"))})),e[t]};var t=function(){function e(){var t=this;_classCallCheck(this,e),this._messageContainer=null,$(window).resize(function(e){return t.adjustTop()})}return _createClass(e,[{key:"modalContainerClassName",get:function(){return"modalMessageContainer"}},{key:"frameClassName",get:function(){return"frameContainer"}},{key:"messageClassName",get:function(){return"messageContainer"}},{key:"errorClassName",get:function(){return"errorContainer"}},{key:"currentMessageBox",get:function(){return this._currentMessageBox},set:function(e){this._currentMessageBox=e}},{key:"messageContainer",get:function(){return this._messageContainer}},{key:"onClose",get:function(){return this._onClose},set:function(e){this._onClose=e}}]),_createClass(e,[{key:"showFrame",value:function(e,t){var a=!0,n=null;t&&(a=t.closeButton,n=t.onClose),this.doShowFrame(e,a,n)}},{key:"doShowFrame",value:function(e,t,a){this.onClose=a,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close();var n=document.createElement("div");n.className=this.modalContainerClassName,n.style.position="fixed",n.style.top="0px",n.style.left="0px",n.style.right="0px",n.style.bottom="0px",n.style.zIndex=999999;var i=document.createElement("div");i.className=this.frameClassName,n.appendChild(i);var r=document.createElement("iframe");r.src=e,r.setAttribute("frameborder","0"),r.style.width="100%",r.style.height="100%",i.appendChild(r),paella.player&&paella.player.isFullScreen()?paella.player.mainContainer.appendChild(n):$("body")[0].appendChild(n),this.currentMessageBox=n,this._messageContainer=i,this.adjustTop(),t&&this.createCloseButton()}},{key:"showElement",value:function(e,t){var a=!0,n=null,i=this.messageClassName;t&&(i=t.className,a=t.closeButton,n=t.onClose),this.doShowElement(e,a,i,n)}},{key:"showMessage",value:function(e,t){var a=!0,n=null,i=this.messageClassName;t&&(i=t.className,a=t.closeButton,n=t.onClose),this.doShowMessage(e,a,i,n)}},{key:"doShowElement",value:function(e,t,a,n){this.onClose=n,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),a||(a=this.messageClassName);var i=document.createElement("div");i.className=this.modalContainerClassName,i.style.position="fixed",i.style.top="0px",i.style.left="0px",i.style.right="0px",i.style.bottom="0px",i.style.zIndex=999999;var r=document.createElement("div");r.className=a,r.appendChild(e),i.appendChild(r),$("body")[0].appendChild(i),this.currentMessageBox=i,this._messageContainer=r,this.adjustTop(),t&&this.createCloseButton()}},{key:"doShowMessage",value:function(e,t,a,n){this.onClose=n,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),a||(a=this.messageClassName);var i=document.createElement("div");i.className=this.modalContainerClassName,i.style.position="fixed",i.style.top="0px",i.style.left="0px",i.style.right="0px",i.style.bottom="0px",i.style.zIndex=999999;var r=document.createElement("div");r.className=a,r.innerHTML=e,i.appendChild(r),paella.player&&paella.player.isFullScreen()?paella.player.mainContainer.appendChild(i):$("body")[0].appendChild(i),this.currentMessageBox=i,this._messageContainer=r,this.adjustTop(),t&&this.createCloseButton()}},{key:"showError",value:function(e,t){var a=!1,n=null;t&&(a=t.closeButton,n=t.onClose),this.doShowError(e,a,n)}},{key:"doShowError",value:function(e,t,a){this.doShowMessage(e,t,this.errorClassName,a)}},{key:"createCloseButton",value:function(){var e=this;if(this._messageContainer){var t=document.createElement("span");this._messageContainer.appendChild(t),t.className="paella_messageContainer_closeButton icon-cancel-circle",$(t).click(function(t){return e.onCloseButtonClick()}),$(window).keyup(function(t){27==t.keyCode&&e.onCloseButtonClick()})}}},{key:"adjustTop",value:function(){if(this.currentMessageBox){var e=$(this._messageContainer).outerHeight(),t=$(this.currentMessageBox).height()/2-e/2;this._messageContainer.style.marginTop=t+"px"}}},{key:"close",value:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var e=this.currentMessageBox,t=e.parentNode;$("#playerContainer").removeClass("modalVisible"),$(e).animate({opacity:0},300,function(){t.removeChild(e)}),this.onClose&&this.onClose()}}},{key:"onCloseButtonClick",value:function(){this.close()}}]),e}();paella.MessageBox=t,paella.messageBox=new paella.MessageBox}(),paella.AntiXSS={htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(e){return String(e).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}},function(){var e=function(){function e(t){_classCallCheck(this,e),this._nodeList={},this.identifier=t}return _createClass(e,[{key:"identifier",get:function(){return this._identifier},set:function(e){this._identifier=e}},{key:"nodeList",get:function(){return this._nodeList}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e}}]),_createClass(e,[{key:"addTo",value:function(e){e.addNode(this)}},{key:"addNode",value:function(e){return e.parent=this,this.nodeList[e.identifier]=e,e}},{key:"getNode",value:function(e){return this.nodeList[e]}},{key:"removeNode",value:function(e){return!!this.nodeList[e.identifier]&&(delete this.nodeList[e.identifier],!0)}}]),e}();paella.Node=e;var t=function(e){function t(e,a,n){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,a)))._domElement=document.createElement(e),i.domElement.id=a,n&&(i.style=n),i}return _inherits(t,paella.Node),_createClass(t,[{key:"domElement",get:function(){return this._domElement}}]),_createClass(t,[{key:"addNode",value:function(e){var a=_get(_getPrototypeOf(t.prototype),"addNode",this).call(this,e);return this.domElement.appendChild(e.domElement),a}},{key:"onresize",value:function(){}},{key:"removeNode",value:function(e){_get(_getPrototypeOf(t.prototype),"removeNode",this).call(this,e)&&this.domElement.removeChild(e.domElement)}},{key:"style",set:function(e){$(this.domElement).css(e)}}]),t}();paella.DomNode=t;var a=function(e){function t(e,a,n,i){var r;_classCallCheck(this,t);return(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,{}))).isToggle=i,r.domElement.className=a,i&&$(r.domElement).click(function(e){r.toggleIcon()}),$(r.domElement).click("click",n),r}return _inherits(t,paella.DomNode),_createClass(t,[{key:"isToggle",get:function(){return this._isToggle},set:function(e){this._isToggle=e}}]),_createClass(t,[{key:"isToggled",value:function(){if(this.isToggle){var e=this.domElement;return/([a-zA-Z0-9_]+)_active/.test(e.className)}return!1}},{key:"toggle",value:function(){this.toggleIcon()}},{key:"toggleIcon",value:function(){var e=this.domElement;/([a-zA-Z0-9_]+)_active/.test(e.className)?e.className=RegExp.$1:e.className=e.className+"_active"}},{key:"show",value:function(){$(this.domElement).show()}},{key:"hide",value:function(){$(this.domElement).hide()}},{key:"visible",value:function(){return this.domElement.visible()}}]),t}();paella.Button=a}(),function(){var e=[],t=null;function a(){var e=this.container.getNode("videoContainerBackground");e&&this.container.removeNode(e)}function n(){var e=this;this.buttons&&(this.buttons.forEach(function(t){e.container.removeNode(e.container.getNode(t.id))}),this.buttons=null)}function i(e,t){var i=this;if(null==t&&(t=!0),e){var r=function(e,a,n,r){var o,l,s,u,c,d,p,h,v=i.profileFrameStrategy;if(v){var f=(o=e,l=a.res,s=10,u=/([0-9\.]+)\/([0-9\.]+)/,c=o.rect[0],d=0==l.h?1.777777:l.w/l.h,p=1,h=!1,o.rect.forEach(function(e){(h=u.exec(e.aspectRatio))&&(p=Number(h[1])/Number(h[2]));var t=Math.abs(p-d);s>t&&(s=t,c=e)}),c),m=a.res,g={width:$(i.domElement).width(),height:$(i.domElement).height()},y=f.width/g.width,_={width:m.w*y,height:m.h*y};f.left=Number(f.left),f.top=Number(f.top),f.width=Number(f.width),f.height=Number(f.height),f=v.adaptFrame(_,f);var b=/true/i.test(e.visible);f.visible=b;var k=parseInt(e.layer);n.domElement.style.zIndex=k,n.setRect(f,t),n.setVisible(b,t);var C=paella.player.videoContainer.streamProvider.mainAudioPlayer==r;b?r.enable(C):r.disable(C)}};if(e&&e.onApply(),function(){if(null!=this.logos)for(var e=0;e<this.logos.length;++e){var t=this.logos[e].content.replace(/\./gi,"-"),a=this.container.getNode(t);$(a.domElement).hide()}}.apply(this),e&&function(e){this.logos=e;for(var t=new paella.RelativeVideoSize,a=0;a<e.length;++a){var n=e[a],i=n.content.replace(/\./gi,"-"),r=this.container.getNode(i),o=n.rect;r?$(r.domElement).show():(l={},(r=this.container.addNode(new paella.DomNode("img",i,l))).domElement.setAttribute("src","".concat(paella.utils.folders.get("resources"),"/style/").concat(n.content)));var l={top:Number(t.percentVSize(o.top))+"%",left:Number(t.percentWSize(o.left))+"%",width:Number(t.percentWSize(o.width))+"%",height:Number(t.percentVSize(o.height))+"%",position:"absolute",zIndex:n.zIndex};$(r.domElement).css(l)}}.apply(this,[e.logos]),a.apply(this),e&&function(e){if(e){a.apply(this),this.backgroundData=e;var t={backgroundImage:"url(".concat(paella.utils.folders.get("resources"),"/style/").concat(e.content,")"),backgroundSize:"100% 100%",zIndex:e.layer,position:"absolute",left:e.rect.left+"px",right:e.rect.right+"px",width:"100%",height:"100%"};this.container.addNode(new paella.DomNode("div","videoContainerBackground",t))}}.apply(this,[e.background]),n.apply(this),e&&function(e,t){var a=this;if(n.apply(this),e){var i=new paella.RelativeVideoSize;this.buttons=e,e.forEach(function(e,n){e.id="button_"+n;var r=e.rect,o=i.percentVSize(r.top)+"%",l=i.percentWSize(r.left)+"%",s=i.percentWSize(r.width)+"%",u=i.percentVSize(r.height)+"%",c=paella.baseUrl;c=c.replace(/\\/gi,"/");var d={top:o,left:l,width:s,height:u,position:"absolute",zIndex:e.layer,backgroundImage:"url(".concat(paella.utils.folders.get("resources"),"/style/").concat(e.icon,")"),backgroundSize:"100% 100%",display:"block"},p=a.container.addNode(new paella.DomNode("div",e.id,d));p.domElement.className="paella-profile-button",p.domElement.data={action:e.onClick,profileData:t},$(p.domElement).click(function(e){return this.data.action.apply(this.data.profileData,[e]),e.stopPropagation(),!1})})}}.apply(this,[e.buttons,e]),1==this.streamProvider.videoStreams.length){var o=paella.profiles.loadMonostreamProfile();o=o&&o.videos&&o.videos.length>0&&o.videos[0];var l=this.streamProvider.videoPlayers[0],s=this.videoWrappers[0];o&&l.getVideoData().then(function(e){r(o,e,s,l)})}else this.streamProvider.videoStreams.forEach(function(a,n){var o,l,s=(o=a.content,l=null,e&&e.videos.some(function(e){return e.content==o&&(l=e),null!=l}),l),u=i.streamProvider.videoPlayers[n],c=i.videoWrappers[n];s?u.getVideoData().then(function(e){r(s,e,c,u)}):c&&(c.setVisible(!1,t),paella.player.videoContainer.streamProvider.mainAudioPlayer!=u&&u.disable())})}}paella.addProfile=function(t){t().then(function(t){t&&(e.push(t),"function"!=typeof t.onApply&&(t.onApply=function(){}),"function"!=typeof t.onDeactivte&&(t.onDeactivate=function(){}),paella.events.trigger(paella.events.profileListChanged,{profileData:t}))})},paella.setMonostreamProfile=function(e){e().then(function(e){"function"!=typeof e.onApply&&(e.onApply=function(){}),"function"!=typeof e.onDeactivte&&(e.onDeactivate=function(){}),t=e})};var r=function(){function a(){var e=this;_classCallCheck(this,a),paella.events.bind(paella.events.controlBarDidHide,function(){return e.hideButtons()}),paella.events.bind(paella.events.controlBarDidShow,function(){return e.showButtons()}),paella.events.bind(paella.events.profileListChanged,function(){!paella.player||!paella.player.videoContainer||e.currentProfile&&e.currentProfileName==e.currentProfile.id||e.setProfile(e.currentProfileName,!1)})}return _createClass(a,[{key:"getDefaultProfile",value:function(){return paella.player.videoContainer.masterVideo()&&paella.player.videoContainer.masterVideo().defaultProfile()?paella.player.videoContainer.masterVideo().defaultProfile():paella.player&&paella.player.config&&paella.player.config.defaultProfile?paella.player.config.defaultProfile:void 0}},{key:"loadProfile",value:function(t){var a=null;return e.some(function(e){return e.id==t&&(a=e),a}),a}},{key:"loadMonostreamProfile",value:function(){return t}},{key:"setProfile",value:function(t,a){var n=this;if(!t)return!1;if(a=!base.userAgent.browser.Explorer&&a,this.currentProfile&&this.currentProfile.onDeactivate(),paella.player.videoContainer.ready){if(1==paella.player.videoContainer.streamProvider.videoStreams.length){var r=this.loadMonostreamProfile();return this._currentProfileName=t,i.apply(paella.player.videoContainer,[r,a]),!0}var o=this.loadProfile(t)||e.length>0&&e[0];return o||0!=e.length?(this._currentProfileName=t,i.apply(paella.player.videoContainer,[o,a]),!0):(setTimeout(function(){n.setProfile(t,a)},100),!1)}return!1}},{key:"getProfile",value:function(e){var t=null;return this.profileList.some(function(a){if(a.id==e)return t=a,!0}),t}},{key:"placeVideos",value:function(){this.setProfile(this._currentProfileName,!1)}},{key:"hideButtons",value:function(){$(".paella-profile-button").hide()}},{key:"showButtons",value:function(){$(".paella-profile-button").show()}},{key:"profileList",get:function(){return e}},{key:"currentProfile",get:function(){return this.getProfile(this._currentProfileName)}},{key:"currentProfileName",get:function(){return this._currentProfileName}}]),a}();paella.profiles=new r}(),function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getParams",value:function(){return paella.player.config.player.videoQualityStrategyParams||{}}},{key:"getQualityIndex",value:function(e){return e.length>0?e[e.length-1]:e}}],[{key:"Factory",value:function(){var e=paella.player.config;try{var t=e.player.videoQualityStrategy,a=new(paella.utils.objectFromString(t));if(a instanceof paella.VideoQualityStrategy)return a}catch(e){}return null}}]),e}();paella.VideoQualityStrategy=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoQualityStrategy),_createClass(t,[{key:"getQualityIndex",value:function(e){var t=e.length-1;if(e.length>0){var a=e[0],n=$(window).width()*$(window).height();if(a.res&&a.res.w&&a.res.h)for(var i=parseInt(a.res.w)*parseInt(a.res.h),r=Math.abs(n-i),o=0;o<e.length;++o){if(e[o].res){var l=parseInt(e[o].res.w)*parseInt(e[o].res.h),s=Math.abs(n-l);s<=r&&(r=s,t=o)}}}return t}}]),t}();paella.BestFitVideoQualityStrategy=t;var a=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoQualityStrategy),_createClass(t,[{key:"getQualityIndex",value:function(e){var t=e.length-1,a=this.getParams();if(e.length>0){var n=$(window).height(),i=a.maxAutoQualityRes||720,r=Number.MAX_VALUE;e.forEach(function(e,a){e.res&&e.res.h<=i&&(Math.abs(n-e.res.h)<r&&(e,t=a))})}return t}}]),t}();paella.LimitedBestFitVideoQualityStrategy=a;var n=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isStreamCompatible",value:function(e){return!1}},{key:"getVideoObject",value:function(e,t,a){return null}}]),e}();paella.VideoFactory=n,paella.videoFactories=paella.videoFactories||{},paella.videoFactory={_factoryList:[],initFactories:function(){if(paella.videoFactories){var e=this;paella.player.config.player.methods.forEach(function(t){t.enabled&&paella.videoFactories[t.factory]&&e.registerFactory(new paella.videoFactories[t.factory])}),this.registerFactory(new paella.videoFactories.EmptyVideoFactory)}},getVideoObject:function(e,t,a){0==this._factoryList.length&&this.initFactories();var n=null;return this._factoryList.some(function(e){if(e.isStreamCompatible(t))return n=e,!0})?n.getVideoObject(e,t,a):null},registerFactory:function(e){this._factoryList.push(e)}}}(),function(){var e=function(e){function t(e,a){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e)))._stream=a,n}return _inherits(t,paella.DomNode),_createClass(t,[{key:"setAutoplay",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"load",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"play",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"pause",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"isPaused",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"duration",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"setCurrentTime",value:function(e){return Promise.reject(new Error("no such compatible video player"))}},{key:"currentTime",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"setVolume",value:function(e){return Promise.reject(new Error("no such compatible video player"))}},{key:"volume",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"setPlaybackRate",value:function(e){return Promise.reject(new Error("no such compatible video player"))}},{key:"playbackRate",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"unload",value:function(){return Promise.reject(new Error("no such compatible video player"))}},{key:"getQualities",value:function(){return Promise.resolve([{index:0,res:{w:0,h:1},src:"",toString:function(){return""},shortLabel:function(){return""},compare:function(){return 0}}])}},{key:"getCurrentQuality",value:function(){return Promise.resolve(0)}},{key:"defaultProfile",value:function(){return null}},{key:"supportAutoplay",value:function(){return!1}},{key:"stream",get:function(){return this._stream}}]),t}();paella.AudioElementBase=e,paella.audioFactories={};var t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isStreamCompatible",value:function(e){return!1}},{key:"getAudioObject",value:function(e,t){return null}}]),e}();paella.AudioFactory=t,paella.audioFactory={_factoryList:[],initFactories:function(){if(paella.audioFactories){var e=this;paella.player.config.player.audioMethods=paella.player.config.player.audioMethods||{},paella.player.config.player.audioMethods.forEach(function(t){t.enabled&&e.registerFactory(new paella.audioFactories[t.factory])})}},getAudioObject:function(e,t){0==this._factoryList.length&&this.initFactories();var a=null;return this._factoryList.some(function(e){if(e.isStreamCompatible(t))return a=e,!0})?a.getAudioObject(e,t):null},registerFactory:function(e){this._factoryList.push(e)}}}(),function(){function e(e){var t=this;return new Promise(function(a,n){if(t._ready)a("function"!=typeof e||e());else{!function n(){t.audio.readyState>=t.audio.HAVE_CURRENT_DATA?(t._ready=!0,a("function"!=typeof e||e())):setTimeout(n,50)}()}})}var t=function(t){function a(e,t){var n;return _classCallCheck(this,a),(n=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e,t)))._streamName="audio",n._audio=document.createElement("audio"),n.domElement.appendChild(n._audio),n}return _inherits(a,paella.AudioElementBase),_createClass(a,[{key:"setAutoplay",value:function(e){this.audio.autoplay=e}},{key:"load",value:function(){var t=this._stream.sources[this._streamName],a=t.length>0?t[0]:null;if(this.audio.innerText="",a){var n=this.audio.querySelector("source");return n||(n=document.createElement("source"),this.audio.appendChild(n)),n.src=a.src,a.type&&(n.type=a.type),this.audio.load(),e.apply(this,[function(){return a}])}return Promise.reject(new Error("Could not load video: invalid quality stream index"))}},{key:"play",value:function(){var t=this;return e.apply(this,[function(){t.audio.play()}])}},{key:"pause",value:function(){var t=this;return e.apply(this,[function(){t.audio.pause()}])}},{key:"isPaused",value:function(){var t=this;return e.apply(this,[function(){return t.audio.paused}])}},{key:"duration",value:function(){var t=this;return e.apply(this,[function(){return t.audio.duration}])}},{key:"setCurrentTime",value:function(t){var a=this;return e.apply(this,[function(){a.audio.currentTime=t}])}},{key:"currentTime",value:function(){var t=this;return e.apply(this,[function(){return t.audio.currentTime}])}},{key:"setVolume",value:function(t){var a=this;return e.apply(this,[function(){return a.audio.volume=t}])}},{key:"volume",value:function(){var t=this;return e.apply(this,[function(){return t.audio.volume}])}},{key:"setPlaybackRate",value:function(t){var a=this;return e.apply(this,[function(){a.audio.playbackRate=t}])}},{key:"playbackRate",value:function(){var t=this;return e.apply(this,[function(){return t.audio.playbackRate}])}},{key:"unload",value:function(){return Promise.resolve()}},{key:"audio",get:function(){return this._audio}}]),a}();paella.MultiformatAudioElement=t;var a=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isStreamCompatible",value:function(e){return!0}},{key:"getAudioObject",value:function(e,t){return new paella.MultiformatAudioElement(e,t)}}]),e}();paella.audioFactories.MultiformatAudioFactory=a}(),function(){paella.Profiles={profileList:null,getDefaultProfile:function(){return paella.player.videoContainer.masterVideo()&&paella.player.videoContainer.masterVideo().defaultProfile()?paella.player.videoContainer.masterVideo().defaultProfile():paella.player&&paella.player.config&&paella.player.config.defaultProfile?paella.player.config.defaultProfile:void 0},loadProfile:function(e,t){var a=this.getDefaultProfile();this.loadProfileList(function(n){var i;if(n[e])i=n[e];else{if(!n[a])return base.log.debug("Error loading the default profile. Check your Paella Player configuration"),!1;i=n[a]}t(i)})},loadProfileList:function(e){var t=this;if(null==this.profileList){var a={url:paella.utils.folders.profiles()+"/profiles.json"};base.ajax.get(a,function(a,n,i){"string"==typeof a&&(a=JSON.parse(a)),t.profileList=a,e(t.profileList)},function(e,t,a){base.log.debug("Error loading video profiles. Check your Paella Player configuration")})}else e(t.profileList)}};var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"proportionalHeight",value:function(e){return Math.floor(this.h*e/this.w)}},{key:"proportionalWidth",value:function(e){return Math.floor(this.w*e/this.h)}},{key:"percentVSize",value:function(e){return 100*e/this.h}},{key:"percentWSize",value:function(e){return 100*e/this.w}},{key:"aspectRatio",value:function(){return this.w/this.h}},{key:"w",get:function(){return this._w||1280},set:function(e){this._w=e}},{key:"h",get:function(){return this._h||720},set:function(e){this._h=e}}]),e}();paella.RelativeVideoSize=e;var t=function(e){function t(e,a,n,i,r,o){var l;_classCallCheck(this,t),l=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,a,e,{}));var s=paella.player.config.player.videoZoom||{},u=(void 0===s.enabled||s.enabled)&&l.allowZoom();l.style=u?{width:l._zoom+"%",height:"100%",position:"absolute"}:{width:"100%",height:"100%"},l._rect=null;var c=document.createElement("div");if(setTimeout(function(){return l.domElement.parentElement.appendChild(c)},10),c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.right="0px",c.style.bottom="0px",l.eventCapture=c,u){var d=function(){var e=paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||500,t=$(window).width()>=e;this._zoomAvailable!=t&&(this._zoomAvailable=t,paella.events.trigger(paella.events.zoomAvailabilityChanged,{available:t}))},p=function(e){return{x:e.originalEvent.offsetX,y:e.originalEvent.offsetY}},h=function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},v=function(e){var t={x:this._mouseCenter.x-1.1*e.x,y:this._mouseCenter.y-1.1*e.y},a=$(this.domElement).width(),n=$(this.domElement).height(),i=this._zoom-100,r={x:t.x*i/a*(i/100),y:t.y*i/n*(i/100)};r.x>i?r.x=i:r.x<0?r.x=0:this._mouseCenter.x=t.x,r.y>i?r.y=i:r.y<0?r.y=0:this._mouseCenter.y=t.y,$(this.domElement).css({left:"-"+r.x+"%",top:"-"+r.y+"%"}),this._zoomOffset={x:r.x,y:r.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this})};l._zoomAvailable=!0,d.apply(_assertThisInitialized(l)),$(window).resize(function(){d.apply(_assertThisInitialized(l))}),l._zoom=100,l._mouseCenter={x:0,y:0},l._mouseDown={x:0,y:0},l._zoomOffset={x:0,y:0},l._maxZoom=s.max||400,$(l.domElement).css({width:"100%",height:"100%",left:"0%",top:"0%"}),Object.defineProperty(_assertThisInitialized(l),"zoom",{get:function(){return this._zoom}}),Object.defineProperty(_assertThisInitialized(l),"zoomOffset",{get:function(){return this._zoomOffset}});var f=[];$(c).on("touchstart",function(e){if(l.allowZoom()&&l._zoomAvailable){f=[];for(var t=$(l.domElement).offset(),a=0;a<e.originalEvent.targetTouches.length;++a){var n=e.originalEvent.targetTouches[a];f.push({x:n.screenX-t.left,y:n.screenY-t.top})}f.length>1&&e.preventDefault()}}),$(c).on("touchmove",function(e){if(l.allowZoom()&&l._zoomAvailable){for(var t,a,n=[],i=$(l.domElement).offset(),r=0;r<e.originalEvent.targetTouches.length;++r){var o=e.originalEvent.targetTouches[r];n.push({x:o.screenX-i.left,y:o.screenY-i.top})}if(n.length>1&&f.length>1){var s=h(f[0],f[1]),u=h(n[0],n[1])-s,c=(t=f[0],{x:((a=f[1]).x-t.x)/2+t.x,y:(a.y-t.y)/2+t.y});l._mouseCenter=c,l._zoom+=u,l._zoom=l._zoom<100?100:l._zoom,l._zoom=l._zoom>l._maxZoom?l._maxZoom:l._zoom;var d={w:$(l.domElement).width(),h:$(l.domElement).height()},p=l._mouseCenter;$(l.domElement).css({width:l._zoom+"%",height:l._zoom+"%"});var m=l._zoom-100,g={x:p.x*m/d.w,y:p.y*m/d.h};g.x=g.x<m?g.x:m,g.y=g.y<m?g.y:m,$(l.domElement).css({left:"-"+g.x+"%",top:"-"+g.y+"%"}),l._zoomOffset={x:g.x,y:g.y},paella.events.trigger(paella.events.videoZoomChanged,{video:_assertThisInitialized(l)}),f=n,e.preventDefault()}else if(n.length>0){var y={x:n[0].x-f[0].x,y:n[0].y-f[0].y};v.apply(_assertThisInitialized(l),[y]),f=n,e.preventDefault()}}}),$(c).on("touchend",function(e){l.allowZoom()&&l._zoomAvailable&&f.length>1&&e.preventDefault()}),l.zoomIn=function(){if(!(l._zoom>=l._maxZoom)&&l._zoomAvailable){l._mouseCenter||(l._mouseCenter={x:$(l.domElement).width()/2,y:$(l.domElement).height()/2}),l._zoom+=25,l._zoom=l._zoom<100?100:l._zoom,l._zoom=l._zoom>l._maxZoom?l._maxZoom:l._zoom;var e=$(l.domElement).width(),t=$(l.domElement).height(),a=l._mouseCenter;$(l.domElement).css({width:l._zoom+"%",height:l._zoom+"%"});var n=l._zoom-100,i={x:a.x*n/e*(n/100),y:a.y*n/t*(n/100)};i.x=i.x<n?i.x:n,i.y=i.y<n?i.y:n,$(l.domElement).css({left:"-"+i.x+"%",top:"-"+i.y+"%"}),l._zoomOffset={x:i.x,y:i.y},paella.events.trigger(paella.events.videoZoomChanged,{video:_assertThisInitialized(l)})}},l.zoomOut=function(){if(!(l._zoom<=100)&&l._zoomAvailable){l._mouseCenter||(l._mouseCenter={x:$(l.domElement).width()/2,y:$(l.domElement).height()/2}),l._zoom-=25,l._zoom=l._zoom<100?100:l._zoom,l._zoom=l._zoom>l._maxZoom?l._maxZoom:l._zoom;var e=$(l.domElement).width(),t=$(l.domElement).height(),a=l._mouseCenter;$(l.domElement).css({width:l._zoom+"%",height:l._zoom+"%"});var n=l._zoom-100,i={x:a.x*n/e*(n/100),y:a.y*n/t*(n/100)};i.x=i.x<n?i.x:n,i.y=i.y<n?i.y:n,$(l.domElement).css({left:"-"+i.x+"%",top:"-"+i.y+"%"}),l._zoomOffset={x:i.x,y:i.y},paella.events.trigger(paella.events.videoZoomChanged,{video:_assertThisInitialized(l)})}},$(c).on("mousewheel wheel",function(e){if(l.allowZoom()&&l._zoomAvailable){var t=p(e),a=function(e){var t=e.originalEvent.deltaY*(paella.utils.userAgent.Firefox?2:1);return-Math.abs(t)<6?t:6*Math.sign(t)}(e);if(!(l._zoom>=l._maxZoom&&a>0)){l._zoom+=a,l._zoom=l._zoom<100?100:l._zoom,l._zoom=l._zoom>l._maxZoom?l._maxZoom:l._zoom;var n=$(l.domElement).width(),i=$(l.domElement).height();$(l.domElement).css({width:l._zoom+"%",height:l._zoom+"%"});var r=l._zoom-100,o={x:t.x*r/n*(r/100),y:t.y*r/i*(r/100)};return o.x=o.x<r?o.x:r,o.y=o.y<r?o.y:r,$(l.domElement).css({left:"-"+o.x+"%",top:"-"+o.y+"%"}),l._zoomOffset={x:o.x,y:o.y},paella.events.trigger(paella.events.videoZoomChanged,{video:_assertThisInitialized(l)}),l._mouseCenter=t,e.stopPropagation(),!1}}}),$(c).on("mousedown",function(e){l._mouseDown=p(e),l.drag=!0}),$(c).on("mousemove",function(e){if(l.allowZoom()&&l._zoomAvailable&&l.drag){paella.player.videoContainer.disablePlayOnClick();var t=p(e);v.apply(_assertThisInitialized(l),[{x:t.x-l._mouseDown.x,y:t.y-l._mouseDown.y}]),l._mouseDown=t}}),$(c).on("mouseup",function(e){l.allowZoom()&&l._zoomAvailable&&(l.drag=!1,setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10))}),$(c).on("mouseleave",function(e){l.drag=!1})}return l}return _inherits(t,paella.DomNode),_createClass(t,[{key:"allowZoom",value:function(){return!0}},{key:"setZoom",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.zoomAvailable()&&(this._zoomOffset.x=t,this._zoomOffset.y=a,this._zoom=e,0==n?$(this.domElement).css({width:this._zoom+"%",height:this._zoom+"%",left:"-"+this._zoomOffset.x+"%",top:"-"+this._zoomOffset.y+"%"}):$(this.domElement).stop(!0,!1).animate({width:this._zoom+"%",height:this._zoom+"%",left:"-"+this._zoomOffset.x+"%",top:"-"+this._zoomOffset.y+"%"},n,"linear"),paella.events.trigger(paella.events.videoZoomChanged,{video:this}))}},{key:"captureFrame",value:function(){return Promise.resolve(null)}},{key:"supportsCaptureFrame",value:function(){return Promise.resolve(!1)}},{key:"zoomAvailable",value:function(){return this.allowZoom()&&this._zoomAvailable}},{key:"disableEventCapture",value:function(){this.eventCapture.style.pointerEvents="none"}},{key:"enableEventCapture",value:function(){this.eventCapture.style.pointerEvents=""}}]),t}();paella.VideoRect=t;var a=function(e){function t(e,a,n,i,r,o,l){var s;return _classCallCheck(this,t),(s=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,n,i,r,o,l)))._stream=a,s._ready=!1,s._autoplay=!1,s._videoQualityStrategy=null,s._stream.preview&&s.setPosterFrame(s._stream.preview),s}return _inherits(t,paella.VideoRect),_createClass(t,[{key:"defaultProfile",value:function(){return null}},{key:"setVideoQualityStrategy",value:function(e){this._videoQualityStrategy=e}},{key:"setPosterFrame",value:function(e){base.log.debug("TODO: implement setPosterFrame() function")}},{key:"setAutoplay",value:function(e){this._autoplay=e}},{key:"setMetadata",value:function(e){this._metadata=e}},{key:"load",value:function(){return paella_DeferredNotImplemented()}},{key:"supportAutoplay",value:function(){return!0}},{key:"getVideoData",value:function(){return paella_DeferredNotImplemented()}},{key:"play",value:function(){return base.log.debug("TODO: implement play() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"pause",value:function(){return base.log.debug("TODO: implement pause() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"isPaused",value:function(){return base.log.debug("TODO: implement isPaused() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"duration",value:function(){return base.log.debug("TODO: implement duration() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"setCurrentTime",value:function(e){return base.log.debug("TODO: implement setCurrentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"currentTime",value:function(){return base.log.debug("TODO: implement currentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"setVolume",value:function(e){return base.log.debug("TODO: implement setVolume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"volume",value:function(){return base.log.debug("TODO: implement volume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"setPlaybackRate",value:function(e){return base.log.debug("TODO: implement setPlaybackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"playbackRate",value:function(){return base.log.debug("TODO: implement playbackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()}},{key:"getQualities",value:function(){return paella_DeferredNotImplemented()}},{key:"setQuality",value:function(e){return paella_DeferredNotImplemented()}},{key:"getCurrentQuality",value:function(){return paella_DeferredNotImplemented()}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}},{key:"goFullScreen",value:function(){return paella_DeferredNotImplemented()}},{key:"freeze",value:function(){return paella_DeferredNotImplemented()}},{key:"unFreeze",value:function(){return paella_DeferredNotImplemented()}},{key:"disable",value:function(e){console.log("Disable video requested")}},{key:"enable",value:function(e){console.log("Enable video requested")}},{key:"setClassName",value:function(e){this.domElement.className=e}},{key:"_callReadyEvent",value:function(){paella.events.trigger(paella.events.singleVideoReady,{sender:this})}},{key:"_callUnloadEvent",value:function(){paella.events.trigger(paella.events.singleVideoUnloaded,{sender:this})}},{key:"ready",get:function(){return this._ready}},{key:"stream",get:function(){return this._stream}}]),t}();paella.VideoElementBase=a;var n=function(e){function t(e,a,n,i,r,o){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,"div",n,i,r,o))}return _inherits(t,paella.VideoElementBase),_createClass(t,[{key:"setPosterFrame",value:function(e){}},{key:"setAutoplay",value:function(e){}},{key:"load",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"play",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"pause",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"isPaused",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"duration",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"setCurrentTime",value:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"currentTime",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"setVolume",value:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"volume",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"setPlaybackRate",value:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"playbackRate",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"unFreeze",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"freeze",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"unload",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}},{key:"getDimensions",value:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}}]),t}();paella.EmptyVideo=n;var i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"isStreamCompatible",value:function(e){return!0}},{key:"getVideoObject",value:function(e,t,a){return new paella.EmptyVideo(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.EmptyVideoFactory=i;var r=function(e){function t(e,a,n,i,r,o,l){var s;_classCallCheck(this,t),(s=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,"video",n,i,r,o)))._posterFrame=null,s._currentQuality=null,s._autoplay=!1,s._streamName=l||"mp4",s._playbackRate=1,s._stream.sources[s._streamName]&&s._stream.sources[s._streamName].sort(function(e,t){return e.res.h-t.res.h}),s.video.preload="auto",s.video.setAttribute("playsinline",""),s.video.setAttribute("tabindex","-1");var u=function(e){(function(e){this._ready||4!=this.video.readyState||(this._ready=!0,void 0!==this._initialCurrentTipe&&(this.video.currentTime=this._initialCurrentTime,delete this._initialCurrentTime),this._callReadyEvent())}).apply(_assertThisInitialized(s),[e])};return $(s.video).bind("progress",u),$(s.video).bind("loadstart",u),$(s.video).bind("loadedmetadata",u),$(s.video).bind("canplay",u),$(s.video).bind("oncanplay",u),$(s.video).bind("timeupdate",function(e){s._resumeCurrentTime=s.video.currentTime}),$(s.video).bind("emptied",function(e){s._resumeCurrentTime&&!isNaN(s._resumeCurrentTime)&&(s.video.currentTime=s._resumeCurrentTime)}),paella.utils.userAgent.browser.Safari&&$(s.video).bind("canplay canplaythrough",function(e){s._resumeCurrentTime&&(s.video.currentTime=s._resumeCurrentTime)}),s}return _inherits(t,paella.VideoElementBase),_createClass(t,[{key:"_deferredAction",value:function(e){var t=this;return new Promise(function(a,n){function i(e){e instanceof Promise?e.then(function(e){return a(e)}).catch(function(e){return n(e)}):a(e)}t.ready?i(e()):$(t.video).bind("canplay",function(){i(e())})})}},{key:"_getQualityObject",value:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return 0==this.res.w?"auto":this.res.w+"x"+this.res.h},shortLabel:function(){return 0==this.res.w?"auto":this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}}},{key:"captureFrame",value:function(){var e=this;return new Promise(function(t){t({source:e.video,width:e.video.videoWidth,height:e.video.videoHeight})})}},{key:"supportsCaptureFrame",value:function(){return Promise.resolve(!0)}},{key:"getVideoData",value:function(){var e=this,t=this;return new Promise(function(a,n){e._deferredAction(function(){a({duration:t.video.duration,currentTime:t.video.currentTime,volume:t.video.volume,paused:t.video.paused,ended:t.video.ended,res:{w:t.video.videoWidth,h:t.video.videoHeight}})})})}},{key:"setPosterFrame",value:function(e){this._posterFrame=e}},{key:"setAutoplay",value:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)}},{key:"load",value:function(){var e=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(this.video.innerText="",t){var a=this.video.querySelector("source");return a||(a=document.createElement("source"),this.video.appendChild(a)),this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),a.src=t.src,a.type=t.type,this.video.load(),this.video.playbackRate=this._playbackRate,this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))}},{key:"disable",value:function(e){}},{key:"enable",value:function(e){}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t,a){setTimeout(function(){var a=[],n=e._stream.sources[e._streamName],i=-1;n.forEach(function(t){i++,a.push(e._getQualityObject(i,t))}),t(a)},10)})}},{key:"setQuality",value:function(e){var t=this;return new Promise(function(a){var n=t.video.paused,i=t._stream.sources[t._streamName];t._currentQuality=e<i.length?e:0;var r=t.video.currentTime,o=t,l=function e(){o.unFreeze().then(function(){a(),o.video.removeEventListener("seeked",e,!1)})};t.freeze().then(function(){return t.load()}).then(function(){n||t.play(),t.video.addEventListener("seeked",l),t.video.currentTime=r})})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t){t(e._getQualityObject(e._currentQuality,e._stream.sources[e._streamName][e._currentQuality]))})}},{key:"play",value:function(){var e=this;return this._deferredAction(function(){return e._isDisabled?Promise.resolve():e.video.play()})}},{key:"pause",value:function(){var e=this;return this._deferredAction(function(){return e._isDisabled?Promise.resolve():e.video.pause()})}},{key:"isPaused",value:function(){var e=this;return this._deferredAction(function(){return e.video.paused})}},{key:"duration",value:function(){var e=this;return this._deferredAction(function(){return e.video.duration})}},{key:"setCurrentTime",value:function(e){var t=this;return this._deferredAction(function(){e&&!isNaN(e)&&(t.video.currentTime=e)})}},{key:"currentTime",value:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})}},{key:"setVolume",value:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e,0==e?(t.video.setAttribute("muted","muted"),t.video.muted=!0):(t.video.removeAttribute("muted"),t.video.muted=!1)})}},{key:"volume",value:function(){var e=this;return this._deferredAction(function(){return e.video.volume})}},{key:"setPlaybackRate",value:function(e){var t=this;return this._deferredAction(function(){t._playbackRate=e,t.video.playbackRate=e})}},{key:"playbackRate",value:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})}},{key:"supportAutoplay",value:function(){var e=paella.utils.userAgent.system.MacOS&&paella.utils.userAgent.system.Version.minor>=12&&paella.utils.userAgent.browser.Safari,t=paella.utils.userAgent.system.iOS,a=paella.utils.userAgent.browser.Chrome&&64==paella.utils.userAgent.browser.Version.major;return!(e||t||a)}},{key:"goFullScreen",value:function(){var e=this;return this._deferredAction(function(){var t=e.video;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitEnterFullscreen&&t.webkitEnterFullscreen()})}},{key:"unFreeze",value:function(){var e=this;return this._deferredAction(function(){var t=document.getElementById(e.video.id+"canvas");t&&$(t).remove()})}},{key:"freeze",value:function(){var e=this;return this._deferredAction(function(){var t=document.createElement("canvas");t.id=e.video.id+"canvas",t.className="freezeFrame",t.width=e.video.videoWidth,t.height=e.video.videoHeight,t.style.cssText=e.video.style.cssText,t.style.zIndex=2,t.getContext("2d").drawImage(e.video,0,0,16*Math.ceil(t.width/16),16*Math.ceil(t.height/16)),e.video.parentElement.appendChild(t)})}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}},{key:"video",get:function(){return this.domElement}},{key:"ready",get:function(){return this.video.readyState>=3}}]),t}();paella.Html5Video=r,paella.Html5Video.IsAutoplaySupported=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t){var a=document.createElement("video");a.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAC+htZGF0AAACqQYF//+l3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1NSByMjkwMSA3ZDBmZjIyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxOCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDEgbWU9ZGlhIHN1Ym1lPTEgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MCBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTAgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9MCB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTEga2V5aW50PTMyMCBrZXlpbnRfbWluPTMyIHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByYz1jcmYgbWJ0cmVlPTAgY3JmPTQwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgcGJfcmF0aW89MS4zMCBhcT0xOjEuMDAAgAAAAJBliIQD/2iscx5avG2BdVkxRtUop8zs5zVIqfxQM03W1oVb8spYPP0yjO506xIxgVQ4iSPGOtcDZBVYGqcTatSa730A8XTpnUDpUSrpyaCe/P8eLds/XenOFYMh8UIGMBwzhVOniajqOPFOmmFC20nufGOpJw81hGhgFwCO6a8acwB0P6LNhZZoRD0y2AZMQfEA0AAHAAAACEGaIRiEP5eAANAABwDSGK8UmBURhUGyINeXiuMlXvJnPVVQKigqVGy8PAuVNiWY94iJ/jL/HeT+/usIfmc/dsQ/TV87CTfXhD8C/4xCP3V+DJP8UP3iJdT8okfAuRJF8zkPgh5/J7XzGT8o9pJ+tvlST+g3uwh1330Q9qd4IbnwOQ9dexCHf8mQfVJ57wET8acsIcn6UT6p7yoP2uQ97fFAhrNARXaou2QkEJxrmP6ZBa7TiE6Uqx04OcnChy+OrfwfRWfSYRbS2wmENdDIKUQSkggeXbLb10CIHL5BPgiBydo+HEEPILBbH9zZOdw/77EbN8euVRS/ZcjbZ/D63aLDh1MTme4vfGzFjXkw9r7U8EhcddAmwXGKjo9o53+/8Rnm1rnt6yh3hLD9/htcZnjjGcW9ZQlj6DKIGrrPo/l6C6NyeVr07mB/N6VlGb5fkLBZM42iUNiIGnMJzShmmlFtEsO0mr5CMcFiJdrZQjdIxsYwpU4xlzmD2+oPtjSLVZiDh2lHDRmHubAxXMROEt0z4GkcCYCk832HaXZSM+4vZbUwJa2ysgmfAQMTEM9gxxct7h5xLdrMnHUnB2bXMO2rEnqnnjWHyFYTrzmZTjJ3N4qP+Pv5VHYzZuAa9jnrg35h5hu/Q87uewVnjbJrtcOOm6b9lltPS6n/mkxgxSyqLJVzr/bYt039aTYyhmveJTdeiG7kLfmn9bqjXfxdfZoz53RDcxw+jP7n7TtT8BsB3jUvxe7n5Gbrm9/5QzQ3cxxl9s6ojDMDg3R7Bx//b5rwuSI84z2fuP8/nPxj/wvHNccSL3n77sCEv+AUwlVzHAFkYCkDkdRIORiUg5GJSDkYlIORgKQsjI9E1d0PUP5zV31MSkvI+AAAAAtBmkMYjP/4v5j6wQDGGK/rogCQL/+rZ+PHZ8R11ITSYLDLmXtUdt5a5V+63JHBE/z0/3cCf4av6uOAGtQmr8mCvCxwSI/c7KILm624qm/Kb4fKK5P1GWvX/S84SiSuyTIfk3zVghdRlzZpLZXgddiJjKTGb43OFQCup1nyCbjWgjmOozS6mXGEDsuoVDkSR7/Q8ErEhAZqgHJ5yCxkICvpE+HztDoOSTYiiBCW6shBKQM/Aw5DdbsGWUc/3XEIhH8HXJSDU8mZDApXSSZR+4fbKiOTUHmUgYd7HOLNG544Zy3F+ZPqxMwuGkCo/HxfLXrebdQakkweTwTqUgIDlwvPC181Z5eZ7cDTV905pDXGj/KiRAk3p+hlgHPvRW35PT4b163gUGkmIl0Ds4OBn6G64lkPsnQPNFs8AtwH4PSeYoz9s5uh/jFX0tlr7f+xzN6PuDvyOmKvYhdYK5FLAOkbJ6E/r7fxRZ1g63PPgeLsfir/0iq9K7IW+eWH4ONNCdL5oyV/TSILB+ob8z1ZWUf9p50jIFh6l64geGZ785/8OQanz95/ZPwGF03PMeYdkuH6x5Q/gcx5bg2RejM+RPQ6Vg6D43WOe+1fDKbVqr9P6Y5S9fuwD56fvq62ESHISopAae8/mbMD2la4/h/K9uSYuhxZDNszxgmQmd2kQDoEU6g46KneCXN/b9b5Ez/4iQOfBj4EuXyfp8MlAlFg8P486y4HT9H680pqN9xN164m7ReXPWHU7pw7F9Pw3FEDjQrHHnM3KfE8KWrl2JyxrdR90wr+HPPrkO5v1XT88+iU5MfGOeswl1uQxhiAGn4O62zaMJmDbSrMNY4LEV/jc+TjMQJRwOsUrW8aDyVoo87t8G+Qtfm6fOy6DNK9crM2f3KQJ0YEPc5JM0eSQsjYSFkZFIWRkUgcB1El5HwAAAAIAZ5iRCX/y4AA7liudRsNCYNGAb/ocSIJGilo13xUupVcYzmaVbkEY3nch7y9pfI1qxo3V9n9Q+r84e3e7dCfx+aLdD6S8dDaqzc6eqH9onVdingfJndPc1yaRhn4JD1jsj85o/le4m9cE2W1F8unegGNvOuknfzBmz4/Us9R+kC7xW5e9Z1Z9JsGeb/z6XkKkxiNh1C3Ns5jTVxB9x1poY49zmq+xsXNh0uy75DZf0JM9Uq8ghKrZiQDyAlHf4dqw48mtmlozgUMkh7VJ7vbIW1UNI81pRTT7C3WOOa3mw0RNjAoMLjtm1+VqQBEhHw+6VBvNTwCBkyvjU+kVMA1OU8elyGQX0xTlHRM8iPGg3CO8B5AzpOm2M7J75cG3PPGc42ztXyYzat3TyZ54CyDqZi1/Mn4B6T1fhMSD0uk5lKsOHIktX1Sfud/I3Ew+McUpwm3bxVdAy7uiGeiXWbe3cMBmCruk4yW18G6dEf9prnjcT6HUZG5bBSQGYSQscX2KCZoWxWkVS0w6IkwqdVJ+Akyey/Hl0MyrcAMI6Sgq3HMn95sBcc4ZadQLT31gNKo6qyebwmyK63HlMTK40Zj3FGuboBQ3Zsg87Jf3Gg1SDlG6fRVl2+5Cc6q+0OcUNRyCfLIG157ZHTSCwD9UpZtZDLki0BCLgAAAAhBmmQYiv+BgQDyne7dSHRhSQ/D31OEhh0h14FMQDwlvgJODIIYGxb7iHQo1mvJn3hOUUli9mTrUMuuPv/W2bsX3X7l9k7jtvT/Cuf4Kmbbhn0zmtjx7GWFyjrJfyHHxs5mxuTjdr2/drXoPhh1rb2XOnE9H3BdBqm1I+K5Sd1hYCevn6PbJcDyUHpysOZeLu+VoYklOlicG52cbxZbzvVeiS4jb+qyJoL62Ox+nSrUhOkCNMf8dz5iEi+C5iYZciyXk6gmIvSJVQDNTiO2i1a6pGORhiNVWGAMBHNHyHbmWtqB9AYbSdGR5qQzHnGF9HWaHfTzIqQMNEioRwE00KEllO+UcuPFmOs0Kl9lgy1DgKSKfGaaVFc7RNrn0nOddM6OfOG51GuoJSCnOpRjIvLAMAAAAA1NfU1+Ro9v/o+AANDABwAABedtb292AAAAbG12aGQAAAAA18kDNdfJAzUAAAPoAAAAowABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAACknRyYWsAAABcdGtoZAAAAAPXyQM118kDNQAAAAEAAAAAAAAAnwAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAOAAAACAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAJ8AABZEAAEAAAAAAgptZGlhAAAAIG1kaGQAAAAA18kDNdfJAzUAAV+QAAA3qlXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAG1bWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABdXN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAOAAgAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQAr/4QAaZ01ACuyiLy+AtQYBBkAAAATAAAEsI8SJZYABAAVo74OcgAAAABhzdHRzAAAAAAAAAAEAAAAFAAALIgAAABRzdHNzAAAAAAAAAAEAAAABAAAAEXNkdHAAAAAAIBAQGBAAAAAwY3R0cwAAAAAAAAAEAAAAAgAAFkQAAAABAAAhZgAAAAEAAAsiAAAAAQAAFkQAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAKHN0c3oAAAAAAAAAAAAAAAUAAANBAAAADAAAAA8AAAAMAAAADAAAACRzdGNvAAAAAAAAAAUAAAAwAAADdQAABhAAAAjPAAAKyQAAAlp0cmFrAAAAXHRraGQAAAAD18kDNdfJAzUAAAACAAAAAAAAAKMAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAABzAAAIQAABAAAAAAG+bWRpYQAAACBtZGhkAAAAANfJAzXXyQM1AACsRAAAHABVxAAAAAAAJWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABNb25vAAAAAXFtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAATVzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAAAAAAAAAAABYCAgAISCAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAAAHAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAwc3RzegAAAAAAAAAAAAAABwAAAAQAAAAEAAACiwAAArAAAAHuAAABNwAAAAQAAAAsc3RjbwAAAAAAAAAHAAADcQAAA4EAAAOFAAAGHwAACNsAAArVAAAMDAAAABpzZ3BkAQAAAHJvbGwAAAACAAAAAf//AAAAHHNiZ3AAAAAAcm9sbAAAAAEAAAAHAAAAAQAAABR1ZHRhAAAADG5hbWVNb25vAAAAb3VkdGEAAABnbWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAA6aWxzdAAAADKpdG9vAAAAKmRhdGEAAAABAAAAAEhhbmRCcmFrZSAxLjEuMiAyMDE4MDkwNTAw",a.load(),e?(a.style="position: fixed; top: 0px; right: 0px; z-index: 1000000;",document.body.appendChild(a)):a.style.display="none",a.playing=!1,a.play().then(function(e){t(!0)}).catch(function(e){t(!1)})})};var o=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isStreamCompatible",value:function(e){try{if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS&&paella.utils.userAgent.system.Version.major<=10&&paella.utils.userAgent.system.Version.minor<3)return!1;for(var t in e.sources)if("mp4"==t||"mp3"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Html5Video(e,t,a.x,a.y,a.w,a.h)}}]),e}();paella.videoFactories.Html5VideoFactory=o,paella.videoFactories.Html5VideoFactory.s_instances=0;var l=function(e){function t(e,a,n,i,r,o){var l;return _classCallCheck(this,t),(l=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,"img",n,i,r,o)))._posterFrame=null,l._currentQuality=null,l._currentTime=0,l._duration=0,l._ended=!1,l._playTimer=null,l._playbackRate=1,l._frameArray=null,l._stream.sources.image.sort(function(e,t){return e.res.h-t.res.h}),l}return _inherits(t,paella.VideoElementBase),_createClass(t,[{key:"_deferredAction",value:function(e){var t=this;return new Promise(function(a){if(t.ready)a(e());else{a=function(){t._ready=!0,a(e())};$(t.video).bind("paella:imagevideoready",a)}})}},{key:"_getQualityObject",value:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return Number(this.res.w)+"x"+Number(this.res.h)},shortLabel:function(){return this.res.h+"p"},compare:function(e){return Number(this.res.w)*Number(this.res.h)-Number(e.res.w)*Number(e.res.h)}}}},{key:"_loadCurrentFrame",value:function(){var e=this;if(this._frameArray){var t=this._frameArray[0];this._frameArray.some(function(a){if(e._currentTime<a.time)return!0;t=a.src}),this.img.src=t}}},{key:"getVideoData",value:function(){var e=this;return new Promise(function(t){e._deferredAction(function(){var a=e._stream.sources.image[e._currentQuality],n={duration:e._duration,currentTime:e._currentTime,volume:0,paused:e._paused,ended:e._ended,res:{w:a.res.w,h:a.res.h}};t(n)})})}},{key:"setPosterFrame",value:function(e){this._posterFrame=e}},{key:"setAutoplay",value:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)}},{key:"load",value:function(){var e=this._stream.sources.image;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(t){for(var a in this._frameArray=[],t.frames){var n=Math.floor(Number(a.replace("frame_","")));this._frameArray.push({src:t.frames[a],time:n})}return this._frameArray.sort(function(e,t){return e.time-t.time}),this._ready=!0,this._currentTime=0,this._duration=t.duration,this._loadCurrentFrame(),paella.events.trigger("paella:imagevideoready"),this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))}},{key:"supportAutoplay",value:function(){return!0}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t){setTimeout(function(){var a=[],n=e._stream.sources[e._streamName],i=-1;n.forEach(function(t){i++,a.push(e._getQualityObject(i,t))}),t(a)},10)})}},{key:"setQuality",value:function(e){var t=this;return new Promise(function(a){t._paused;var n=t._stream.sources.image;t._currentQuality=e<n.length?e:0;t._currentTime;t.load().then(function(){this._loadCurrentFrame(),a()})})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t){t(e._getQualityObject(e._currentQuality,e._stream.sources.image[e._currentQuality]))})}},{key:"play",value:function(){var e=this;return this._deferredAction(function(){e._playTimer=new base.Timer(function(){e._currentTime+=.25*e._playbackRate,e._loadCurrentFrame()},250),e._playTimer.repeat=!0})}},{key:"pause",value:function(){var e=this;return this._deferredAction(function(){e._playTimer.repeat=!1,e._playTimer=null})}},{key:"isPaused",value:function(){var e=this;return this._deferredAction(function(){return e._paused})}},{key:"duration",value:function(){var e=this;return this._deferredAction(function(){return e._duration})}},{key:"setCurrentTime",value:function(e){var t=this;return this._deferredAction(function(){t._currentTime=e,t._loadCurrentFrame()})}},{key:"currentTime",value:function(){var e=this;return this._deferredAction(function(){return e._currentTime})}},{key:"setVolume",value:function(e){return this._deferredAction(function(){})}},{key:"volume",value:function(){return this._deferredAction(function(){return 0})}},{key:"setPlaybackRate",value:function(e){var t=this;return this._deferredAction(function(){t._playbackRate=e})}},{key:"playbackRate",value:function(){var e=this;return this._deferredAction(function(){return e._playbackRate})}},{key:"goFullScreen",value:function(){var e=this;return this._deferredAction(function(){var t=e.img;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitEnterFullscreen&&t.webkitEnterFullscreen()})}},{key:"unFreeze",value:function(){return this._deferredAction(function(){})}},{key:"freeze",value:function(){return this._deferredAction(function(){})}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}},{key:"img",get:function(){return this.domElement}},{key:"imgStream",get:function(){this._stream.sources.image[this._currentQuality]}},{key:"_paused",get:function(){return null==this._playTimer}}]),t}();paella.ImageVideo=l;var s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isStreamCompatible",value:function(e){try{for(var t in e.sources)if("image"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return new paella.ImageVideo(e,t,a.x,a.y,a.w,a.h)}}]),e}();paella.videoFactories.ImageVideoFactory=s}(),function(){var e=function(e){function t(e,a){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"img",e,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex}))).domElement.setAttribute("src",a),n.domElement.setAttribute("alt",""),n.domElement.setAttribute("width","100%"),n.domElement.setAttribute("height","100%"),n}return _inherits(t,paella.DomNode),_createClass(t,[{key:"setImage",value:function(e){this.domElement.setAttribute("src",e)}}]),t}();paella.BackgroundContainer=e;var t=function(e){function t(){var e;_classCallCheck(this,t);return(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div","overlayContainer",{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10}))).domElement.setAttribute("role","main"),e}return _inherits(t,paella.DomNode),_createClass(t,[{key:"size",get:function(){return this._size||(this._size={w:1280,h:720}),this._size}}]),_createClass(t,[{key:"_generateId",value:function(){return Math.ceil(Date.now()*Math.random())}},{key:"enableBackgroundMode",value:function(){this.domElement.className="overlayContainer background"}},{key:"disableBackgroundMode",value:function(){this.domElement.className="overlayContainer"}},{key:"clear",value:function(){this.domElement.innerText=""}},{key:"getVideoRect",value:function(e){return paella.player.videoContainer.getVideoRect(e)}},{key:"addText",value:function(e,t,a){var n=document.createElement("div");return n.innerText=e,n.className="videoOverlayText",a&&(n.style.backgroundColor="red"),this.addElement(n,t)}},{key:"addElement",value:function(e,t){return this.domElement.appendChild(e),e.style.position="absolute",e.style.left=this.getHSize(t.left)+"%",e.style.top=this.getVSize(t.top)+"%",e.style.width=this.getHSize(t.width)+"%",e.style.height=this.getVSize(t.height)+"%",e}},{key:"getLayer",value:function(e,t){return e=e||this._generateId(),$(this.domElement).find("#"+e)[0]||this.addLayer(e,t)}},{key:"addLayer",value:function(e,t){t=t||10;var a=document.createElement("div");return a.className="row",a.id=e||this._generateId(),this.addElement(a,{left:0,top:0,width:1280,height:720})}},{key:"removeLayer",value:function(e){var t=$(this.domElement).find("#"+e)[0];t&&this.domElement.removeChild(t)}},{key:"removeElement",value:function(e){if(e)try{this.domElement.removeChild(e)}catch(e){}}},{key:"getVSize",value:function(e){return 100*e/this.size.h}},{key:"getHSize",value:function(e){return 100*e/this.size.w}}]),t}();paella.VideoOverlay=t;var a=function(e){function t(e,a,n,i,r){var o;_classCallCheck(this,t);var l=new paella.RelativeVideoSize,s={top:l.percentVSize(n)+"%",left:l.percentWSize(a)+"%",width:l.percentWSize(i)+"%",height:l.percentVSize(r)+"%",position:"absolute",zIndex:GlobalParams.video.zIndex,overflow:"hidden"};return(o=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,s)))._rect={left:a,top:n,width:i,height:r},o.domElement.className="videoWrapper",o}return _inherits(t,paella.DomNode),_createClass(t,[{key:"setRect",value:function(e,t){this._rect=JSON.parse(JSON.stringify(e));var a=new paella.RelativeVideoSize,n={top:a.percentVSize(e.top)+"%",left:a.percentWSize(e.left)+"%",width:a.percentWSize(e.width)+"%",height:a.percentVSize(e.height)+"%",position:"absolute"};if(t){this.disableClassName();var i=this;$(this.domElement).animate(n,400,function(){i.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:i})}),this.enableClassNameAfter(400)}else $(this.domElement).css(n),paella.events.trigger(paella.events.setComposition,{video:this})}},{key:"getRect",value:function(){return this._rect}},{key:"disableClassName",value:function(){this.classNameBackup=this.domElement.className,this.domElement.className=""}},{key:"enableClassName",value:function(){this.domElement.className=this.classNameBackup}},{key:"enableClassNameAfter",value:function(e){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",e)}},{key:"setVisible",value:function(e,t){_typeof("string"==e)&&(e=!!/true/i.test(e)),e&&t?($(this.domElement).show(),$(this.domElement).animate({opacity:1},300)):e&&!t?$(this.domElement).show():!e&&t?$(this.domElement).animate({opacity:0},300):e||t||$(this.domElement).hide()}},{key:"setLayer",value:function(e){this.domElement.style.zIndex=e}}]),t}();paella.VideoWrapper=a;var n=function(e){function t(e){var a;_classCallCheck(this,t);return(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"})))._trimming={enabled:!1,start:0,end:0},a.timeupdateEventTimer=null,a.timeupdateInterval=250,a.masterVideoData=null,a.slaveVideoData=null,a.currentMasterVideoData=null,a.currentSlaveVideoData=null,a._force=!1,a._playOnClickEnabled=!0,a._seekDisabled=!1,$(a.domElement).click(function(e){a.firstClick&&base.userAgent.browser.IsMobileVersion||a.firstClick&&!a._playOnClickEnabled||paella.player.videoContainer.paused().then(function(e){a.firstClick=!0,e?paella.player.play():paella.player.pause()})}),a.domElement.addEventListener("touchstart",function(e){paella.player.controls&&paella.player.controls.restartHideTimer()}),a}return _inherits(t,paella.DomNode),_createClass(t,[{key:"triggerTimeupdate",value:function(){var e=this,t=0,a=0;this.paused().then(function(a){return t=a,e.duration()}).then(function(t){return a=t,e.currentTime()}).then(function(n){t&&!e._force||(e._force=!1,paella.events.trigger(paella.events.timeupdate,{videoContainer:e,currentTime:n,duration:a}))})}},{key:"startTimeupdate",value:function(){var e=this;this.timeupdateEventTimer=new Timer(function(t){e.triggerTimeupdate()},this.timeupdateInterval),this.timeupdateEventTimer.repeat=!0}},{key:"stopTimeupdate",value:function(){this.timeupdateEventTimer&&(this.timeupdateEventTimer.repeat=!1),this.timeupdateEventTimer=null}},{key:"enablePlayOnClick",value:function(){this._playOnClickEnabled=!0}},{key:"disablePlayOnClick",value:function(){this._playOnClickEnabled=!1}},{key:"isPlayOnClickEnabled",value:function(){return this._playOnClickEnabled}},{key:"play",value:function(){this.startTimeupdate(),setTimeout(function(){return paella.events.trigger(paella.events.play)},50)}},{key:"pause",value:function(){paella.events.trigger(paella.events.pause),this.stopTimeupdate()}},{key:"seekTo",value:function(e){var t=this;if(this._seekDisabled)console.log("Warning: Seek is disabled");else{var a=this;this.setCurrentPercent(e).then(function(n){a._force=!0,t.triggerTimeupdate(),paella.events.trigger(paella.events.seekToTime,{newPosition:n.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:e})})}}},{key:"seekToTime",value:function(e){var t=this;this._seekDisabled?console.log("Seek is disabled"):this.setCurrentTime(e).then(function(e){t._force=!0,t.triggerTimeupdate();var a=100*e.time/e.duration;paella.events.trigger(paella.events.seekToTime,{newPosition:e.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:a})})}},{key:"setPlaybackRate",value:function(e){paella.events.trigger(paella.events.setPlaybackRate,{rate:e})}},{key:"setVolume",value:function(e){}},{key:"volume",value:function(){return 1}},{key:"trimStart",value:function(){var e=this;return new Promise(function(t){t(e._trimming.start)})}},{key:"trimEnd",value:function(){var e=this;return new Promise(function(t){t(e._trimming.end)})}},{key:"trimEnabled",value:function(){var e=this;return new Promise(function(t){t(e._trimming.enabled)})}},{key:"trimming",value:function(){var e=this;return new Promise(function(t){t(e._trimming)})}},{key:"enableTrimming",value:function(){this._trimming.enabled=!0;var e=paella.captions.getActiveCaptions();void 0!==e&&paella.plugins.captionsPlugin.buildBodyContent(e._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})}},{key:"disableTrimming",value:function(){this._trimming.enabled=!1;var e=paella.captions.getActiveCaptions();void 0!==e&&paella.plugins.captionsPlugin.buildBodyContent(e._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})}},{key:"setTrimming",value:function(e,t){var a=this;return new Promise(function(n){var i=0;a.currentTime().then(function(e){return i=e,a.duration()}).then(function(r){if(r,a._trimming.start=Math.floor(e),a._trimming.end=Math.floor(t),i<a._trimming.start&&a.setCurrentTime(a._trimming.start),i>a._trimming.end&&a.setCurrentTime(a._trimming.end),a._trimming.enabled){var o=paella.captions.getActiveCaptions();void 0!==o&&paella.plugins.captionsPlugin.buildBodyContent(o._captions,"list")}paella.events.trigger(paella.events.setTrim,{trimEnabled:a._trimming.enabled,trimStart:a._trimming.start,trimEnd:a._trimming.end}),n()})})}},{key:"setTrimmingStart",value:function(e){return this.setTrimming(e,this._trimming.end)}},{key:"setTrimmingEnd",value:function(e){return this.setTrimming(this._trimming.start,e)}},{key:"setCurrentPercent",value:function(e){var t=this,a=0;return new Promise(function(n){t.duration().then(function(e){return a=e,t.trimming()}).then(function(n){var i=0;if(n.enabled){var r=n.start,o=n.end;a=o-r,i=parseFloat(e*a/100)}else i=e*a/100;return t.setCurrentTime(i)}).then(function(e){n(e)})})}},{key:"setCurrentTime",value:function(e){base.log.debug("VideoContainerBase.setCurrentTime("+e+")")}},{key:"currentTime",value:function(){return base.log.debug("VideoContainerBase.currentTime()"),0}},{key:"duration",value:function(){return base.log.debug("VideoContainerBase.duration()"),0}},{key:"paused",value:function(){return base.log.debug("VideoContainerBase.paused()"),!0}},{key:"setupVideo",value:function(e){base.log.debug("VideoContainerBase.setupVide()")}},{key:"isReady",value:function(){return base.log.debug("VideoContainerBase.isReady()"),!0}},{key:"onresize",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){_get(_getPrototypeOf(t.prototype),"onresize",this).call(this,onresize)})},{key:"seekDisabled",get:function(){return this._seekDisabled},set:function(e){var t=e!=this._seekDisabled;this._seekDisabled=e,t&&paella.events.trigger(paella.events.seekAvailabilityChanged,{disabled:this._seekDisabled,enabled:!this._seekDisabled})}},{key:"seekEnabled",get:function(){return!this._seekDisabled},set:function(e){var t=e==this._seekDisabled;this._seekDisabled=!e,t&&paella.events.trigger(paella.events.seekAvailabilityChanged,{disabled:this._seekDisabled,enabled:!this._seekDisabled})}}]),t}();paella.VideoContainerBase=n;var i=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"valid",value:function(){return!0}},{key:"adaptFrame",value:function(e,t){return t}}],[{key:"Factory",value:function(){var e=paella.player.config;try{var t=e.player.profileFrameStrategy,a=new(paella.utils.objectFromString(t));if(a instanceof paella.ProfileFrameStrategy)return a}catch(e){}return null}}]),e}();paella.ProfileFrameStrategy=i;var r=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,i),_createClass(t,[{key:"adaptFrame",value:function(e,t){if(e.width<t.width||e.height<t.height){var a=JSON.parse(JSON.stringify(t));a.width=e.width,a.height=e.height;var n={w:t.width-e.width,h:t.height-e.height};return a.top=a.top+n.h/2,a.left=a.left+n.w/2,a}return t}}]),t}();paella.LimitedSizeProfileFrameStrategy=r;var o=function(){function e(t){_classCallCheck(this,e),this._mainStream=null,this._videoStreams=[],this._audioStreams=[],this._mainPlayer=null,this._audioPlayer=null,this._videoPlayers=[],this._audioPlayers=[],this._players=[],this._autoplay="true"==base.parameters.get("autoplay")||this.isLiveStreaming,this._startTime=0}return _createClass(e,[{key:"init",value:function(e){var t=this;if(0==e.length)throw Error("Empty video data.");if(this._videoData=e,this._videoData.some(function(e){return"master"==e.role})||(this._videoData[0].role="master"),this._videoData.forEach(function(e,a){e.type=e.type||"video","master"==e.role&&(t._mainStream=e),"video"==e.type?t._videoStreams.push(e):"audio"==e.type&&t._audioStreams.push(e)}),0==this._videoStreams.length)throw new Error("No video streams found. Paella Player requires at least one video stream.");var a=this.autoplay;this._videoStreams.forEach(function(e,n){var i=paella.videoFactory.getVideoObject("video_".concat(n),e,{x:0,y:0,w:1280,h:720});i.setVideoQualityStrategy(t._qualityStrategy),i.setAutoplay(a),e==t._mainStream?(t._mainPlayer=i,t._audioPlayer=i):i.setVolume(0),t._videoPlayers.push(i),t._players.push(i)}),this._audioStreams.forEach(function(e,n){var i=paella.audioFactory.getAudioObject("audio_".concat(n),e);i.setAutoplay(a),i&&(t._audioPlayers.push(i),t._players.push(i))})}},{key:"loadVideos",value:function(){var e=[];return this._players.forEach(function(t){e.push(t.load())}),Promise.all(e)}},{key:"callPlayerFunction",value:function(e){for(var t=this,a=[],n=[],i=1;i<arguments.length;++i)n.push(arguments[i]);return this.players.forEach(function(t){a.push(t[e].apply(t,n))}),new Promise(function(n,i){Promise.all(a).then(function(){"play"!=e||t._firstPlay||(t._firstPlay=!0,t._startTime&&t.players.forEach(function(e){return e.setCurrentTime(t._startTime)})),n()}).catch(function(e){i(e)})})}},{key:"startTime",get:function(){return this._startTime},set:function(e){this._startTime=e}},{key:"isMonostream",get:function(){return 1==this._videoStreams.length}},{key:"mainStream",get:function(){return this._mainStream}},{key:"videoStreams",get:function(){return this._videoStreams}},{key:"audioStreams",get:function(){return this._audioStreams}},{key:"streams",get:function(){return this._videoStreams.concat(this._audioStreams)}},{key:"videoPlayers",get:function(){return this._videoPlayers}},{key:"audioPlayers",get:function(){return this._audioPlayers}},{key:"players",get:function(){return this._videoPlayers.concat(this._audioPlayers)}},{key:"mainVideoPlayer",get:function(){return this._mainPlayer}},{key:"mainAudioPlayer",get:function(){return this._audioPlayer}},{key:"isLiveStreaming",get:function(){return paella.player.isLiveStream()}},{key:"qualityStrategy",set:function(e){this._qualityStrategy=e,this._videoPlayers.forEach(function(t){t.setVideoQualityStrategy(e)})},get:function(){return this._qualityStrategy||null}},{key:"autoplay",get:function(){return this.supportAutoplay&&this._autoplay},set:function(e){this.supportAutoplay&&!this.isLiveStreaming&&(this._autoplay=e,this.videoPlayers&&(this.videoPlayers.forEach(function(t){return t.setAutoplay(e)}),this.audioPlayers.forEach(function(t){return t.setAutoplay(e)})))}},{key:"supportAutoplay",get:function(){return this.videoPlayers.every(function(e){return e.supportAutoplay()})}}]),e}();paella.StreamProvider=o;var l=function(e){function t(e){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)))._streamProvider=new paella.StreamProvider,a._ready=!1,a._videoWrappers=[],a._container=new paella.DomNode("div","playerContainer_videoContainer_container",{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"}),a._container.domElement.setAttribute("role","main"),a.addNode(a._container),a.overlayContainer=new paella.VideoOverlay(a.domElement),a.container.addNode(a.overlayContainer),a.setProfileFrameStrategy(paella.ProfileFrameStrategy.Factory()),a.setVideoQualityStrategy(paella.VideoQualityStrategy.Factory()),a._audioTag=paella.dictionary.currentLanguage(),a._audioPlayer=null,a._volume=1,a}return _inherits(t,paella.VideoContainerBase),_createClass(t,[{key:"streamProvider",get:function(){return this._streamProvider}},{key:"ready",get:function(){return this._ready}},{key:"isMonostream",get:function(){return this._streamProvider.isMonostream}},{key:"trimmingHandler",get:function(){return this._trimmingHandler}},{key:"videoWrappers",get:function(){return this._videoWrappers}},{key:"container",get:function(){return this._container}},{key:"profileFrameStrategy",get:function(){return this._profileFrameStrategy}},{key:"sourceData",get:function(){return this._sourceData}}]),_createClass(t,[{key:"play",value:function(){var e=this;return new Promise(function(a,n){e.streamProvider.startTime=e._startTime,e.streamProvider.callPlayerFunction("play").then(function(){_get(_getPrototypeOf(t.prototype),"play",e).call(e),a()}).catch(function(e){n(e)})})}},{key:"pause",value:function(){var e=this;return new Promise(function(a,n){e.streamProvider.callPlayerFunction("pause").then(function(){_get(_getPrototypeOf(t.prototype),"pause",e).call(e),a()}).catch(function(e){n(e)})})}},{key:"setCurrentTime",value:function(e){var t=this;return new Promise(function(a,n){t.trimming().then(function(a){return a.enabled&&((e+=a.start)<a.start&&(e=a.start),e>a.end&&(e=a.end)),t.streamProvider.callPlayerFunction("setCurrentTime",e)}).then(function(){return t.duration(!1)}).then(function(t){a({time:e,duration:t})}).catch(function(e){n(e)})})}},{key:"currentTime",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(a){var n=null;(t?Promise.resolve({enabled:!1}):e.trimming()).then(function(t){return n=t,e.masterVideo().currentTime()}).then(function(e){n.enabled&&(e-=n.start),a(e)})})}},{key:"setPlaybackRate",value:function(e){this.streamProvider.callPlayerFunction("setPlaybackRate",e),_get(_getPrototypeOf(t.prototype),"setPlaybackRate",this).call(this,e)}},{key:"setVolume",value:function(e){var t=this;return"object"==_typeof(e)?(console.warn("videoContainer.setVolume(): set parameter as object is deprecated"),Promise.resolve()):new Promise(function(a,n){t._audioPlayer.setVolume(e).then(function(){paella.events.trigger(paella.events.setVolume,{master:e}),a(e)}).catch(function(e){n(e)})})}},{key:"volume",value:function(){return this._audioPlayer.volume()}},{key:"duration",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(a){var n=null;(t?Promise.resolve({enabled:!1}):e.trimming()).then(function(t){return n=t,e.masterVideo().duration()}).then(function(e){n.enabled&&(e=n.end-n.start),a(e)})})}},{key:"paused",value:function(){return this.masterVideo().isPaused()}},{key:"getQualities",value:function(){return this.masterVideo().getQualities()}},{key:"setQuality",value:function(e){var t=[],a=[];return this.streamProvider.videoPlayers.forEach(function(e){var n={player:e,promise:e.getQualities()};t.push(n),a.push(n.promise)}),new Promise(function(n){var i=[];Promise.all(a).then(function(){return t.forEach(function(t){t.promise.then(function(a){var n=a.length>e?e:a.length-1;i.push(t.player.setQuality(n))})}),Promise.all(i)}).then(function(){paella.events.trigger(paella.events.qualityChanged),n()})})}},{key:"getCurrentQuality",value:function(){return this.masterVideo().getCurrentQuality()}},{key:"getAudioTags",value:function(){var e=this;return new Promise(function(t){var a=[];e.streamProvider.players.forEach(function(e){e.stream.audioTag&&a.push(e.stream.audioTag)}),t(a)})}},{key:"setAudioTag",value:function(e){var t=this;return new Promise(function(a){var n=!1,i=null,r=[];t.streamProvider.players.forEach(function(a){i||(i=a),n||a.stream.audioTag!=e||(n=!0,t._audioPlayer=a),r.push(a.setVolume(0))}),!n&&t.streamProvider.mainVideoPlayer?t._audioPlayer=t.streamProvider.mainVideoPlayer:!n&&i&&(t._audioPlayer=i),Promise.all(r).then(function(){return t._audioPlayer.setVolume(t._volume)}).then(function(){t._audioTag=t._audioPlayer.stream.audioTag,paella.events.trigger(paella.events.audioTagChanged),a()})})}},{key:"setProfileFrameStrategy",value:function(e){this._profileFrameStrategy=e}},{key:"setVideoQualityStrategy",value:function(e){this.streamProvider.qualityStrategy=e}},{key:"autoplay",value:function(){return this.streamProvider.autoplay}},{key:"supportAutoplay",value:function(){return this.streamProvider.supportAutoplay}},{key:"setAutoplay",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.streamProvider.autoplay=e,this.streamProvider.supportAutoplay}},{key:"masterVideo",value:function(){return this.streamProvider.mainVideoPlayer||this.audioPlayer}},{key:"getVideoRect",value:function(e){if(this.videoWrappers.length>e)return this.videoWrappers[e].getRect();throw new Error("Video wrapper with index ".concat(e," not found"))}},{key:"setStreamData",value:function(e){var t=this,a=base.parameters.get("time"),n=base.hashParams.get("time"),i=n||(a||"0s"),r=paella.utils.timeParse.timeToSeconds(i);return r&&(this._startTime=r),e.forEach(function(e){for(var t in e.sources){e.sources[t].forEach(function(e){e.res&&(e.res.w=Number(e.res.w),e.res.h=Number(e.res.h))})}}),this._sourceData=e,new Promise(function(a,n){t.streamProvider.init(e),t.streamProvider.videoPlayers.forEach(function(e,a){(function(e,t){var a=new paella.VideoWrapper(e);return a.addNode(t),this.videoWrappers.push(a),this.container.addNode(a),a}).apply(t,["videoPlayerWrapper_"+a,e]),e.setAutoplay(t.autoplay())}),t.streamProvider.loadVideos().then(function(){return t.setAudioTag(t.audioTag)}).then(function(){var e=t.masterVideo().video||t.masterVideo().audio;$(e).bind("timeupdate",function(e){t.trimming().then(function(a){var n=e.currentTarget.currentTime,i=e.currentTarget.duration;a.enabled&&(n-=a.start,i=a.end-a.start),paella.events.trigger(paella.events.timeupdate,{videoContainer:t,currentTime:n,duration:i}),n>=i&&t.streamProvider.callPlayerFunction("pause")})}),t._ready=!0,paella.events.trigger(paella.events.videoReady);var n=base.parameters.get("profile")||base.cookies.get("profile")||paella.profiles.getDefaultProfile();paella.profiles.setProfile(n,!1)?a():paella.profiles.setProfile(paella.profiles.getDefaultProfile(),!1)||a()})})}},{key:"resizePortrait",value:function(){var e=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),t=(new paella.RelativeVideoSize).proportionalHeight(e);this.container.domElement.style.width=e+"px",this.container.domElement.style.height=t+"px";var a=(1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height())/2-t/2;this.container.domElement.style.top=a+"px"}},{key:"resizeLandscape",value:function(){var e=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),t=(new paella.RelativeVideoSize).proportionalWidth(e);this.container.domElement.style.width=t+"px",this.container.domElement.style.height=e+"px",this.container.domElement.style.top="0px"}},{key:"onresize",value:function(){_get(_getPrototypeOf(t.prototype),"onresize",this).call(this);var e=(new paella.RelativeVideoSize).aspectRatio();(1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width())/(1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height())>e?this.resizeLandscape():this.resizePortrait()}},{key:"audioTag",get:function(){return this._audioTag}},{key:"audioPlayer",get:function(){return this._audioPlayer}}]),t}();paella.VideoContainer=l}(),function(){var PluginManager=function(){function PluginManager(){var e=this;_classCallCheck(this,PluginManager),this.targets=null,this.pluginList=[],this.eventDrivenPlugins=[],this.enabledPlugins=[],this.doResize=!0,this.targets={},paella.events.bind(paella.events.loadPlugins,function(t){e.loadPlugins("paella.DeferredLoadPlugin")}),new base.Timer(function(){paella.player&&paella.player.controls&&e.doResize&&paella.player.controls.onresize()},1e3).repeat=!0}return _createClass(PluginManager,[{key:"setupPlugin",value:function setupPlugin(plugin){plugin.setup(),this.enabledPlugins.push(plugin),eval("plugin instanceof paella.UIPlugin")&&plugin.checkVisibility()}},{key:"checkPluginsVisibility",value:function checkPluginsVisibility(){this.enabledPlugins.forEach(function(plugin){eval("plugin instanceof paella.UIPlugin")&&plugin.checkVisibility()})}}]),_createClass(PluginManager,[{key:"setTarget",value:function(e,t){t.addPlugin&&(this.targets[e]=t)}},{key:"getTarget",value:function(e){return"eventDriven"==e?this:this.targets[e]}},{key:"registerPlugin",value:function(e){this.importLibraries(e),this.pluginList.push(e),this.pluginList.sort(function(e,t){return e.getIndex()-t.getIndex()})}},{key:"importLibraries",value:function(e){e.getDependencies().forEach(function(e){var t=document.createElement("script");t.type="text/javascript",t.src="javascript/"+e+".js",document.head.appendChild(t)})}},{key:"loadPlugins",value:function loadPlugins(pluginBaseClass){if(null!=pluginBaseClass){var This=this;this.foreach(function(plugin,config){plugin.isLoaded()||eval("plugin instanceof "+pluginBaseClass)&&config.enabled&&(base.log.debug("Load plugin ("+pluginBaseClass+"): "+plugin.getName()),plugin.config=config,plugin.load(This))})}}},{key:"foreach",value:function(e){var t=!1,a={};try{t=paella.player.config.plugins.enablePluginsByDefault}catch(e){}try{a=paella.player.config.plugins.list}catch(e){}this.pluginList.forEach(function(n){var i=n.getName(),r=a[i];r||(r={enabled:t}),e(n,r)})}},{key:"addPlugin",value:function(e){var t=this;e.__added__||(e.__added__=!0,e.checkEnabled(function(a){if("eventDriven"==e.type&&a){paella.pluginManager.setupPlugin(e),t.eventDrivenPlugins.push(e);for(var n=e.getEvents(),i=function(t,a){e.onEvent(t.type,a)},r=0;r<n.length;++r){var o=n[r];paella.events.bind(o,i)}}}))}},{key:"getPlugin",value:function(e){for(var t=0;t<this.pluginList.length;++t)if(this.pluginList[t].getName()==e)return this.pluginList[t];return null}},{key:"registerPlugins",value:function(){g_pluginCallbackList.forEach(function(e){var t=new(e());t.getInstanceName()&&(paella.plugins=paella.plugins||{},paella.plugins[t.getInstanceName()]=t),paella.pluginManager.registerPlugin(t)})}}]),PluginManager}();paella.PluginManager=PluginManager,paella.pluginManager=new paella.PluginManager;var g_pluginCallbackList=[];paella.addPlugin=function(e){g_pluginCallbackList.push(e)};var Plugin=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isLoaded",value:function(){return this.__loaded__}},{key:"getDependencies",value:function(){return[]}},{key:"load",value:function(e){if(!this.__loaded__){this.__loaded__=!0;var t=e.getTarget(this.type);t&&t.addPlugin&&t.addPlugin(this)}}},{key:"getInstanceName",value:function(){return null}},{key:"getRootNode",value:function(e){return null}},{key:"checkEnabled",value:function(e){e(!0)}},{key:"setup",value:function(){}},{key:"getIndex",value:function(){return 0}},{key:"getName",value:function(){return""}},{key:"type",get:function(){return""}}]),e}();paella.Plugin=Plugin;var FastLoadPlugin=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.Plugin),t}(),EarlyLoadPlugin=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.Plugin),t}(),DeferredLoadPlugin=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.Plugin),t}();paella.FastLoadPlugin=FastLoadPlugin,paella.EarlyLoadPlugin=EarlyLoadPlugin,paella.DeferredLoadPlugin=DeferredLoadPlugin;var PopUpContainer=function(e){function t(e,a){var n;_classCallCheck(this,t);return(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,{}))).containers=null,n.currentContainerId=-1,n.domElement.className=a,n.containers={},n}return _inherits(t,paella.DomNode),_createClass(t,[{key:"hideContainer",value:function(e,t){var a=this.containers[e];a&&this.currentContainerId==e&&(a.identifier=e,paella.events.trigger(paella.events.hidePopUp,{container:a}),a.plugin.willHideContent(),$(a.element).hide(),a.button.className=a.button.className.replace(" selected",""),$(this.domElement).css({width:"0px"}),this.currentContainerId=-1,a.plugin.didHideContent())}},{key:"showContainer",value:function(e,t){var a=this,n=0;function i(e){paella.events.trigger(paella.events.hidePopUp,{container:e}),e.plugin.willHideContent(),$(e.element).hide(),$(a.domElement).css({width:"0px"}),e.button.className=e.button.className.replace(" selected",""),a.currentContainerId=-1,e.plugin.didHideContent()}function r(i){if(paella.events.trigger(paella.events.showPopUp,{container:i}),i.plugin.willShowContent(),i.button.className=i.button.className+" selected",$(i.element).show(),n=$(i.element).width(),"right"==i.plugin.getAlignment()){var r=$(t.parentElement).width()-$(t).position().left-$(t).width();$(a.domElement).css({width:n+"px",right:r+"px",left:""})}else{var o=$(t).position().left;$(a.domElement).css({width:n+"px",left:o+"px",right:""})}a.currentContainerId=e,i.plugin.didShowContent()}var o=this.containers[e];o&&this.currentContainerId!=e&&-1!=this.currentContainerId?(i(this.containers[this.currentContainerId]),r(o)):o&&this.currentContainerId==e?i(o):o&&r(o)}},{key:"registerContainer",value:function(e,t,a,n){var i={identifier:e,button:a,element:t,plugin:n};if(this.containers[e]=i,n.closeOnMouseOut&&n.closeOnMouseOut()){var r=e,o=a;$(t).mouseleave(function(e){paella.player.controls.playbackControl().hidePopUp(r,o)})}$(t).hide(),a.popUpIdentifier=e,a.sourcePlugin=n,$(a).click(function(e){this.plugin.isPopUpOpen()?paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),$(a).keyup(function(e){13!=e.keyCode||this.plugin.isPopUpOpen()?27==e.keyCode&&paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),n.containerManager=this}}]),t}();paella.PopUpContainer=PopUpContainer;var TimelineContainer=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.PopUpContainer),_createClass(t,[{key:"hideContainer",value:function(e,t){var a=this.containers[e];a&&this.currentContainerId==e&&(paella.events.trigger(paella.events.hidePopUp,{container:a}),a.plugin.willHideContent(),$(a.element).hide(),a.button.className=a.button.className.replace(" selected",""),this.currentContainerId=-1,$(this.domElement).css({height:"0px"}),a.plugin.didHideContent())}},{key:"showContainer",value:function(e,t){var a=0,n=this.containers[e];if(n&&this.currentContainerId!=e&&-1!=this.currentContainerId){var i=this.containers[this.currentContainerId];i.button.className=i.button.className.replace(" selected",""),n.button.className=n.button.className+" selected",paella.events.trigger(paella.events.hidePopUp,{container:i}),i.plugin.willHideContent(),$(i.element).hide(),i.plugin.didHideContent(),paella.events.trigger(paella.events.showPopUp,{container:n}),n.plugin.willShowContent(),$(n.element).show(),this.currentContainerId=e,a=$(n.element).height(),$(this.domElement).css({height:a+"px"}),n.plugin.didShowContent()}else n&&this.currentContainerId==e?(paella.events.trigger(paella.events.hidePopUp,{container:n}),n.plugin.willHideContent(),$(n.element).hide(),n.button.className=n.button.className.replace(" selected",""),$(this.domElement).css({height:"0px"}),this.currentContainerId=-1,n.plugin.didHideContent()):n&&(paella.events.trigger(paella.events.showPopUp,{container:n}),n.plugin.willShowContent(),n.button.className=n.button.className+" selected",$(n.element).show(),this.currentContainerId=e,a=$(n.element).height(),$(this.domElement).css({height:a+"px"}),n.plugin.didShowContent())}}]),t}();paella.TimelineContainer=TimelineContainer;var UIPlugin=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.DeferredLoadPlugin),_createClass(t,[{key:"checkVisibility",value:function(){var e=this.config.visibleOn||[paella.PaellaPlayer.mode.standard,paella.PaellaPlayer.mode.fullscreen,paella.PaellaPlayer.mode.embed],t=!1;e.forEach(function(e){e==paella.player.getPlayerMode()&&(t=!0)}),t?this.showUI():this.hideUI()}},{key:"hideUI",value:function(){this.ui.setAttribute("aria-hidden","true"),$(this.ui).hide()}},{key:"showUI",value:function(){var e=this;paella.pluginManager.enabledPlugins.forEach(function(t){t==e&&(e.ui.setAttribute("aria-hidden","false"),$(e.ui).show())})}},{key:"ui",get:function(){return this._ui},set:function(e){this._ui=e}}]),t}();paella.UIPlugin=UIPlugin;var ButtonPlugin=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).subclass="",e.container=null,e.containerManager=null,e}return _inherits(t,paella.UIPlugin),_createClass(t,[{key:"type",get:function(){return"button"}}]),_createClass(t,[{key:"getAlignment",value:function(){return"left"}},{key:"getSubclass",value:function(){return"myButtonPlugin"}},{key:"getIconClass",value:function(){return""}},{key:"addSubclass",value:function(e){$(this.container).addClass(e)}},{key:"removeSubclass",value:function(e){$(this.container).removeClass(e)}},{key:"action",value:function(e){}},{key:"getName",value:function(){return"ButtonPlugin"}},{key:"getMinWindowSize",value:function(){return 0}},{key:"buildContent",value:function(e){}},{key:"willShowContent",value:function(){base.log.debug(this.getName()+" willDisplayContent")}},{key:"didShowContent",value:function(){base.log.debug(this.getName()+" didDisplayContent")}},{key:"willHideContent",value:function(){base.log.debug(this.getName()+" willHideContent")}},{key:"didHideContent",value:function(){base.log.debug(this.getName()+" didHideContent")}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.actionButton}},{key:"getText",value:function(){return""}},{key:"getAriaLabel",value:function(){return""}},{key:"setText",value:function(e){this.container.innerHTML='<span class="button-text">'+paella.AntiXSS.htmlEscape(e)+"</span>",this._i&&this.container.appendChild(this._i)}},{key:"hideButton",value:function(){this.hideUI()}},{key:"showButton",value:function(){this.showUI()}},{key:"changeSubclass",value:function(e){this.subclass=e,this.container.className=this.getClassName()}},{key:"changeIconClass",value:function(e){this._i.className="button-icon "+e}},{key:"getClassName",value:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass}},{key:"getContainerClassName",value:function(){return this.getButtonType()==paella.ButtonPlugin.type.timeLineButton?paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass():this.getButtonType()==paella.ButtonPlugin.type.popUpButton?paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass():void 0}},{key:"setToolTip",value:function(e){this.button.setAttribute("title",e),this.button.setAttribute("aria-label",e)}},{key:"getDefaultToolTip",value:function(){return""}},{key:"isPopUpOpen",value:function(){return this.button.popUpIdentifier==this.containerManager.currentContainerId}},{key:"getExpandableContent",value:function(){return null}},{key:"expand",value:function(){this._expand&&$(this._expand).show()}},{key:"contract",value:function(){this._expand&&$(this._expand).hide()}}],[{key:"BuildPluginButton",value:function(e,t){e.subclass=e.getSubclass();var a=document.createElement("div"),n=e.getAriaLabel();""!=n&&(a=document.createElement("button")),a.className=e.getClassName(),a.id=t;var i=document.createElement("span");i.className="button-text",i.innerHTML=paella.AntiXSS.htmlEscape(e.getText()),i.plugin=e,a.appendChild(i),n&&(a.setAttribute("tabindex",1e3+e.getIndex()),a.setAttribute("aria-label",n)),a.setAttribute("alt",""),a.plugin=e,e.button=a,e.container=a,e.ui=a,e.setToolTip(e.getDefaultToolTip());var r=document.createElement("i");return r.className="button-icon "+e.getIconClass(),r.plugin=e,a.appendChild(r),e._i=r,$(a).click(function(e){var t;t=this,paella.userTracking.log("paella:button:action",t.plugin.getName()),t.plugin.action(t)}),$(a).keyup(function(e){e.preventDefault()}),$(a).focus(function(t){e.expand()}),$(a).focusout(function(t){e.contract()}),a}},{key:"BuildPluginExpand",value:function(e,t){var a=e.getExpandableContent();if(a){var n=document.createElement("span");return n.plugin=e,n.className="expandable-content "+e.getClassName(),e._expand=n,n.appendChild(a),$(e._expand).hide(),n}return null}},{key:"BuildPluginPopUp",value:function(e,t,a){t.subclass=t.getSubclass();var n=document.createElement("div");return e.appendChild(n),n.className=t.getContainerClassName(),n.id=a,n.plugin=t,t.buildContent(n),n}}]),t}();paella.ButtonPlugin=ButtonPlugin,paella.ButtonPlugin.alignment={left:"left",right:"right"},paella.ButtonPlugin.kClassName="buttonPlugin",paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp",paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine",paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3};var VideoOverlayButtonPlugin=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getSubclass",value:function(){return"myVideoOverlayButtonPlugin "+this.getAlignment()}},{key:"action",value:function(e){}},{key:"getName",value:function(){return"VideoOverlayButtonPlugin"}},{key:"type",get:function(){return"videoOverlayButton"}},{key:"tabIndex",get:function(){return-1}}]),t}();paella.VideoOverlayButtonPlugin=VideoOverlayButtonPlugin;var EventDrivenPlugin=function(e){function t(){var e;_classCallCheck(this,t);for(var a=(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).getEvents(),n=0;n<a.length;++n){a[n]==paella.events.loadStarted&&e.onEvent(paella.events.loadStarted)}return e}return _inherits(t,paella.EarlyLoadPlugin),_createClass(t,[{key:"type",get:function(){return"eventDriven"}}]),_createClass(t,[{key:"getEvents",value:function(){return[]}},{key:"onEvent",value:function(e,t){}},{key:"getName",value:function(){return"EventDrivenPlugin"}}]),t}();paella.EventDrivenPlugin=EventDrivenPlugin}(),function(){var e=new(function(){function e(){_classCallCheck(this,e),this._formats={},paella.pluginManager.setTarget("captionParser",this)}return _createClass(e,[{key:"addPlugin",value:function(e){var t=this,a=e.ext;0==(Array.isArray&&Array.isArray(a)||a instanceof Array)&&(a=[a]),0==a.length?base.log.debug("No extension provided by the plugin "+e.getName()):(base.log.debug("New captionParser added: "+e.getName()),a.forEach(function(a){t._formats[a]=e}))}}]),e}()),t=function(e){function t(e,a){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).name="captionSearchCallback",n.caption=e,n.text=a,n}return _inherits(t,base.AsyncLoaderCallback),_createClass(t,[{key:"load",value:function(e,t){var a=this;this.caption.search(this.text,function(n,i){n?t():(a.result=i,e())})}}]),t}();paella.captions={parsers:{},_captions:{},_activeCaption:void 0,addCaptions:function(e){var t=e._captionsProvider+":"+e._id;this._captions[t]=e,paella.events.trigger(paella.events.captionAdded,t)},getAvailableLangs:function(){var e=[],t=this;return Object.keys(this._captions).forEach(function(a){var n=t._captions[a];e.push({id:a,lang:n._lang})}),e},getCaptions:function(e){if(e&&this._captions[e])return this._captions[e]},getActiveCaptions:function(e){return this._activeCaption},setActiveCaptions:function(e){return this._activeCaption=this.getCaptions(e),null!=this._activeCaption?paella.events.trigger(paella.events.captionsEnabled,e):paella.events.trigger(paella.events.captionsDisabled),this._activeCaption},getCaptionAtTime:function(e,t){var a=this.getCaptions(e);if(null!=a)return a.getCaptionAtTime(t)},search:function(e,a){var n=this,i=new base.AsyncLoader;this.getAvailableLangs().forEach(function(a){i.addCallback(new t(n.getCaptions(a.id),e))}),i.load(function(){var e=[];Object.keys(i.callbackArray).forEach(function(t){e=e.concat(i.getCallback(t).result)}),a&&a(!1,e)},function(){a&&a(!0)})}};var a=function(){function t(e,a,n,i,r){_classCallCheck(this,t),this._id=e,this._format=a,this._url=n,this._captions=void 0,this._index=lunr(function(){this.ref("id"),this.field("content",{boost:10})}),"string"==typeof i&&(i={code:i,txt:i}),this._lang=i,this._captionsProvider="downloadCaptionsProvider",this.reloadCaptions(r)}return _createClass(t,[{key:"canEdit",value:function(e){e(!1,!1)}},{key:"goToEdit",value:function(){}},{key:"reloadCaptions",value:function(t){var a=this;jQuery.ajax({url:a._url,cache:!1,type:"get",dataType:"text"}).then(function(n){var i=e._formats[a._format];null==i?(base.log.debug("Error adding captions: Format not supported!"),paella.player.videoContainer.duration(!0).then(function(e){a._captions=[{id:0,begin:0,end:e,content:base.dictionary.translate("Error! Captions format not supported.")}],t&&t(!0)})):i.parse(n,a._lang.code,function(e,n){e||(a._captions=n,a._captions.forEach(function(e){a._index.add({id:e.id,content:e.content})})),t&&t(e)})}).fail(function(e){base.log.debug("Error loading captions: "+a._url),t&&t(!0)})}},{key:"getCaptions",value:function(){return this._captions}},{key:"getCaptionAtTime",value:function(e){if(null!=this._captions)for(var t=0;t<this._captions.length;++t){var a=this._captions[t];if(a.begin<=e&&a.end>=e)return a}}},{key:"getCaptionById",value:function(e){if(null!=this._captions)for(var t=0;t<this._captions.length;++t){var a=this._captions[t];if(a.id==e)return a}}},{key:"search",value:function(e,t){var a=this,n=this;if(null==this._index)t&&t(!0,"Error. No captions found.");else{var i=[];paella.player.videoContainer.trimming().then(function(r){a._index.search(e).forEach(function(e){var t=n.getCaptionById(e.ref);r.enabled&&(t.end<r.start||t.begin>r.end)||i.push({time:t.begin,content:t.content,score:e.score})}),t&&t(!1,i)})}}}]),t}();paella.captions.Caption=a;var n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.FastLoadPlugin),_createClass(t,[{key:"getIndex",value:function(){return-1}},{key:"parse",value:function(e,t,a){throw new Error("paella.CaptionParserPlugIn#parse must be overridden by subclass")}},{key:"type",get:function(){return"captionParser"}},{key:"ext",get:function(){return this._ext||(this._ext=[]),this._ext}}]),t}();paella.CaptionParserPlugIn=n}(),function(){var e={_plugins:[],addPlugin:function(e){this._plugins.push(e)},initialize:function(){paella.pluginManager.setTarget("SearchServicePlugIn",this)}},t=function(e){function t(e,a){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).name="searchCallback",n.plugin=e,n.text=a,n}return _inherits(t,base.AsyncLoaderCallback),_createClass(t,[{key:"load",value:function(e,t){var a=this;this.plugin.search(this.text,function(n,i){n?t():(a.result=i,e())})}}]),t}();paella.searchService={search:function(a,n){var i=new base.AsyncLoader;paella.userTracking.log("paella:searchService:search",a),e._plugins.forEach(function(e){i.addCallback(new t(e,a))}),i.load(function(){var e=[];Object.keys(i.callbackArray).forEach(function(t){e=e.concat(i.getCallback(t).result)}),n&&n(!1,e)},function(){n&&n(!0)})}};var a=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.FastLoadPlugin),_createClass(t,[{key:"getIndex",value:function(){return-1}},{key:"search",value:function(e,t){throw new Error("paella.SearchServicePlugIn#search must be overridden by subclass")}},{key:"type",get:function(){return"SearchServicePlugIn"}}]),t}();paella.SearchServicePlugIn=a}(),function(){var e={_plugins:[],addPlugin:function(e){var t=this;e.checkEnabled(function(a){a&&(e.setup(),t._plugins.push(e))})},initialize:function(){paella.pluginManager.setTarget("userTrackingSaverPlugIn",this)}};paella.userTracking={},e.initialize();var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.FastLoadPlugin),_createClass(t,[{key:"getIndex",value:function(){return-1}},{key:"checkEnabled",value:function(e){e(!0)}},{key:"log",value:function(e,t){throw new Error("paella.userTracking.SaverPlugIn#log must be overridden by subclass")}},{key:"type",get:function(){return"userTrackingSaverPlugIn"}}]),t}();paella.userTracking.SaverPlugIn=t;var a={};paella.userTracking.log=function(t,n){null!=a[t]&&a[t].cancel(),a[t]=new base.Timer(function(i){e._plugins.forEach(function(e){e.log(t,n)}),delete a[t]},500)},[paella.events.play,paella.events.pause,paella.events.endVideo,paella.events.showEditor,paella.events.hideEditor,paella.events.enterFullscreen,paella.events.exitFullscreen,paella.events.loadComplete].forEach(function(e){paella.events.bind(e,function(t,a){paella.userTracking.log(e)})}),[paella.events.showPopUp,paella.events.hidePopUp].forEach(function(e){paella.events.bind(e,function(t,a){paella.userTracking.log(e,a.identifier)})}),[paella.events.captionsEnabled,paella.events.captionsDisabled].forEach(function(e){paella.events.bind(e,function(t,a){var n;if(null!=a){var i=paella.captions.getCaptions(a);n={id:a,lang:i._lang,url:i._url}}paella.userTracking.log(e,n)})}),[paella.events.setProfile].forEach(function(e){paella.events.bind(e,function(t,a){paella.userTracking.log(e,a.profileName)})}),[paella.events.seekTo,paella.events.seekToTime].forEach(function(e){paella.events.bind(e,function(t,a){var n;try{JSON.stringify(a),n=a}catch(e){}paella.userTracking.log(e,n)})}),[paella.events.setVolume,paella.events.resize,paella.events.setPlaybackRate,paella.events.qualityChanged].forEach(function(e){paella.events.bind(e,function(t,a){var n;try{JSON.stringify(a),n=a}catch(e){}paella.userTracking.log(e,n)})})}(),function(){var e=function(e){function t(e){var a;_classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,{left:"0%"}))).domElement.className="timeControlOld",a.domElement.className="timeControl";var n=_assertThisInitialized(a);return paella.events.bind(paella.events.timeupdate,function(e,t){n.onTimeUpdate(t)}),a}return _inherits(t,paella.DomNode),_createClass(t,[{key:"onTimeUpdate",value:function(e){this.domElement.innerText=this.secondsToHours(parseInt(e.currentTime))}},{key:"secondsToHours",value:function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),n=e-3600*t-60*a;return t<10&&(t="0"+t),a<10&&(a="0"+a),n<10&&(n="0"+n),t+":"+a+":"+n}}]),t}();paella.TimeControl=e;var t=function(e){function t(e){var a;_classCallCheck(this,t);(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,{}))).playbackFullId="",a.updatePlayBar=!0,a.timeControlId="",a._images=null,a._keys=null,a._prev=null,a._next=null,a._videoLength=null,a._lastSrc=null,a._aspectRatio=1.777777778,a._hasSlides=null,a._imgNode=null,a._canvas=null,a.domElement.className="playbackBar",a.domElement.setAttribute("alt",""),a.domElement.setAttribute("aria-label","Timeline Slider"),a.domElement.setAttribute("role","slider"),a.domElement.setAttribute("aria-valuemin","0"),a.domElement.setAttribute("aria-valuemax","100"),a.domElement.setAttribute("aria-valuenow","0"),a.domElement.setAttribute("tabindex","1100"),$(a.domElement).keyup(function(e){var t=0,a=0;paella.player.videoContainer.currentTime().then(function(e){return t=e,paella.player.videoContainer.duration()}).then(function(n){var i;switch(a=n,e.keyCode){case 37:i=100*t/a-5,paella.player.videoContainer.seekTo(i);break;case 39:i=100*t/a+5,paella.player.videoContainer.seekTo(i)}})}),a.playbackFullId=e+"_full",a.timeControlId=e+"_timeControl";var n=new paella.DomNode("div",a.playbackFullId,{width:"0%"});n.domElement.className="playbackBarFull",a.addNode(n),a.addNode(new paella.TimeControl(a.timeControlId));var i=_assertThisInitialized(a);return paella.events.bind(paella.events.timeupdate,function(e,t){i.onTimeUpdate(t)}),$(a.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(i,e),e.stopPropagation()}),$(n.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(i,e),e.stopPropagation()}),base.userAgent.browser.IsMobileVersion||($(a.domElement).bind("mousemove",function(e){i.movePassive(e),paella.utils.mouseManager.move(e)}),$(n.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)}),$(a.domElement).bind("mouseout",function(e){i.mouseOut(e)})),$(a.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)}),$(n.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)}),paella.player.isLiveStream()&&$(a.domElement).hide(),paella.events.bind(paella.events.seekAvailabilityChanged,function(e,t){t.enabled?$(n.domElement).removeClass("disabled"):$(n.domElement).addClass("disabled")}),a}return _inherits(t,paella.DomNode),_createClass(t,[{key:"mouseOut",value:function(e){this._hasSlides?$("#divTimeImageOverlay").remove():$("#divTimeOverlay").remove()}},{key:"drawTimeMarks",value:function(){var e=this,t={};paella.player.videoContainer.trimming().then(function(a){return t=a,e.imageSetup()}).then(function(){t.enabled?(t.end,t.start):e._videoLength;var a=$("#playerContainer_controls_playback_playbackBar");e.clearCanvas(),e._keys&&paella.player.config.player.slidesMarks.enabled&&e._keys.forEach(function(n){var i=parseInt(n)-t.start;if(i>0){var r=i*a.width()/e._videoLength;e.drawTimeMark(r)}})})}},{key:"drawTimeMark",value:function(e){var t=this.getCanvasContext();t.fillStyle=paella.player.config.player.slidesMarks.color,t.fillRect(e,0,1,12)}},{key:"clearCanvas",value:function(){this._canvas&&this.getCanvasContext().clearRect(0,0,this._canvas.width,this._canvas.height)}},{key:"getCanvas",value:function(){if(!this._canvas){var e=$("#playerContainer_controls_playback_playbackBar"),t=document.createElement("canvas");t.className="playerContainer_controls_playback_playbackBar_canvas",t.id="playerContainer_controls_playback_playbackBar_canvas",t.width=e.width();t.height=e.height();e.prepend(t),this._canvas=document.getElementById("playerContainer_controls_playback_playbackBar_canvas")}return this._canvas}},{key:"getCanvasContext",value:function(){return this.getCanvas().getContext("2d")}},{key:"movePassive",value:function(e){var t=this;paella.player.videoContainer.duration();var a=0;paella.player.videoContainer.duration().then(function(e){return a=e,paella.player.videoContainer.trimming()}).then(function(n){!function(a,n){var i=$(t.domElement),r=i.offset(),o=i.width(),l=e.clientX-r.left,s=100*(l=l<0?0:l)/o*a/100;n.enabled&&(s+=n.start);var u=Math.floor((s-n.start)/3600)%24;u=("00"+u).slice(u.toString().length);var c=Math.floor((s-n.start)/60)%60;c=("00"+c).slice(c.toString().length);var d=Math.floor((s-n.start)%60),p=u+":"+c+":"+(d=("00"+d).slice(d.toString().length));if(t._hasSlides?(0==$("#divTimeImageOverlay").length?t.setupTimeImageOverlay(p,r.top,o):$("#divTimeOverlay")[0].innerText=p,t.imageUpdate(s)):0==$("#divTimeOverlay").length?t.setupTimeOnly(p,r.top,o):$("#divTimeOverlay")[0].innerText=p,t._hasSlides){var h=$("#divTimeImageOverlay").width(),v=e.clientX-h/2;e.clientX>h/2+r.left&&e.clientX<r.left+o-h/2?$("#divTimeImageOverlay").css("left",v):e.clientX<o/2?$("#divTimeImageOverlay").css("left",r.left):$("#divTimeImageOverlay").css("left",r.left+o-h)}var f=$("#divTimeOverlay").width(),m=e.clientX-f/2;e.clientX>f/2+r.left&&e.clientX<r.left+o-f/2?$("#divTimeOverlay").css("left",m):e.clientX<o/2?$("#divTimeOverlay").css("left",r.left):$("#divTimeOverlay").css("left",r.left+o-f-2),t._hasSlides&&$("#divTimeImageOverlay").css("bottom",$(".playbackControls").height())}(a,n)})}},{key:"imageSetup",value:function(){var e=this;return new Promise(function(t){paella.player.videoContainer.duration().then(function(a){e._images={};var n=paella.initDelegate.initParams.videoLoader.frameList;n&&0!==Object.keys(n).length?(e._hasSlides=!0,e._images=n,e._videoLength=a,e._keys=Object.keys(e._images),e._keys=e._keys.sort(function(e,t){return parseInt(e)-parseInt(t)}),e._next=0,e._prev=0,t()):e._hasSlides=!1})})}},{key:"imageUpdate",value:function(e){var t=$("#imgOverlay").attr("src");if($(this._imgNode).show(),e>this._next||e<this._prev)(t=this.getPreviewImageSrc(e))?(this._lastSrc=t,$("#imgOverlay").attr("src",t)):this.hideImg();else{if(null!=t)return;$("#imgOverlay").attr("src",this._lastSrc)}}},{key:"hideImg",value:function(){$(this._imgNode).hide()}},{key:"getPreviewImageSrc",value:function(e){var t=Object.keys(this._images);t.push(e),t.sort(function(e,t){return parseInt(e)-parseInt(t)});var a=t.indexOf(e)-1,n=t[a=a>0?a:0],i=t[a+2],r=t[a];return i=null==i?t.length-1:parseInt(i),this._next=i,r=null==r?0:parseInt(r),this._prev=r,n=parseInt(n),!!this._images[n]&&(this._images[n].url||this._images[n].url)}},{key:"setupTimeImageOverlay",value:function(e,t,a){var n=document.createElement("div");n.className="divTimeImageOverlay",n.id="divTimeImageOverlay";var i=Math.round(a/10);if(n.style.width=Math.round(i*self._aspectRatio)+"px",this._hasSlides){var r=document.createElement("img");r.className="imgOverlay",r.id="imgOverlay",this._imgNode=r,n.appendChild(r)}var o=document.createElement("div");o.className="divTimeOverlay",o.style.top=t-20+"px",o.id="divTimeOverlay",o.innerText=e,n.appendChild(o),$(this.domElement).parent().append(n)}},{key:"setupTimeOnly",value:function(e,t,a){var n=document.createElement("div");n.className="divTimeOverlay",n.style.top=t-20+"px",n.id="divTimeOverlay",n.innerText=e,$(this.domElement).parent().append(n)}},{key:"playbackFull",value:function(){return this.getNode(this.playbackFullId)}},{key:"timeControl",value:function(){return this.getNode(this.timeControlId)}},{key:"setPlaybackPosition",value:function(e){this.playbackFull().domElement.style.width=e+"%"}},{key:"isSeeking",value:function(){return!this.updatePlayBar}},{key:"onTimeUpdate",value:function(e){if(this.updatePlayBar){var t=e.currentTime,a=e.duration;this.setPlaybackPosition(100*t/a)}}},{key:"down",value:function(e,t,a){this.updatePlayBar=!1,this.move(e,t,a)}},{key:"move",value:function(e,t,a){var n=$(this.domElement).width(),i=t-$(this.domElement).offset().left;i=i<0?0:i>n?100:100*i/n,this.setPlaybackPosition(i)}},{key:"up",value:function(e,t,a){var n=$(this.domElement).width(),i=t-$(this.domElement).offset().left;i=i<0?0:i>n?100:100*i/n,paella.player.videoContainer.seekTo(i),this.updatePlayBar=!0}},{key:"onresize",value:function(){var e=$("#playerContainer_controls_playback_playbackBar");this.getCanvas().width=e.width(),this.drawTimeMarks()}}]),t}();paella.PlaybackBar=t;var a=function(e){function t(e){var a;_classCallCheck(this,t);(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,{}))).playbackBarId="",a.pluginsContainer=null,a._popUpPluginContainer=null,a._timeLinePluginContainer=null,a.playbackPluginsWidth=0,a.popupPluginsWidth=0,a.minPlaybackBarSize=120,a.playbackBarInstance=null,a.buttonPlugins=[],a.domElement.className="playbackControls",a.playbackBarId=e+"_playbackBar";_assertThisInitialized(a);return a.pluginsContainer=new paella.DomNode("div",e+"_playbackBarPlugins"),a.pluginsContainer.domElement.className="playbackBarPlugins",a.pluginsContainer.domElement.setAttribute("role","toolbar"),a.addNode(a.pluginsContainer),a.addNode(new paella.PlaybackBar(a.playbackBarId)),paella.pluginManager.setTarget("button",_assertThisInitialized(a)),$(window).mousemove(function(e){a._expandedPlugin&&$(window).height()-e.clientY>50&&(a._expandedPlugin.contract(),a._expandPlugin=null)}),a}return _inherits(t,paella.DomNode),_createClass(t,[{key:"addPlugin",value:function(e){var t=this,a="buttonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(e);var n=paella.ButtonPlugin.BuildPluginButton(e,a);n.plugin=e;var i=paella.ButtonPlugin.BuildPluginExpand(e,a);if(e.button=n,e._expandElement=i,this.pluginsContainer.domElement.appendChild(n),i){var r=this;$(n).mouseover(function(e){e.target.plugin.expand(),r._expandedPlugin=e.target.plugin}),this.pluginsContainer.domElement.appendChild(i)}$(n).hide(),e.checkEnabled(function(a){var i;if(a){$(e.button).show(),paella.pluginManager.setupPlugin(e);var r="buttonPlugin"+t.buttonPlugins.length;if(e.getButtonType()==paella.ButtonPlugin.type.popUpButton){i=t.popUpPluginContainer.domElement;var o=paella.ButtonPlugin.BuildPluginPopUp(i,e,r+"_container");t.popUpPluginContainer.registerContainer(e.getName(),o,n,e)}else if(e.getButtonType()==paella.ButtonPlugin.type.timeLineButton){i=t.timeLinePluginContainer.domElement;var l=paella.ButtonPlugin.BuildPluginPopUp(i,e,r+"_timeline");t.timeLinePluginContainer.registerContainer(e.getName(),l,n,e)}}else t.pluginsContainer.domElement.removeChild(e.button)})}}]),_createClass(t,[{key:"showPopUp",value:function(e,t){this.popUpPluginContainer.showContainer(e,t),this.timeLinePluginContainer.showContainer(e,t)}},{key:"hidePopUp",value:function(e,t){this.popUpPluginContainer.hideContainer(e,t),this.timeLinePluginContainer.hideContainer(e,t)}},{key:"playbackBar",value:function(){return null==this.playbackBarInstance&&(this.playbackBarInstance=this.getNode(this.playbackBarId)),this.playbackBarInstance}},{key:"onresize",value:function(){var e=$(this.domElement).width();base.log.debug("resize playback bar (width="+e+")");for(var t=0;t<this.buttonPlugins.length;++t){var a=this.buttonPlugins[t],n=a.getMinWindowSize();n>0&&e<n?a.hideUI():a.checkVisibility()}this.getNode(this.playbackBarId).onresize()}},{key:"popUpPluginContainer",get:function(){return this._popUpPluginContainer||(this._popUpPluginContainer=new paella.PopUpContainer(this.identifier+"_popUpPluginContainer","popUpPluginContainer"),this.addNode(this._popUpPluginContainer)),this._popUpPluginContainer}},{key:"timeLinePluginContainer",get:function(){return this._timeLinePluginContainer||(this._timeLinePluginContainer=new paella.TimelineContainer(this.identifier+"_timelinePluginContainer","timelinePluginContainer"),this.addNode(this._timeLinePluginContainer)),this._timeLinePluginContainer}}]),t}();paella.PlaybackControl=a;var n=function(e){function t(e){var a;_classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e))).playbackControlId="",a.editControlId="",a.isEnabled=!0,a.autohideTimer=null,a.hideControlsTimeMillis=3e3,a.playbackControlInstance=null,a.videoOverlayButtons=null,a.buttonPlugins=[],a._hidden=!1,a._over=!1,a.viewControlId=e+"_view",a.playbackControlId=e+"_playback",a.editControlId=e+"_editor",a.addNode(new paella.PlaybackControl(a.playbackControlId));var n=_assertThisInitialized(a);return paella.events.bind(paella.events.showEditor,function(e){n.onShowEditor()}),paella.events.bind(paella.events.hideEditor,function(e){n.onHideEditor()}),paella.events.bind(paella.events.play,function(e){n.onPlayEvent()}),paella.events.bind(paella.events.pause,function(e){n.onPauseEvent()}),$(document).mousemove(function(e){paella.player.controls.restartHideTimer()}),$(a.domElement).bind("mousemove",function(e){n._over=!0}),$(a.domElement).bind("mouseout",function(e){n._over=!1}),paella.events.bind(paella.events.endVideo,function(e){n.onEndVideoEvent()}),paella.events.bind("keydown",function(e){n.onKeyEvent()}),a.videoOverlayButtons=new paella.DomNode("div",e+"_videoOverlayButtonPlugins"),a.videoOverlayButtons.domElement.className="videoOverlayButtonPlugins",a.videoOverlayButtons.domElement.setAttribute("role","toolbar"),a.addNode(a.videoOverlayButtons),paella.pluginManager.setTarget("videoOverlayButton",_assertThisInitialized(a)),a}return _inherits(t,paella.DomNode),_createClass(t,[{key:"addPlugin",value:function(e){var t="videoOverlayButtonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(e);var a=paella.ButtonPlugin.BuildPluginButton(e,t);this.videoOverlayButtons.domElement.appendChild(a),e.button=a,$(a).hide(),e.checkEnabled(function(t){t&&($(e.button).show(),paella.pluginManager.setupPlugin(e))})}}]),_createClass(t,[{key:"onShowEditor",value:function(){var e=this.editControl();e&&$(e.domElement).hide()}},{key:"onHideEditor",value:function(){var e=this.editControl();e&&$(e.domElement).show()}},{key:"enterEditMode",value:function(){var e=this.playbackControl(),t=this.editControl();e&&t&&$(e.domElement).hide()}},{key:"exitEditMode",value:function(){var e=this.playbackControl(),t=this.editControl();e&&t&&$(e.domElement).show()}},{key:"playbackControl",value:function(){return null==this.playbackControlInstance&&(this.playbackControlInstance=this.getNode(this.playbackControlId)),this.playbackControlInstance}},{key:"editControl",value:function(){return this.getNode(this.editControlId)}},{key:"disable",value:function(){this.isEnabled=!1,this.hide()}},{key:"enable",value:function(){this.isEnabled=!0,this.show()}},{key:"isHidden",value:function(){return this._hidden}},{key:"hide",value:function(){var e=this;function t(){e._doHide&&($(e.domElement).css({opacity:0}),$(e.domElement).hide(),e.domElement.setAttribute("aria-hidden","true"),e._hidden=!0,paella.events.trigger(paella.events.controlBarDidHide))}this._doHide=!0,paella.events.trigger(paella.events.controlBarWillHide),this._doHide&&(base.userAgent.browser.IsMobileVersion||base.userAgent.browser.Explorer?t():$(this.domElement).animate({opacity:0},{duration:300,complete:t}))}},{key:"showPopUp",value:function(e){this.playbackControl().showPopUp(e)}},{key:"hidePopUp",value:function(e){this.playbackControl().hidePopUp(e)}},{key:"show",value:function(){this.isEnabled&&($(this.domElement).stop(),this._doHide=!1,this.domElement.style.opacity=1,this.domElement.setAttribute("aria-hidden","false"),this._hidden=!1,$(this.domElement).show(),paella.events.trigger(paella.events.controlBarDidShow))}},{key:"autohideTimeout",value:function(){this.playbackControl().playbackBar().isSeeking()||this._over?paella.player.controls.restartHideTimer():paella.player.controls.hideControls()}},{key:"hideControls",value:function(){var e=this;paella.player.videoContainer.paused().then(function(t){t?e.show():e.hide()})}},{key:"showControls",value:function(){this.show()}},{key:"onPlayEvent",value:function(){this.restartHideTimer()}},{key:"onPauseEvent",value:function(){this.clearAutohideTimer()}},{key:"onEndVideoEvent",value:function(){this.show(),this.clearAutohideTimer()}},{key:"onKeyEvent",value:function(){this.restartHideTimer(),paella.player.videoContainer.paused().then(function(e){e||paella.player.controls.restartHideTimer()})}},{key:"cancelHideBar",value:function(){this.restartTimerEvent()}},{key:"restartTimerEvent",value:function(){var e=this;this.isHidden()&&this.showControls(),this._doHide=!1,paella.player.videoContainer.paused(function(t){t||e.restartHideTimer()})}},{key:"clearAutohideTimer",value:function(){null!=this.autohideTimer&&(this.autohideTimer.cancel(),this.autohideTimer=null)}},{key:"restartHideTimer",value:function(){this.showControls(),this.clearAutohideTimer();var e=this;this.autohideTimer=new base.Timer(function(t){e.autohideTimeout()},this.hideControlsTimeMillis)}},{key:"onresize",value:function(){this.playbackControl().onresize()}}]),t}();paella.ControlsContainer=n}(),function(){var e=function(e){function t(e){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"div",e,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:1e4}))).timer=null,a.loader=null,a.loaderPosition=0,a.loader=a.addNode(new paella.DomNode("i","",{width:"100px",height:"100px",color:"black",display:"block",marginLeft:"auto",marginRight:"auto",marginTop:"32%",fontSize:"100px"})),a.loader.domElement.className="icon-spinner",paella.events.bind(paella.events.loadComplete,function(e,t){a.loadComplete(t)}),a.timer=new base.Timer(function(e){a.loader.domElement.style.transform="rotate(".concat(a.loaderPosition,"deg"),a.loaderPosition+=45},250),a.timer.repeat=!0,a}return _inherits(t,paella.DomNode),_createClass(t,[{key:"loadComplete",value:function(e){$(this.domElement).hide(),this.timer.repeat=!1}}]),t}();paella.LoaderContainer=e,paella.Keys={Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.FastLoadPlugin),_createClass(t,[{key:"onKeyPress",value:function(e){return console.log(e),!1}},{key:"type",get:function(){return"keyboard"}}]),t}();paella.KeyPlugin=t;var a=function(){function e(){_classCallCheck(this,e),this._isPlaying=!1;var t=this;paella.events.bind(paella.events.loadComplete,function(e,a){t.loadComplete(e,a)}),paella.events.bind(paella.events.play,function(e){t.onPlay()}),paella.events.bind(paella.events.pause,function(e){t.onPause()}),paella.pluginManager.setTarget("keyboard",this),this._pluginList=[]}return _createClass(e,[{key:"isPlaying",get:function(){return this._isPlaying},set:function(e){this._isPlaying=e}},{key:"enabled",get:function(){return void 0===this._enabled||this._enabled},set:function(e){this._enabled=e}}]),_createClass(e,[{key:"addPlugin",value:function(e){var t=this;e.checkEnabled(function(a){t._pluginList.push(e),e.setup()})}},{key:"loadComplete",value:function(e,t){var a=this;paella.events.bind("keyup",function(e){a.keyUp(e)})}},{key:"onPlay",value:function(){this.isPlaying=!0}},{key:"onPause",value:function(){this.isPlaying=!1}},{key:"keyUp",value:function(e){this.enabled&&this._pluginList.some(function(t){return t.onKeyPress(e)})}}]),e}();paella.keyManager=new a}(),function(){var e=function(){function e(){_classCallCheck(this,e),this.metadata={title:"",duration:0},this.streams=[],this.frameList=[],this.loadStatus=!1,this.codecStatus=!1}return _createClass(e,[{key:"getMetadata",value:function(){return this.metadata}},{key:"getVideoId",value:function(){return paella.initDelegate.getId()}},{key:"getVideoUrl",value:function(){return""}},{key:"getDataUrl",value:function(){}},{key:"loadVideo",value:function(e){e()}}]),e}();paella.VideoLoader=e;var t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canRead",value:function(){return paella_DeferredResolved(!0)}},{key:"canWrite",value:function(){return paella_DeferredResolved(!1)}},{key:"userData",value:function(){return paella_DeferredResolved({username:"anonymous",name:"Anonymous",avatar:paella.utils.folders.resources()+"/images/default_avatar.png",isAnonymous:!0})}},{key:"getAuthenticationUrl",value:function(e){var t=this._authParams.authCallbackName&&window[this._authParams.authCallbackName];return!t&&paella.player.config.auth&&(t=paella.player.config.auth.authCallbackName&&window[paella.player.config.auth.authCallbackName]),"function"==typeof t?t(e):""}}]),e}();paella.AccessControl=t;var a=function(){function e(t){if(_classCallCheck(this,e),this.config=null,this.playerId="",this.mainContainer=null,this.videoContainer=null,this.controls=null,this.accessControl=null,null!=base.parameters.get("log")){var a=0;switch(base.parameters.get("log")){case"error":a=base.Log.kLevelError;break;case"warn":a=base.Log.kLevelWarning;break;case"debug":a=base.Log.kLevelDebug;break;case"log":case"true":a=base.Log.kLevelLog}base.log.setLevel(a)}if(this.checkCompatibility()){paella.player=this,this.playerId=t,this.mainContainer=$("#"+this.playerId)[0];var n=this;paella.events.bind(paella.events.loadComplete,function(e,t){n.loadComplete(e,t)})}else base.log.debug("It seems that your browser is not HTML 5 compatible")}return _createClass(e,[{key:"checkCompatibility",value:function(){var e="";if(base.parameters.get("ignoreBrowserCheck"))return!0;if(base.userAgent.browser.IsMobileVersion)return!0;if(base.userAgent.browser.Chrome||base.userAgent.browser.Safari||base.userAgent.browser.Firefox||base.userAgent.browser.Opera||base.userAgent.browser.Edge||base.userAgent.browser.Explorer&&base.userAgent.browser.Version.major>=9)return!0;var t=base.dictionary.translate("It seems that your browser is not HTML 5 compatible");return paella.events.trigger(paella.events.error,{error:t}),e=t+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="'+paella.utils.folders.resources()+'images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="'+paella.utils.folders.resources()+'images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>',e+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+base.dictionary.translate("Continue anyway")+"</a></div>",paella.messageBox.showError(e,{height:"40%"}),!1}}]),_createClass(e,[{key:"loadComplete",value:function(e,t){}},{key:"repoUrl",get:function(){return paella.player.videoLoader._url||paella.player.config.standalone&&paella.player.config.standalone.repository}},{key:"videoUrl",get:function(){return paella.player.videoLoader.getVideoUrl()}},{key:"dataUrl",get:function(){return paella.player.videoLoader.getDataUrl()}},{key:"videoId",get:function(){return paella.initDelegate.getId()}},{key:"auth",get:function(){return{login:function(e){e=e||window.location.href;var t=paella.initDelegate.initParams.accessControl.getAuthenticationUrl(e);t&&(window.location.href=t)},canRead:function(){return paella.initDelegate.initParams.accessControl.canRead()},canWrite:function(){return paella.initDelegate.initParams.accessControl.canWrite()},userData:function(){return paella.initDelegate.initParams.accessControl.userData()}}}}]),e}();paella.PlayerBase=a;var n=function(){function e(t){if(_classCallCheck(this,e),2==arguments.length&&(this._config=arguments[0]),t)for(var a in t)this.initParams[a]=t[a];this.initParams.getId||(this.initParams.getId=function(){return base.parameters.get("id")||"noid"})}return _createClass(e,[{key:"initParams",get:function(){return this._initParams||(this._initParams={configUrl:paella.baseUrl+"config/config.json",dictionaryUrl:paella.baseUrl+"localization/paella",accessControl:null,videoLoader:null}),this._initParams}}]),_createClass(e,[{key:"getId",value:function(){return this.initParams.getId()}},{key:"loadDictionary",value:function(){var e=this;return new Promise(function(t){base.ajax.get({url:e.initParams.dictionaryUrl+"_"+base.dictionary.currentLanguage()+".json"},function(e,a,n){base.dictionary.addDictionary(e),t(e)},function(e,a,n){t()})})}},{key:"loadConfig",value:function(){var e=this,t=function(t){var a=Class.fromString(t.player.accessControlClass||"paella.AccessControl");e.initParams.accessControl=new a};return this.initParams.config?new Promise(function(a){t(e.initParams.config),a(e.initParams.config)}):this.initParams.loadConfig?new Promise(function(a,n){e.initParams.loadConfig(e.initParams.configUrl).then(function(e){t(e),a(e)}).catch(function(e){n(e)})}):new Promise(function(a,n){var i=e.initParams.configUrl,r={};r.url=i,base.ajax.get(r,function(e,n,i){try{e=JSON.parse(e)}catch(e){}t(e),a(e)},function(e,t,a){paella.messageBox.showError(base.dictionary.translate("Error! Config file not found. Please configure paella!"))})})}}]),e}();paella.InitDelegate=n,window.paellaPlayer=null,paella.plugins={},paella.plugins.events={},paella.initDelegate=null}(),function(){var e=function(e){function t(e){var a;if(_classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).player=null,a.videoIdentifier="",a.loader=null,a.videoData=null,a.playerId==e){a.loadPaellaPlayer();_assertThisInitialized(a)}return a}return _inherits(t,paella.PlayerBase),_createClass(t,[{key:"getPlayerMode",value:function(){return paella.player.isFullScreen()?paella.PaellaPlayer.mode.fullscreen:window.self!==window.top?paella.PaellaPlayer.mode.embed:paella.PaellaPlayer.mode.standard}},{key:"checkFullScreenCapability",value:function(){var e=document.getElementById(paella.player.mainContainer.id);return!!(e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.requestFullScreen)||!(!base.userAgent.browser.IsMobileVersion||!paella.player.videoContainer.isMonostream)}},{key:"addFullScreenListeners",value:function(){var e=this,t=function(){setTimeout(function(){paella.pluginManager.checkPluginsVisibility()},1e3);var t=document.getElementById(paella.player.mainContainer.id);paella.player.isFullScreen()?(t.style.width="100%",t.style.height="100%"):(t.style.width="",t.style.height=""),e.isFullScreen()?paella.events.trigger(paella.events.enterFullscreen):paella.events.trigger(paella.events.exitFullscreen)};this.eventFullScreenListenerAdded||(this.eventFullScreenListenerAdded=!0,document.addEventListener("fullscreenchange",t,!1),document.addEventListener("webkitfullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),document.addEventListener("MSFullscreenChange",t,!1),document.addEventListener("webkitendfullscreen",t,!1))}},{key:"isFullScreen",value:function(){var e=!0===document.webkitIsFullScreen,t=void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement,a=!0===document.mozFullScreen,n=void 0!==document.fullScreenElement&&null!==document.fullScreenElement;return e||t||a||n}},{key:"goFullScreen",value:function(){if(!this.isFullScreen())if(base.userAgent.system.iOS&&(paella.utils.userAgent.browser.Version.major<12||!paella.utils.userAgent.system.iPad))paella.player.videoContainer.masterVideo().goFullScreen();else{var e=document.getElementById(paella.player.mainContainer.id);e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.requestFullScreen&&e.requestFullScreen()}}},{key:"exitFullScreen",value:function(){this.isFullScreen()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen()?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen())}},{key:"setProfile",value:function(e,t){paella.profiles.setProfile(e,t)&&(paella.player.getProfile(e)&&!paella.player.videoContainer.isMonostream&&base.cookies.set("lastProfile",e),paella.events.trigger(paella.events.setProfile,{profileName:e}))}},{key:"getProfile",value:function(e){return paella.profiles.getProfile(e)}}]),_createClass(t,[{key:"loadPaellaPlayer",value:function(){var e=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader"),$("body")[0].appendChild(this.loader.domElement),paella.events.trigger(paella.events.loadStarted),paella.initDelegate.loadDictionary().then(function(){return paella.initDelegate.loadConfig()}).then(function(t){if(e.accessControl=paella.initDelegate.initParams.accessControl,e.videoLoader=paella.initDelegate.initParams.videoLoader,e.onLoadConfig(t),t.skin){var a=t.skin.default||"dark";paella.utils.skin.restore(a)}})}},{key:"onLoadConfig",value:function(e){if(paella.data=new paella.Data(e),paella.pluginManager.registerPlugins(),this.config=e,this.videoIdentifier=paella.initDelegate.getId(),this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");var t=new paella.BestFitVideoQualityStrategy;try{var a=this.config.player.videoQualityStrategy;t=new(Class.fromString(a))}catch(e){base.log.warning("Error selecting video quality strategy: strategy not found")}this.videoContainer.setVideoQualityStrategy(t),this.mainContainer.appendChild(this.videoContainer.domElement)}$(window).resize(function(e){paella.player.onresize()}),this.onload()}paella.pluginManager.loadPlugins("paella.FastLoadPlugin")}},{key:"onload",value:function(){var e=this,t=(this.accessControl,!1),a={};this.accessControl.canRead().then(function(a){return t=a,e.accessControl.userData()}).then(function(n){if(a=n,t)e.loadVideo();else if(a.isAnonymous){var i=paella.initDelegate.initParams.accessControl.getAuthenticationUrl("player/?id="+paella.player.videoIdentifier),r="<div>"+base.dictionary.translate("You are not authorized to view this resource")+"</div>";i&&(r+='<div class="login-link"><a href="'+i+'">'+base.dictionary.translate("Login")+"</a></div>"),e.unloadAll(r)}else{var o=base.dictionary.translate("You are not authorized to view this resource");e.unloadAll(o),paella.events.trigger(paella.events.error,{error:o})}}).catch(function(t){var a=base.dictionary.translate(t);e.unloadAll(a),paella.events.trigger(paella.events.error,{error:a})})}},{key:"onresize",value:function(){if(this.videoContainer.onresize(),this.controls&&this.controls.onresize(),this.videoContainer.ready){var e=paella.utils.cookies.get("lastProfile");e?this.setProfile(e,!1):this.setProfile(paella.player.selectedProfile,!1)}paella.events.trigger(paella.events.resize,{width:$(this.videoContainer.domElement).width(),height:$(this.videoContainer.domElement).height()})}},{key:"unloadAll",value:function(e){$("#paellaPlayer_loader")[0];this.mainContainer.innerText="",paella.messageBox.showError(e)}},{key:"reloadVideos",value:function(e,t){this.videoContainer&&(this.videoContainer.reloadVideos(e,t),this.onresize())}},{key:"loadVideo",value:function(){if(this.videoIdentifier){var e=this,t=paella.player.videoLoader;this.onresize(),t.loadVideo(function(){e.videoContainer.setStreamData(t.streams).then(function(){paella.events.trigger(paella.events.loadComplete),e.addFullScreenListeners(),e.onresize(),e.videoContainer.autoplay()&&e.play()}).catch(function(e){console.log(e)})})}}},{key:"showPlaybackBar",value:function(){this.controls||(this.controls=new paella.ControlsContainer(this.playerId+"_controls"),this.mainContainer.appendChild(this.controls.domElement),this.controls.onresize(),paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager}))}},{key:"isLiveStream",value:function(){if(void 0===this._isLiveStream){var e=paella.initDelegate.initParams.videoLoader,t=function(e,t){if(e.length>t){var a=e[t];for(var n in a.sources)if("object"==_typeof(a.sources[n]))for(var i=0;i<a.sources[n].length;++i){if(a.sources[n][i].isLiveStream)return!0}}return!1};this._isLiveStream=t(e.streams,0)||t(e.streams,1)}return this._isLiveStream}},{key:"loadPreviews",value:function(){var e=paella.initDelegate.initParams.videoLoader.streams,t=null,a=e[0].preview;if(e.length>=2&&(t=e[1].preview),a){var n=paella.player.videoContainer.overlayContainer.getVideoRect(0);this.masterPreviewElem=document.createElement("img"),this.masterPreviewElem.src=a,paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,n)}if(t){var i=paella.player.videoContainer.overlayContainer.getVideoRect(1);this.slavePreviewElem=document.createElement("img"),this.slavePreviewElem.src=t,paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,i)}paella.events.bind(paella.events.timeUpdate,function(e){paella.player.unloadPreviews()})}},{key:"unloadPreviews",value:function(){this.masterPreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem),this.masterPreviewElem=null),this.slavePreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem),this.slavePreviewElem=null)}},{key:"loadComplete",value:function(e,t){paella.pluginManager.loadPlugins("paella.EarlyLoadPlugin"),paella.player.videoContainer._autoplay&&this.play()}},{key:"play",value:function(){var e=this;return new Promise(function(t,a){e.videoContainer.play().then(function(){e.controls||(e.showPlaybackBar(),paella.events.trigger(paella.events.controlBarLoaded),e.controls.onresize()),t()}).catch(function(e){a(e)})})}},{key:"pause",value:function(){return this.videoContainer.pause()}},{key:"playing",value:function(){var e=this;return new Promise(function(t){e.paused().then(function(e){t(!e)})})}},{key:"paused",value:function(){return this.videoContainer.paused()}},{key:"selectedProfile",get:function(){return paella.profiles.currentProfileName}}]),t}();paella.PaellaPlayer=e,window.PaellaPlayer=e,paella.PaellaPlayer.mode={standard:"standard",fullscreen:"fullscreen",embed:"embed"},window.initPaellaEngage=function(t,a){a||(a=new paella.InitDelegate),paella.initDelegate=a,paellaPlayer=new e(t,paella.initDelegate)}}(),function(){var e=function(e){function t(e){var a;if(_classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)))._url=null,"object"==_typeof(e))a._data=e;else try{a._data=JSON.parse(e)}catch(t){a._url=e}return a}return _inherits(t,paella.VideoLoader),_createClass(t,[{key:"getVideoUrl",value:function(){if(paella.initDelegate.initParams.videoUrl)return"function"==typeof paella.initDelegate.initParams.videoUrl?paella.initDelegate.initParams.videoUrl():paella.initDelegate.initParams.videoUrl;var e=this._url||paella.player.config.standalone&&paella.player.config.standalone.repository||"";return(/\/$/.test(e)?e:e+"/")+paella.initDelegate.getId()+"/"}},{key:"getDataUrl",value:function(){return paella.initDelegate.initParams.dataUrl?"function"==typeof paella.initDelegate.initParams.dataUrl?paella.initDelegate.initParams.dataUrl():paella.initDelegate.initParams.dataUrl:this.getVideoUrl()+"data.json"}},{key:"loadVideo",value:function(e){var t=this,a=paella.initDelegate.initParams.loadVideo,n=this._url||this.getDataUrl();if(this._data)this.loadVideoData(this._data,e);else if(a)a().then(function(a){t._data=a,t.loadVideoData(t._data,e)});else if(n){var i=this;base.ajax.get({url:this.getDataUrl()},function(t,a,n){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}i._data=t,i.loadVideoData(i._data,e)},function(e,t,a){switch(a){case 401:paella.messageBox.showError(base.dictionary.translate("You are not logged in"));break;case 403:paella.messageBox.showError(base.dictionary.translate("You are not authorized to view this resource"));break;case 404:paella.messageBox.showError(base.dictionary.translate("The specified video identifier does not exist"));break;default:paella.messageBox.showError(base.dictionary.translate("Could not load the video"))}})}}},{key:"loadVideoData",value:function(e,t){var a=this;e.metadata&&(this.metadata=e.metadata),e.streams&&e.streams.forEach(function(e){a.loadStream(e)}),e.frameList&&this.loadFrameData(e),e.captions&&this.loadCaptions(e.captions),e.blackboard&&this.loadBlackboard(e.streams[0],e.blackboard),this.streams=e.streams,this.frameList=e.frameList,this.loadStatus=this.streams.length>0,t()}},{key:"loadFrameData",value:function(e){var t=this;if(e.frameList&&e.frameList.forEach){var a={};e.frameList.forEach(function(e){/^[a-zA-Z]+:\/\//.test(e.url)||/^data:/.test(e.url)||(e.url=t.getVideoUrl()+e.url),!e.thumb||/^[a-zA-Z]+:\/\//.test(e.thumb)||/^data:/.test(e.thumb)||(e.thumb=t.getVideoUrl()+e.thumb);var n=e.time;a[n]=e}),e.frameList=a}}},{key:"loadStream",value:function(e){var t=this;for(var a in!e.preview||/^[a-zA-Z]+:\/\//.test(e.preview)||/^data:/.test(e.preview)||(e.preview=t.getVideoUrl()+e.preview),e.sources.image&&e.sources.image.forEach(function(e){if(e.frames.forEach){var a={};e.frames.forEach(function(e){!e.src||/^[a-zA-Z]+:\/\//.test(e.src)||/^data:/.test(e.src)||(e.src=t.getVideoUrl()+e.src),!e.thumb||/^[a-zA-Z]+:\/\//.test(e.thumb)||/^data:/.test(e.thumb)||(e.thumb=t.getVideoUrl()+e.thumb);var n="frame_"+e.time;a[n]=e.src}),e.frames=a}}),e.sources){if(e.sources[a]){if("image"!=a)e.sources[a].forEach(function(e){"string"==typeof e.src&&null==e.src.match(/^[a-zA-Z\:]+\:\/\//gi)&&(e.src=t.getVideoUrl()+e.src),e.type=e.mimetype})}else delete e.sources[a]}}},{key:"loadCaptions",value:function(e){if(e)for(var t=0;t<e.length;++t){var a=e[t].url;/^[a-zA-Z]+:\/\//.test(a)||(a=this.getVideoUrl()+a);var n=new paella.captions.Caption(t,e[t].format,a,{code:e[t].lang,txt:e[t].text});paella.captions.addCaptions(n)}}},{key:"loadBlackboard",value:function(e,t){var a=this;e.sources.image||(e.sources.image=[]);var n={count:t.frames.length,duration:t.duration,mimetype:t.mimetype,res:t.res,frames:{}};t.frames.forEach(function(e){var t="frame_"+Math.round(e.time);/^[a-zA-Z]+:\/\//.test(e.src)||(e.src=a.getVideoUrl()+e.src),n.frames[t]=e.src}),e.sources.image.push(n)}}]),t}();paella.DefaultVideoLoader=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.InitDelegate),t}();paella.DefaultInitDelegate=t,paella.load=function(e,t){var a;t&&t.auth;if(a=paella.utils.parameters.get("video")){var n=paella.utils.parameters.get("videoSlave");n=n&&decodeURIComponent(n);var i=paella.utils.parameters.get("preview");i=i&&decodeURIComponent(i);var r=paella.utils.parameters.get("previewSlave");r=r&&decodeURIComponent(r);var o={metadata:{title:paella.utils.parameters.get("preview")||"Untitled Video"},streams:[{sources:{mp4:[{src:decodeURIComponent(a),mimetype:"video/mp4",res:{w:0,h:0}}]},preview:i}]};n&&o.streams.push({sources:{mp4:[{src:n,mimetype:"video/mp4",res:{w:0,h:0}}]},preview:r}),t.data=o}var l=t;l.videoLoader=new paella.DefaultVideoLoader(t.data||t.url),paella.initDelegate=new paella.DefaultInitDelegate(l),new PaellaPlayer(e,paella.initDelegate)}}(),function(){var e=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.DeferredLoadPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.RightBarPlugin"}},{key:"buildContent",value:function(e){}},{key:"type",get:function(){return"rightBarPlugin"}}]),t}();paella.RightBarPlugin=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.DeferredLoadPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.TabBarPlugin"}},{key:"getTabName",value:function(){return"New Tab"}},{key:"action",value:function(e){}},{key:"buildContent",value:function(e){}},{key:"setToolTip",value:function(e){this.button.setAttribute("title",e),this.button.setAttribute("aria-label",e)}},{key:"getDefaultToolTip",value:function(){return""}},{key:"type",get:function(){return"tabBarPlugin"}}]),t}();paella.TabBarPlugin=t;var a=function(){function e(){_classCallCheck(this,e),this.rightContainer=null,this.bottomContainer=null,this.rightBarPlugins=[],this.tabBarPlugins=[],this.currentTabIndex=0,this.bottomContainerTabs=null,this.bottomContainerContent=null,this.rightContainer=document.createElement("div"),this.rightContainer.className="rightPluginContainer",this.bottomContainer=document.createElement("div"),this.bottomContainer.className="tabsPluginContainer";var t=document.createElement("div");t.className="tabsLabelContainer",this.bottomContainerTabs=t,this.bottomContainer.appendChild(t);var a=document.createElement("div");a.className="tabsContentContainer",this.bottomContainerContent=a,this.bottomContainer.appendChild(a),this.initPlugins()}return _createClass(e,[{key:"initPlugins",value:function(){paella.pluginManager.setTarget("rightBarPlugin",this),paella.pluginManager.setTarget("tabBarPlugin",this)}},{key:"addPlugin",value:function(e){var t=this;e.checkEnabled(function(a){a&&(paella.pluginManager.setupPlugin(e),"rightBarPlugin"==e.type&&(t.rightBarPlugins.push(e),t.addRightBarPlugin(e)),"tabBarPlugin"==e.type&&(t.tabBarPlugins.push(e),t.addTabPlugin(e)))})}},{key:"showTab",value:function(e){var t=0,a=this.bottomContainer.getElementsByClassName("tabLabel"),n=this.bottomContainer.getElementsByClassName("tabContent");for(t=0;t<a.length;++t)a[t].getAttribute("tab")==e?a[t].className="tabLabel enabled":a[t].className="tabLabel disabled";for(t=0;t<n.length;++t)n[t].getAttribute("tab")==e?n[t].className="tabContent enabled":n[t].className="tabContent disabled"}},{key:"addTabPlugin",value:function(e){var t=this,a=this.currentTabIndex,n=document.createElement("div");n.setAttribute("tab",a),n.className="tabLabel disabled",n.innerText=e.getTabName(),n.plugin=e,$(n).click(function(e){/disabled/.test(this.className)&&(t.showTab(a),this.plugin.action(this))}),$(n).keyup(function(e){13==e.keyCode&&/disabledTabItem/.test(this.className)&&(t.showTab(a),this.plugin.action(this))}),this.bottomContainerTabs.appendChild(n);var i=document.createElement("div");i.setAttribute("tab",a),i.className="tabContent disabled "+e.getSubclass(),this.bottomContainerContent.appendChild(i),e.buildContent(i),e.button=n,e.container=i,e.button.setAttribute("tabindex",3e3+e.getIndex()),e.button.setAttribute("alt",""),e.setToolTip(e.getDefaultToolTip()),void 0===this.firstTabShown&&(this.showTab(a),this.firstTabShown=!0),++this.currentTabIndex}},{key:"addRightBarPlugin",value:function(e){var t=document.createElement("div");t.className="rightBarPluginContainer "+e.getSubclass(),this.rightContainer.appendChild(t),e.buildContent(t)}}]),e}();paella.ExtendedAdapter=a,paella.extendedAdapter=new paella.ExtendedAdapter}(),DeprecatedClass("paella.Dictionary","base.Dictionary",base.Dictionary),paella.dictionary=base.dictionary,DeprecatedClass("paella.AsyncLoaderCallback","base.AsyncLoaderCallback",base.AsyncLoaderCallback),DeprecatedClass("paella.AjaxCallback","base.AjaxCallback",base.AjaxCallback),DeprecatedClass("paella.JSONCallback","base.JSONCallback",base.JSONCallback),DeprecatedClass("paella.DictionaryCallback","base.DictionaryCallback",base.DictionaryCallback),DeprecatedClass("paella.AsyncLoader","base.AsyncLoader",base.AsyncLoader),DeprecatedClass("paella.Timer","base.Timer",base.Timer),DeprecatedClass("paella.utils.Timer","base.Timer",base.Timer),paella.ajax={},paella.ajax.send=DeprecatedFunc("paella.ajax.send","base.ajax.send",base.ajax.send),paella.ajax.get=DeprecatedFunc("paella.ajax.get","base.ajax.get",base.ajax.get),paella.ajax.put=DeprecatedFunc("paella.ajax.put","base.ajax.put",base.ajax.put),paella.ajax.post=DeprecatedFunc("paella.ajax.post","base.ajax.post",base.ajax.post),paella.ajax.delete=DeprecatedFunc("paella.ajax.delete","base.ajax.delete",base.ajax.send),paella.ui={},paella.ui.Container=function(e){var t=document.createElement("div");return e.id&&(t.id=e.id),e.className&&(t.className=e.className),e.style&&$(t).css(e.style),t},paella.utils.ajax=base.ajax,paella.utils.cookies=base.cookies,paella.utils.parameters=base.parameters,paella.utils.require=base.require,paella.utils.importStylesheet=base.importStylesheet,paella.utils.language=base.dictionary.currentLanguage,paella.utils.uuid=base.uuid,paella.utils.userAgent=base.userAgent,paella.debug={log:function(e){base.log.warning("paella.debug.log is deprecated, use base.debug.[error/warning/debug/log] instead."),base.log.log(e)}},paella.debugReady=!0,paella.addPlugin(function(){var e=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"left"}},{key:"getName",value:function(){return"edu.harvard.dce.paella.flexSkipPlugin"}},{key:"getIndex",value:function(){return 121}},{key:"getSubclass",value:function(){return"flexSkip_Rewind_10"}},{key:"getIconClass",value:function(){return"icon-back-10-s"}},{key:"formatMessage",value:function(){return"Rewind 10 seconds"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate(this.formatMessage())}},{key:"getMinWindowSize",value:function(){return 510}},{key:"checkEnabled",value:function(e){e(!paella.player.isLiveStream())}},{key:"action",value:function(e){paella.player.videoContainer.currentTime().then(function(e){paella.player.videoContainer.seekToTime(e-10)})}}]),t}();return paella.plugins.FlexSkipPlugin=e,e}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.plugins.FlexSkipPlugin),_createClass(t,[{key:"getIndex",value:function(){return 122}},{key:"getName",value:function(){return"edu.harvard.dce.paella.flexSkipForwardPlugin"}},{key:"getSubclass",value:function(){return"flexSkip_Forward_30"}},{key:"getIconClass",value:function(){return"icon-forward-30-s"}},{key:"formatMessage",value:function(){return"Forward 30 seconds"}},{key:"action",value:function(e){paella.player.videoContainer.currentTime().then(function(e){paella.player.videoContainer.seekToTime(e+30)})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.CaptionParserPlugIn),_createClass(t,[{key:"getName",value:function(){return"es.teltek.paella.captions.WebVTTParserPlugin"}},{key:"parse",value:function(e,t,a){for(var n,i=[],r=e.split("\n"),o=0,l=!1,s=0;s<r.length;++s){var u=r[s].trim();/^WEBVTT/.test(u)&&void 0===n||0===u.length||((/^[0-9]+$/.test(u)||/^[0-9]+ -/.test(u))&&0===r[s-1].trim().length||(/^NOTE/.test(u)||/^STYLE/.test(u)?l=!0:/^(([0-9]+:)?[0-9]{2}:[0-9]{2}.[0-9]{3} --> ([0-9]+:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.test(u)?(l=!1,null!=n&&(i.push(n),o++),n={id:o,begin:this.parseTimeTextToSeg(u.split("--\x3e")[0]),end:this.parseTimeTextToSeg(u.split("--\x3e")[1])}):void 0===n||l||(u=(u=u.replace(/^- /,"")).replace(/<[^>]*>/g,""),void 0===n.content?n.content=u:n.content+="<br/>"+u)))}i.push(n),i.length>0?a(!1,i):a(!0)}},{key:"parseTimeTextToSeg",value:function(e){for(var t=0,a=1,n=(e=/(([0-9]+:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.exec(e))[0].split(":"),i=n.length-1;i>=0;i--)a=Math.pow(60,n.length-1-i),t+=n[i]*a;return t}},{key:"ext",get:function(){return["vtt"]}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.userTracking.SaverPlugIn),_createClass(t,[{key:"getName",value:function(){return"es.teltek.paella.usertracking.xAPISaverPlugin"}},{key:"setup",value:function(){this.endpoint=this.config.endpoint,this.auth=this.config.auth,this.user_info={},this.paused=!0,this.played_segments="",this.played_segments_segment_start=null,this.played_segments_segment_end=null,this.progress=0,this.duration=0,this.current_time=[],this.completed=!1,this.volume=null,this.speed=null,this.language="us-US",this.quality=null,this.fullscreen=!1,this.title="No title available",this.description="",this.user_agent="",this.total_time=0,this.total_time_start=0,this.total_time_end=0,this.session_id="";var e=this;this._loadDeps().then(function(){var t={endpoint:e.endpoint,auth:"Basic "+toBase64(e.auth)};ADL.XAPIWrapper.changeConfig(t)}),paella.events.bind(paella.events.timeUpdate,function(t,a){e.current_time.push(a.currentTime),e.current_time.length>=10&&(e.current_time=e.current_time.slice(-10));var n=Math.round(e.current_time[0]),i=Math.round(e.current_time[9]);0!==a.currentTime&&n+1>=i&&i-1>=n&&(e.progress=e.get_progress(a.currentTime,a.duration),e.progress>=.95&&!1===e.completed&&(e.completed=!0,e.end_played_segment(a.currentTime),e.start_played_segment(a.currentTime),e.send_completed(a.currentTime,e.progress)))})}},{key:"get_session_data",value:function(){var e=ADL.XAPIWrapper.searchParams(),t=JSON.stringify({mbox:this.user_info.email}),a=new Date;a.setDate(a.getDate()-1),a=a.toISOString(),e.activity=window.location.href,e.verb="http://adlnet.gov/expapi/verbs/terminated",e.since=a,e.limit=1,e.agent=t;var n=ADL.XAPIWrapper.getStatements(e);1===n.statements.length?(this.played_segments=n.statements[0].result.extensions["https://w3id.org/xapi/video/extensions/played-segments"],this.progress=n.statements[0].result.extensions["https://w3id.org/xapi/video/extensions/progress"],ADL.XAPIWrapper.lrs.registration=n.statements[0].context.registration):ADL.XAPIWrapper.lrs.registration=ADL.ruuid()}},{key:"getCookie",value:function(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;n++){for(var i=a[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}},{key:"setCookie",value:function(e,t,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var i="expires="+n.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}},{key:"checkCookie",value:function(){var e=this.getCookie("user_info");return""===e&&(e=JSON.stringify(generateName())),this.setCookie("user_info",e),JSON.parse(e)}},{key:"checkEnabled",value:function(e){this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking",e(!0)}},{key:"_loadDeps",value:function(){return new Promise(function(e,t){window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/xapiwrapper.min.js"],function(){require(["resources/deps/random_name_generator.js"],function(){window.$paella_bg2e=!0,e(window.$paella_bg2e)})})})}},{key:"log",value:function(e,t){var a=this;switch(e){case"paella:loadComplete":this.user_agent=navigator.userAgent.toString(),this.get_title(),this.get_description(),paella.player.videoContainer.duration().then(function(e){return paella.player.videoContainer.streamProvider.mainAudioPlayer.volume().then(function(t){return paella.player.videoContainer.getCurrentQuality().then(function(n){return paella.player.auth.userData().then(function(i){a.duration=e,a.volume=t,a.speed=1,paella.player.videoContainer.streamProvider.mainAudioPlayer.stream.language&&(a.language=paella.player.videoContainer.streamProvider.mainAudioPlayer.stream.language.replace("_","-")),a.quality=n.shortLabel(),i.email&&i.name?a.user_info=i:a.user_info=a.checkCookie(),a.get_session_data(),a.send_initialized()})})})}),window.onbeforeunload=function(e){a.paused||a.send_pause(a),a.send_terminated(a)};break;case"paella:play":this.send_play(a);break;case"paella:pause":this.send_pause(a);break;case"paella:seektotime":this.send_seek(a,t);break;case"paella:setVolume":paella.player.videoContainer.currentTime().then(function(e){var n=a.format_float(e);a.volume=t.master;var i={"https://w3id.org/xapi/video/extensions/volume":a.format_float(t.master)};a.send_interacted(n,i)});break;case"paella:setplaybackrate":paella.player.videoContainer.currentTime().then(function(e){var n=a.format_float(e);a.speed=t.rate;var i={"https://w3id.org/xapi/video/extensions/speed":t.rate+"x"};a.send_interacted(n,i)});break;case"paella:qualityChanged":paella.player.videoContainer.currentTime().then(function(e){return paella.player.videoContainer.getCurrentQuality().then(function(t){a.quality=t.shortLabel();var n=a.format_float(e),i={"https://w3id.org/xapi/video/extensions/quality":t.shortLabel()};a.send_interacted(n,i)})});break;case"paella:enterFullscreen":case"paella:exitFullscreen":paella.player.videoContainer.currentTime().then(function(e){var t=a.format_float(e);a.fullscreen?a.fullscreen=!1:a.fullscreen=!0;var n={"https://w3id.org/xapi/video/extensions/full-screen":a.fullscreen};a.send_interacted(t,n)})}}},{key:"send",value:function(e){var t=new ADL.XAPIStatement.Agent(this.user_info.email,this.user_info.name),a=new ADL.XAPIStatement.Verb(e.verb.id,e.verb.description),n=new ADL.XAPIStatement.Activity(window.location.href,this.title,this.description);n.definition.type="https://w3id.org/xapi/video/activity-type/video",paella.player.videoContainer.streamProvider.mainAudioPlayer.volume().then(function(e){});var i=new ADL.XAPIStatement(t,a,n);i.result=e.result,"http://adlnet.gov/expapi/verbs/initialized"===e.verb.id&&(i.generateId(),this.session_id=i.id);var r={"https://w3id.org/xapi/video/extensions/session-id":this.session_id,"https://w3id.org/xapi/video/extensions/length":Math.floor(this.duration),"https://w3id.org/xapi/video/extensions/user-agent":this.user_agent},o={"https://w3id.org/xapi/video/extensions/volume":this.format_float(this.volume),"https://w3id.org/xapi/video/extensions/speed":this.speed+"x","https://w3id.org/xapi/video/extensions/quality":this.quality,"https://w3id.org/xapi/video/extensions/full-screen":this.fullscreen},l={};l=e.interacted?$.extend({},r,e.interacted):$.extend({},r,o),i.context={language:this.language,extensions:l,contextActivities:{category:[{objectType:"Activity",id:"https://w3id.org/xapi/video"}]}};ADL.XAPIWrapper.sendStatement(i)}},{key:"send_initialized",value:function(){this.send({verb:{id:"http://adlnet.gov/expapi/verbs/initialized",description:"initalized"}})}},{key:"send_terminated",value:function(e){paella.player.videoContainer.currentTime().then(function(t){var a={verb:{id:"http://adlnet.gov/expapi/verbs/terminated",description:"terminated"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":t,"https://w3id.org/xapi/video/extensions/progress":e.progress,"https://w3id.org/xapi/video/extensions/played-segments":e.played_segments}}};e.send(a)})}},{key:"send_play",value:function(e){this.paused=!1,this.total_time_start=(new Date).getTime()/1e3,paella.player.videoContainer.currentTime().then(function(t){var a=e.format_float(t);a<=1&&(a=0),e.start_played_segment(a);var n={verb:{id:"https://w3id.org/xapi/video/verbs/played",description:"played"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":a}}};e.send(n)})}},{key:"send_pause",value:function(e){this.paused=!0,this.total_time_end=(new Date).getTime()/1e3,this.total_time+=this.total_time_end-this.total_time_start,paella.player.videoContainer.currentTime().then(function(t){var a=e.format_float(t);0===a&&(a=e.duration),e.end_played_segment(a);var n={verb:{id:"https://w3id.org/xapi/video/verbs/paused",description:"paused"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":a,"https://w3id.org/xapi/video/extensions/progress":e.progress,"https://w3id.org/xapi/video/extensions/played-segments":e.played_segments}}};e.send(n)})}},{key:"send_seek",value:function(e,t){var a=this.format_float(t.newPosition),n=this.current_time.filter(function(e){return e<=a-1});0===n.length&&(n=this.current_time.filter(function(e){return e>=a+1}));var i=n.filter(Number).pop();this.current_time=[],this.current_time.push(a),e.progress=e.get_progress(i,e.duration),this.paused||(this.end_played_segment(i),this.start_played_segment(a));var r={verb:{id:"https://w3id.org/xapi/video/verbs/seeked",description:"seeked"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time-from":i,"https://w3id.org/xapi/video/extensions/time-to":a,"https://w3id.org/xapi/video/extensions/progress":e.progress,"https://w3id.org/xapi/video/extensions/played-segments":e.played_segments}}};e.send(r)}},{key:"send_completed",value:function(e,t){var a={verb:{id:"http://adlnet.gov/xapi/verbs/completed",description:"completed"},result:{completion:!0,success:!0,duration:"PT"+this.total_time+"S",extensions:{"https://w3id.org/xapi/video/extensions/time":e,"https://w3id.org/xapi/video/extensions/progress":t,"https://w3id.org/xapi/video/extensions/played-segments":this.played_segments}}};this.send(a)}},{key:"send_interacted",value:function(e,t){var a={verb:{id:"http://adlnet.gov/expapi/verbs/interacted",description:"interacted"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":e}},interacted:t};this.send(a)}},{key:"start_played_segment",value:function(e){this.played_segments_segment_start=e}},{key:"end_played_segment",value:function(e){var t;(t=""===this.played_segments?[]:this.played_segments.split("[,]")).push(this.played_segments_segment_start+"[.]"+e),this.played_segments=t.join("[,]"),this.played_segments_segment_end=e}},{key:"format_float",value:function(e){return e=parseFloat(e),parseFloat(e.toFixed(3))}},{key:"get_title",value:function(){paella.player.videoLoader.getMetadata().i18nTitle?this.title=paella.player.videoLoader.getMetadata().i18nTitle:paella.player.videoLoader.getMetadata().title&&(this.title=paella.player.videoLoader.getMetadata().title)}},{key:"get_description",value:function(){paella.player.videoLoader.getMetadata().i18nTitle?this.description=paella.player.videoLoader.getMetadata().i18nDescription:this.description=paella.player.videoLoader.getMetadata().description}},{key:"get_progress",value:function(e,t){var a,n;a=""===this.played_segments?[]:this.played_segments.split("[,]"),null!=this.played_segments_segment_start&&a.push(this.played_segments_segment_start+"[.]"+e),n=[],a.forEach(function(e,t){n[t]=e.split("[.]"),n[t][0]*=1,n[t][1]*=1}),n.sort(function(e,t){return e[0]-t[0]}),n.forEach(function(e,t){t>0&&n[t][0]<n[t-1][1]&&(n[t][0]=n[t-1][1],n[t][0]>n[t][1]&&(n[t][1]=n[t][0]))});var i=0;return n.forEach(function(e,t){e[1]>e[0]&&(i+=e[1]-e[0])}),1*(i/t).toFixed(2)}}]),t}()}),paella.setMonostreamProfile(function(){return new Promise(function(e,t){e({id:"monostream",name:{es:"Monostream"},hidden:!0,icon:"",videos:[{content:"presenter",visible:!0,layer:1,rect:[{aspectRatio:"1/1",left:280,top:0,width:720,height:720},{aspectRatio:"6/5",left:208,top:0,width:864,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"11/8",left:145,top:0,width:990,height:720},{aspectRatio:"1.41/1",left:132,top:0,width:1015,height:720},{aspectRatio:"1.43/1",left:125,top:0,width:1029,height:720},{aspectRatio:"3/2",left:100,top:0,width:1080,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"1.85/1",left:0,top:14,width:1280,height:692},{aspectRatio:"2.35/1",left:0,top:87,width:1280,height:544},{aspectRatio:"2.41/1",left:0,top:94,width:1280,height:531},{aspectRatio:"2.76/1",left:0,top:128,width:1280,height:463}]}],logos:[{content:"paella_logo.png",zIndex:5,rect:{top:10,left:10,width:49,height:42}}]})})}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.singleStreamProfilePlugin"}},{key:"checkEnabled",value:function(e){this.config.videoSets.forEach(function(t,a){var n=t.content;if(1==n.length){var i=0;paella.player.videoContainer.streamProvider.videoStreams.forEach(function(e){-1!=n.indexOf(e.content)&&i++}),i>=1?(e(!0),paella.addProfile(function(){return new Promise(function(e,a){e({id:t.id,name:{es:"Un stream"},hidden:!1,icon:t.icon,videos:[{content:n[0],rect:[{aspectRatio:"1/1",left:280,top:0,width:720,height:720},{aspectRatio:"6/5",left:208,top:0,width:864,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"11/8",left:145,top:0,width:990,height:720},{aspectRatio:"1.41/1",left:132,top:0,width:1015,height:720},{aspectRatio:"1.43/1",left:125,top:0,width:1029,height:720},{aspectRatio:"3/2",left:100,top:0,width:1080,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"1.85/1",left:0,top:14,width:1280,height:692},{aspectRatio:"2.35/1",left:0,top:87,width:1280,height:544},{aspectRatio:"2.41/1",left:0,top:94,width:1280,height:531},{aspectRatio:"2.76/1",left:0,top:128,width:1280,height:463}],visible:!0,layer:1}],background:{content:"slide_professor_paella.jpg",zIndex:5,rect:{left:0,top:0,width:1280,height:720},visible:!0,layer:0},logos:[{content:"paella_logo.png",zIndex:5,rect:{top:10,left:10,width:49,height:42}}],buttons:[],onApply:function(){}})})})):e(!1)}})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.dualStreamProfilePlugin"}},{key:"checkEnabled",value:function(e){this.config.videoSets.forEach(function(t,a){var n=t.content;if(2==n.length){var i=0;paella.player.videoContainer.streamProvider.videoStreams.forEach(function(e){-1!=n.indexOf(e.content)&&i++}),i>=2?(e(!0),paella.addProfile(function(){return new Promise(function(e,a){e({id:t.id,name:{es:"Dos streams con posicin dinmica"},hidden:!1,icon:t.icon,videos:[{content:n[0],rect:[{aspectRatio:"16/9",left:712,top:302,width:560,height:315},{aspectRatio:"16/10",left:712,top:267,width:560,height:350},{aspectRatio:"4/3",left:712,top:198,width:560,height:420},{aspectRatio:"5/3",left:712,top:281,width:560,height:336},{aspectRatio:"5/4",left:712,top:169,width:560,height:448}],visible:!0,layer:1},{content:n[1],rect:[{aspectRatio:"16/9",left:10,top:225,width:695,height:390},{aspectRatio:"16/10",left:10,top:183,width:695,height:434},{aspectRatio:"4/3",left:10,top:96,width:695,height:521},{aspectRatio:"5/3",left:10,top:200,width:695,height:417},{aspectRatio:"5/4",left:10,top:62,width:695,height:556}],visible:!0,layer:"1"}],background:{content:"slide_professor_paella.jpg",zIndex:5,rect:{left:0,top:0,width:1280,height:720},visible:!0,layer:0},logos:[{content:"paella_logo.png",zIndex:5,rect:{top:10,left:10,width:49,height:42}}],buttons:[{rect:{left:682,top:565,width:45,height:45},onClick:function(e){this.switch()},label:"Switch",icon:"icon_rotate.svg",layer:2},{rect:{left:682,top:515,width:45,height:45},onClick:function(e){this.switchMinimize()},label:"Minimize",icon:"minimize.svg",layer:2}],onApply:function(){},switch:function(){var e=this.videos[0].content,t=this.videos[1].content;this.videos[0].content=t,this.videos[1].content=e,paella.profiles.placeVideos()},switchMinimize:function(){this.minimized?(this.minimized=!1,this.videos=[{content:n[0],rect:[{aspectRatio:"16/9",left:712,top:302,width:560,height:315},{aspectRatio:"16/10",left:712,top:267,width:560,height:350},{aspectRatio:"4/3",left:712,top:198,width:560,height:420},{aspectRatio:"5/3",left:712,top:281,width:560,height:336},{aspectRatio:"5/4",left:712,top:169,width:560,height:448}],visible:!0,layer:1},{content:n[1],rect:[{aspectRatio:"16/9",left:10,top:225,width:695,height:390},{aspectRatio:"16/10",left:10,top:183,width:695,height:434},{aspectRatio:"4/3",left:10,top:96,width:695,height:521},{aspectRatio:"5/3",left:10,top:200,width:695,height:417},{aspectRatio:"5/4",left:10,top:62,width:695,height:556}],visible:!0,layer:2}],this.buttons=[{rect:{left:682,top:565,width:45,height:45},onClick:function(e){this.switch()},label:"Switch",icon:"icon_rotate.svg",layer:2},{rect:{left:682,top:515,width:45,height:45},onClick:function(e){this.switchMinimize()},label:"Minimize",icon:"minimize.svg",layer:2}]):(this.minimized=!0,this.videos=[{content:n[0],rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720}],visible:!0,layer:1},{content:n[1],rect:[{aspectRatio:"16/9",left:50,top:470,width:350,height:197},{aspectRatio:"16/10",left:50,top:448,width:350,height:219},{aspectRatio:"5/3",left:50,top:457,width:350,height:210},{aspectRatio:"5/4",left:50,top:387,width:350,height:280},{aspectRatio:"4/3",left:50,top:404,width:350,height:262}],visible:!0,layer:2}],this.buttons=[{rect:{left:388,top:465,width:45,height:45},onClick:function(e){this.switch()},label:"Switch",icon:"icon_rotate.svg",layer:2},{rect:{left:388,top:415,width:45,height:45},onClick:function(e){this.switchMinimize()},label:"Switch",icon:"minimize.svg",layer:2}]),paella.profiles.placeVideos()}})})})):e(!1)}})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.tripleStreamProfilePlugin"}},{key:"checkEnabled",value:function(e){this.config.videoSets.forEach(function(t,a){var n=t.content;if(3==n.length){var i=0;paella.player.videoContainer.streamProvider.videoStreams.forEach(function(e){-1!=n.indexOf(e.content)&&i++}),i>=3?(e(!0),paella.addProfile(function(){return new Promise(function(e,a){e({id:t.id,name:{es:"Tres streams posicin dinmica"},hidden:!1,icon:t.icon,videos:[{content:n[0],rect:[{aspectRatio:"16/9",left:239,top:17,width:803,height:451}],visible:!0,layer:1},{content:n[1],rect:[{aspectRatio:"16/9",left:44,top:482,width:389,height:218}],visible:!0,layer:1},{content:n[2],rect:[{aspectRatio:"16/9",left:847,top:482,width:389,height:218}],visible:!0,layer:1}],background:{content:"slide_professor_paella.jpg",zIndex:5,rect:{left:0,top:0,width:1280,height:720},visible:!0,layer:0},logos:[{content:"paella_logo.png",zIndex:5,rect:{top:10,left:10,width:49,height:42}}],buttons:[{rect:{left:618,top:495,width:45,height:45},onClick:function(e){this.rotate()},label:"Rotate",icon:"icon_rotate.svg",layer:2}],onApply:function(){},rotate:function(){var e=this.videos[0].content,t=this.videos[1].content,a=this.videos[2].content;this.videos[0].content=a,this.videos[1].content=e,this.videos[2].content=t,paella.profiles.placeVideos()}})})})):e(!1)}})}}]),t}()}),paella.addProfile(function(){return new Promise(function(e,t){paella.events.bind(paella.events.videoReady,function(){var t=paella.player.videoContainer.streamProvider.videoStreams.some(function(e){return"blackboard"==e.content});e(t?{id:"blackboard_video_stream",name:{es:"Pizarra"},hidden:!1,icon:"s_p_blackboard.svg",videos:[{content:"presentation",rect:[{aspectRatio:"16/9",left:10,top:70,width:432,height:243}],visible:!0,layer:1},{content:"blackboard",rect:[{aspectRatio:"16/9",left:450,top:135,width:816,height:459}],visible:!0,layer:1},{content:"presenter",rect:[{aspectRatio:"16/9",left:10,top:325,width:432,height:324}],visible:!0,layer:1}],background:{content:"slide_professor_paella.jpg",zIndex:5,rect:{left:0,top:0,width:1280,height:720},visible:!0,layer:0},logos:[{content:"paella_logo.png",zIndex:5,rect:{top:10,left:10,width:49,height:42}}],buttons:[{rect:{left:422,top:295,width:45,height:45},onClick:function(e){this.rotate()},label:"Rotate",icon:"icon_rotate.svg",layer:2}],rotate:function(){var e=this.videos[0].content,t=this.videos[1].content,a=this.videos[2].content;this.videos[0].content=a,this.videos[1].content=e,this.videos[2].content=t,paella.profiles.placeVideos()}}:null)})})}),paella.addProfile(function(){return new Promise(function(e,t){paella.events.bind(paella.events.videoReady,function(){paella.player.videoContainer.sourceData[0].sources.chroma?e({id:"chroma",name:{es:"Polimedia"},hidden:!1,icon:"chroma.svg",videos:[{content:"presenter",rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720}],visible:"true",layer:"1"},{content:"presentation",rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720}],visible:"true",layer:"0"}],background:{content:"default_background_paella.jpg",zIndex:5,rect:{left:0,top:0,width:1280,height:720},visible:"true",layer:"0"},logos:[{content:"paella_logo.png",zIndex:5,rect:{top:10,left:10,width:49,height:42}}]}):e(null)})})}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.trimmingPlayerPlugin"}},{key:"getEvents",value:function(){return[paella.events.controlBarLoaded,paella.events.showEditor,paella.events.hideEditor]}},{key:"onEvent",value:function(e,t){switch(e){case paella.events.controlBarLoaded:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:paella.player.config.trimming&&paella.player.config.trimming.enabled&&paella.player.videoContainer.enableTrimming()}}},{key:"loadTrimming",value:function(){var e=paella.initDelegate.getId();paella.data.read("trimming",{id:e},function(e,t){if(e&&t&&e.end>0)paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimming(e.start,e.end).then(function(){});else{var a=base.parameters.get("start"),n=base.parameters.get("end");a&&n&&(paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimming(a,n).then(function(){}))}})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getIndex",value:function(){return 552}},{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"AirPlayButton"}},{key:"getIconClass",value:function(){return"icon-airplay"}},{key:"getName",value:function(){return"es.upv.paella.airPlayPlugin"}},{key:"checkEnabled",value:function(e){this._visible=!1,e(window.WebKitPlaybackTargetAvailabilityEvent)}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Emit to AirPlay.")}},{key:"setup",value:function(){var e=this,t=paella.player.videoContainer.masterVideo().video;window.WebKitPlaybackTargetAvailabilityEvent&&t.addEventListener("webkitplaybacktargetavailabilitychanged",function(t){switch(t.availability){case"available":e._visible=!0;break;case"not-available":e._visible=!1}e.updateClassName()})}},{key:"action",value:function(e){paella.player.videoContainer.masterVideo().video.webkitShowPlaybackTargetPicker()}},{key:"updateClassName",value:function(){this.button.className=this.getButtonItemClass(!0)}},{key:"getButtonItemClass",value:function(e){return"buttonPlugin "+this.getSubclass()+" "+this.getAlignment()+" "+(this._visible?"available":"not-available")}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.arrowSlidesNavigatorPlugin"}},{key:"checkEnabled",value:function(e){!paella.initDelegate.initParams.videoLoader.frameList||0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length||paella.player.videoContainer.isMonostream?e(!1):e(!0)}},{key:"setup",value:function(){var e=this;this._showArrowsIn=this.config.showArrowsIn||"slave",this.createOverlay(),e._frames=[];var t=paella.initDelegate.initParams.videoLoader.frameList;if(t){var a=Object.keys(t);a.length,a.map(function(e){return Number(e,10)}).sort(function(e,t){return e-t}).forEach(function(a){e._frames.push(t[a])})}}},{key:"createOverlay",value:function(){var e=this,t=paella.player.videoContainer.overlayContainer;if(!this.arrows){this.arrows=document.createElement("div"),this.arrows.id="arrows",this.arrows.style.marginTop="25%";var a=document.createElement("div");a.className="buttonPlugin arrowSlideNavidator nextButton right icon-next2",this.arrows.appendChild(a);var n=document.createElement("div");n.className="buttonPlugin arrowSlideNavidator prevButton left icon-previous2",this.arrows.appendChild(n),$(a).click(function(t){e.goNextSlide(),t.stopPropagation()}),$(n).click(function(t){e.goPrevSlide(),t.stopPropagation()})}this.container&&t.removeElement(this.container);var i=null,r=null;switch(e._showArrowsIn){case"full":this.container=t.addLayer(),this.container.style.marginRight="0",this.container.style.marginLeft="0",this.arrows.style.marginTop="25%";break;case"master":r=document.createElement("div"),i=t.getVideoRect(0),this.container=t.addElement(r,i),this.visible=i.visible,this.arrows.style.marginTop="23%";break;case"slave":r=document.createElement("div"),i=t.getVideoRect(1),this.container=t.addElement(r,i),this.visible=i.visible,this.arrows.style.marginTop="35%"}this.container.appendChild(this.arrows),this.hideArrows()}},{key:"getCurrentRange",value:function(){var e=this;return new Promise(function(t){if(e._frames.length<1)t(null);else{var a=null;paella.player.videoContainer.duration().then(function(e){return e,paella.player.videoContainer.trimming()}).then(function(e){return a=e,paella.player.videoContainer.currentTime()}).then(function(n){if(!e._frames.some(function(i,r,o){if(r+1!=o.length){var l=0==r?i:e._frames[r-1],s=e._frames[r+1],u=a.enabled?l.time-a.start:l.time,c=a.enabled?i.time-a.start:i.time,d=a.enabled?s.time-a.start:s.time;if(c<n&&d>n||c==n){var p={prev:u,next:d};return u<0&&(p.prev=c>0?c:0),t(p),!0}}})){var i=e._frames[e._frames.length-2].time,r=e._frames[e._frames.length-1].time;t({prev:a.enabled?i-a.start:i,next:a.enabled?r-a.start:r})}})}})}},{key:"goNextSlide",value:function(){this.getCurrentRange().then(function(e){return paella.player.videoContainer.seekToTime(e.next)}).then(function(){paella.player.videoContainer.play()})}},{key:"goPrevSlide",value:function(){this.getCurrentRange().then(function(e){return paella.player.videoContainer.seekToTime(e.prev)}).then(function(){paella.player.videoContainer.play()})}},{key:"showArrows",value:function(){this.visible&&$(this.arrows).show()}},{key:"hideArrows",value:function(){$(this.arrows).hide()}},{key:"getEvents",value:function(){return[paella.events.controlBarDidShow,paella.events.controlBarDidHide,paella.events.setComposition]}},{key:"onEvent",value:function(e,t){switch(e){case paella.events.controlBarDidShow:this.showArrows();break;case paella.events.controlBarDidHide:this.hideArrows();break;case paella.events.setComposition:this.createOverlay()}}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"audioSelector"}},{key:"getIconClass",value:function(){return"icon-headphone"}},{key:"getIndex",value:function(){return 2040}},{key:"getMinWindowSize",value:function(){return 400}},{key:"getName",value:function(){return"es.upv.paella.audioSelector"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Set audio stream")}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"checkEnabled",value:function(e){var t=this;paella.player.videoContainer.getAudioTags().then(function(a){t._tags=a,e(a.length>1)})}},{key:"setup",value:function(){var e=this;this.setTagLabel(),paella.events.bind(paella.events.audioTagChanged,function(){e.setTagLabel()})}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"buildContent",value:function(e){var t=this;this._tags.forEach(function(a){e.appendChild(t.getItemButton(a))})}},{key:"getItemButton",value:function(e){var t=document.createElement("div"),a=paella.player.videoContainer.audioTag,n=paella.dictionary.translate(e);return t.className=this.getButtonItemClass(n,e==a),t.id="audioTagSelectorItem_"+e,t.innerText=n,t.data=e,$(t).click(function(e){$(".videoAudioTrackItem").removeClass("selected"),$(".videoAudioTrackItem."+this.data).addClass("selected"),paella.player.videoContainer.setAudioTag(this.data)}),t}},{key:"setQualityLabel",value:function(){var e=this;paella.player.videoContainer.getCurrentQuality().then(function(t){e.setText(t.shortLabel())})}},{key:"getButtonItemClass",value:function(e,t){return"videoAudioTrackItem "+e+(t?" selected":"")}},{key:"setTagLabel",value:function(){this.setText(paella.player.videoContainer.audioTag)}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.blackBoardPlugin"}},{key:"getIndex",value:function(){return 10}},{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"blackBoardButton2"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("BlackBoard")}},{key:"checkEnabled",value:function(e){this._blackBoardProfile="s_p_blackboard2",this._blackBoardDIV=null,this._hasImages=null,this._active=!1,this._creationTimer=500,this._zImages=null,this._videoLength=null,this._keys=null,this._currentImage=null,this._next=null,this._prev=null,this._lensDIV=null,this._lensContainer=null,this._lensWidth=null,this._lensHeight=null,this._conImg=null,this._zoom=250,this._currentZoom=null,this._maxZoom=500,this._mousePos=null,this._containerRect=null,e(!0)}},{key:"getEvents",value:function(){return[paella.events.setProfile,paella.events.timeUpdate]}},{key:"onEvent",value:function(e,t){var a=this;switch(e){case paella.events.setProfile:if(t.profileName!=a._blackBoardProfile){a._active&&(a.destroyOverlay(),a._active=!1);break}a._hasImages||paella.player.setProfile("slide_professor"),a._hasImages&&!a._active&&(a.createOverlay(),a._active=!0);break;case paella.events.timeUpdate:a._active&&a._hasImages&&paella.player.videoContainer.trimming().then(function(n){n.enabled&&(t.currentTime+=n.start),a.imageUpdate(e,t)})}}},{key:"setup",value:function(){var e=this;if(paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image"))e._hasImages=!0,e._zImages={},e._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,e._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,e._keys=Object.keys(e._zImages),e._keys=e._keys.sort(function(e,t){return e=e.slice(6),t=t.slice(6),parseInt(e)-parseInt(t)});else if(e._hasImages=!1,paella.player.selectedProfile==e._blackBoardProfile){var t=paella.player.config.defaultProfile;paella.player.setProfile(t)}this._next=0,this._prev=0,paella.player.selectedProfile==e._blackBoardProfile&&(e.createOverlay(),e._active=!0),e._mousePos={},paella.Profiles.loadProfile(e._blackBoardProfile,function(t){e._containerRect=t.blackBoardImages})}},{key:"createLens",value:function(){var e=this;null==e._currentZoom&&(e._currentZoom=e._zoom);var t=document.createElement("div");t.className="lensClass",e._lensDIV=t;var a=$(".conImg").offset(),n=$(".conImg").width(),i=$(".conImg").height();t.style.width=n/(e._currentZoom/100)+"px",t.style.height=i/(e._currentZoom/100)+"px",e._lensWidth=parseInt(t.style.width),e._lensHeight=parseInt(t.style.height),$(e._lensContainer).append(t),$(e._lensContainer).mousemove(function(t){var r=t.pageX-a.left,o=t.pageY-a.top;e._mousePos.x=r,e._mousePos.y=o;var l=o-e._lensHeight/2;l=(l=l<0?0:l)>i-e._lensHeight?i-e._lensHeight:l;var s=r-e._lensWidth/2;if(s=(s=s<0?0:s)>n-e._lensWidth?n-e._lensWidth:s,e._lensDIV.style.left=s+"px",e._lensDIV.style.top=l+"px",100!=e._currentZoom){var u=100*s/(n-e._lensWidth),c=100*l/(i-e._lensHeight);e._blackBoardDIV.style.backgroundPosition=u.toString()+"% "+c.toString()+"%"}else if(100==e._currentZoom){var d=100*r/n,p=100*o/i;e._blackBoardDIV.style.backgroundPosition=d.toString()+"% "+p.toString()+"%"}e._blackBoardDIV.style.backgroundSize=e._currentZoom+"%"}),$(e._lensContainer).bind("wheel mousewheel",function(t){(void 0!==t.originalEvent.wheelDelta?t.originalEvent.wheelDelta:-1*t.originalEvent.deltaY)>0&&e._currentZoom<e._maxZoom?e.reBuildLens(10):e._currentZoom>100?e.reBuildLens(-10):100==e._currentZoom&&(e._lensDIV.style.left="0px",e._lensDIV.style.top="0px"),e._blackBoardDIV.style.backgroundSize=e._currentZoom+"%"})}},{key:"reBuildLens",value:function(e){this._currentZoom+=e;$(".conImg").offset();var t=$(".conImg").width(),a=$(".conImg").height();if(this._lensDIV.style.width=t/(this._currentZoom/100)+"px",this._lensDIV.style.height=a/(this._currentZoom/100)+"px",this._lensWidth=parseInt(this._lensDIV.style.width),this._lensHeight=parseInt(this._lensDIV.style.height),100!=this._currentZoom){var n=this._mousePos.x,i=this._mousePos.y-this._lensHeight/2;i=(i=i<0?0:i)>a-this._lensHeight?a-this._lensHeight:i;var r=n-this._lensWidth/2;r=(r=r<0?0:r)>t-this._lensWidth?t-this._lensWidth:r,this._lensDIV.style.left=r+"px",this._lensDIV.style.top=i+"px";var o=100*r/(t-this._lensWidth),l=100*i/(a-this._lensHeight);this._blackBoardDIV.style.backgroundPosition=o.toString()+"% "+l.toString()+"%"}}},{key:"destroyLens",value:function(){this._lensDIV&&($(this._lensDIV).remove(),this._blackBoardDIV.style.backgroundSize="100%",this._blackBoardDIV.style.opacity=0)}},{key:"createOverlay",value:function(){var e=this,t=document.createElement("div");t.className="blackBoardDiv",e._blackBoardDIV=t,e._blackBoardDIV.style.opacity=0;var a=document.createElement("div");a.className="lensContainer",e._lensContainer=a;var n=document.createElement("img");n.className="conImg",e._conImg=n,e._currentImage&&(e._conImg.src=e._currentImage,$(e._blackBoardDIV).css("background-image","url("+e._currentImage+")")),$(a).append(n),$(e._lensContainer).mouseenter(function(){e.createLens(),e._blackBoardDIV.style.opacity=1}),$(e._lensContainer).mouseleave(function(){e.destroyLens()}),setTimeout(function(){var n=paella.player.videoContainer.overlayContainer;n.addElement(t,n.getVideoRect(0)),n.addElement(a,e._containerRect)},e._creationTimer)}},{key:"destroyOverlay",value:function(){this._blackBoardDIV&&$(this._blackBoardDIV).remove(),this._lensContainer&&$(this._lensContainer).remove()}},{key:"imageUpdate",value:function(e,t){var a=this,n=Math.round(t.currentTime),i=$(a._blackBoardDIV).css("background-image");if($(a._blackBoardDIV).length>0){if(a._zImages.hasOwnProperty("frame_"+n)){if(i==a._zImages["frame_"+n])return;i=a._zImages["frame_"+n]}else{if(!(n>a._next||n<a._prev))return;i=a.returnSrc(n)}var r=new Image;r.onload=function(){$(a._blackBoardDIV).css("background-image","url("+i+")")},r.src=i,a._currentImage=i,a._conImg.src=a._currentImage}}},{key:"returnSrc",value:function(e){for(var t=0,a=0;a<this._keys.length;a++){var n=parseInt(this._keys[a].slice(6)),i=parseInt(this._keys[this._keys.length-1].slice(6));if(e<n)return this._next=n,this._prev=t,this._imageNumber=a-1,this._zImages["frame_"+t];if(e>i&&e<this._videoLength)return this._next=this._videoLength,this._prev=i,this._zImages["frame_"+t];t=n}}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.breaksPlayerPlugin"}},{key:"checkEnabled",value:function(e){var t=this;paella.data.read("breaks",{id:paella.initDelegate.getId()},function(a,n){a&&"object"==_typeof(a)&&a.breaks&&a.breaks.length>0&&(t.breaks=a.breaks),e(!0)})}},{key:"getEvents",value:function(){return[paella.events.timeUpdate]}},{key:"onEvent",value:function(e,t){var a=this;t.videoContainer.currentTime(!0).then(function(e){a.checkBreaks(e)})}},{key:"checkBreaks",value:function(e){for(var t,a=0;a<this.breaks.length;++a)(t=this.breaks[a]).s<e&&t.e>e?this.areBreaksClickable()?this.avoidBreak(t):this.showBreaks(t):t.s.toFixed(0)==e.toFixed(0)&&this.avoidBreak(t);if(!this.areBreaksClickable())for(var n in this.visibleBreaks)"object"==_typeof(t)&&(t=this.visibleBreaks[n])&&(t.s>=e||t.e<=e)&&this.removeBreak(t)}},{key:"areBreaksClickable",value:function(){return this.config.neverShow&&!(paella.editor.instance&&paella.editor.instance.isLoaded)}},{key:"showBreaks",value:function(e){if(!this.visibleBreaks[e.s]){var t=e.name||paella.dictionary.translate("Break");e.elem=paella.player.videoContainer.overlayContainer.addText(t,{left:100,top:350,width:1080,height:40}),e.elem.className="textBreak",this.visibleBreaks[e.s]=e}}},{key:"removeBreak",value:function(e){if(this.visibleBreaks[e.s]){var t=this.visibleBreaks[e.s].elem;paella.player.videoContainer.overlayContainer.removeElement(t),this.visibleBreaks[e.s]=null}}},{key:"avoidBreak",value:function(e){var t,a=this;paella.player.videoContainer.trimEnabled()?paella.player.videoContainer.trimming().then(function(n){e.e>=n.end?(t=0,paella.player.videoContainer.pause()):t=e.e+(a.config.neverShow?.5:0)-n.start,paella.player.videoContainer.seekToTime(t)}):paella.player.videoContainer.duration(!0).then(function(n){e.e>=n?(t=0,paella.player.videoContainer.pause()):t=e.e+(a.config.neverShow?.5:0),paella.player.videoContainer.seekToTime(t)})}},{key:"breaks",get:function(){return this._breaks||[]},set:function(e){this._breaks=e}},{key:"lastEvent",get:function(){return this._lastEvent||0},set:function(e){this._lastEvent=e}},{key:"visibleBreaks",get:function(){return this._visibleBreaks||[]},set:function(e){this._visibleBreaks=e}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.CaptionParserPlugIn),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.captions.DFXPParserPlugin"}},{key:"parse",value:function(e,t,a){for(var n=[],i=this,r=$(e),o=r.attr("xml:lang"),l=r.find("div"),s=0;s<l.length;++s){var u=$(l[s]),c=u.attr("xml:lang");if(null!=c&&""!=c||(null==o||""==o?(base.log.debug("No xml:lang found! Using '"+t+"' lang instead."),c=t):c=o),c==t){u.find("p").each(function(e,t){var a={id:e,begin:i.parseTimeTextToSeg(t.getAttribute("begin")),end:i.parseTimeTextToSeg(t.getAttribute("end")),content:$(t).text().trim()};n.push(a)});break}}n.length>0?a(!1,n):a(!0)}},{key:"parseTimeTextToSeg",value:function(e){var t=0;if(/^([0-9]*([.,][0-9]*)?)s/.test(e))t=parseFloat(RegExp.$1);else{var a=e.split(":"),n=parseInt(a[0]),i=parseInt(a[1]);t=parseInt(a[2])+60*i+60*n*60}return t}},{key:"ext",get:function(){return["dfxp"]}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getInstanceName",value:function(){return"captionsPlugin"}},{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"captionsPluginButton"}},{key:"getIconClass",value:function(){return"icon-captions"}},{key:"getName",value:function(){return"es.upv.paella.captionsPlugin"}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Subtitles")}},{key:"getIndex",value:function(){return 509}},{key:"closeOnMouseOut",value:function(){return!1}},{key:"checkEnabled",value:function(e){this._searchTimerTime=1500,this._searchTimer=null,this._pluginButton=null,this._open=0,this._parent=null,this._body=null,this._inner=null,this._bar=null,this._input=null,this._select=null,this._editor=null,this._activeCaptions=null,this._lastSel=null,this._browserLang=null,this._defaultBodyHeight=280,this._autoScroll=!0,this._searchOnCaptions=null,e(!0)}},{key:"showUI",value:function(){paella.captions.getAvailableLangs().length>=1&&_get(_getPrototypeOf(t.prototype),"showUI",this).call(this)}},{key:"setup",value:function(){var e=this;paella.captions.getAvailableLangs().length||paella.plugins.captionsPlugin.hideUI(),paella.events.bind(paella.events.captionsEnabled,function(t,a){e.onChangeSelection(a)}),paella.events.bind(paella.events.captionsDisabled,function(t,a){e.onChangeSelection(a)}),paella.events.bind(paella.events.captionAdded,function(t,a){e.onCaptionAdded(a),paella.plugins.captionsPlugin.showUI()}),paella.events.bind(paella.events.timeUpdate,function(t,a){e._searchOnCaptions&&e.updateCaptionHiglighted(a)}),paella.events.bind(paella.events.controlBarWillHide,function(t){e.cancelHideBar()}),e._activeCaptions=paella.captions.getActiveCaptions(),e._searchOnCaptions=e.config.searchOnCaptions||!1}},{key:"cancelHideBar",value:function(){this._open>0&&paella.player.controls.cancelHideBar()}},{key:"updateCaptionHiglighted",value:function(e){var t=this,a=null;e&&paella.player.videoContainer.trimming().then(function(n){var i=n.enabled?n.start:0,r=paella.captions.getActiveCaptions(),o=r&&r.getCaptionAtTime(e.currentTime+i),l=o&&o.id;null!=l&&((a=$(".bodyInnerContainer[sec-id='"+l+"']"))!=t._lasSel&&$(t._lasSel).removeClass("Highlight"),a&&($(a).addClass("Highlight"),t._autoScroll&&t.updateScrollFocus(l),t._lasSel=a))})}},{key:"updateScrollFocus",value:function(e){var t=0,a=$(".bodyInnerContainer").slice(0,e);(a=a.toArray()).forEach(function(e){var a=$(e).outerHeight(!0);t+=a});var n=parseInt(t/280);$(".captionsBody").scrollTop(n*this._defaultBodyHeight)}},{key:"onCaptionAdded",value:function(e){var t=paella.captions.getCaptions(e),a=document.createElement("option");a.text=t._lang.txt,a.value=e,this._select.add(a)}},{key:"changeSelection",value:function(){var e=$(this._select).val();if(""==e)return $(this._body).empty(),void paella.captions.setActiveCaptions(e);paella.captions.setActiveCaptions(e),this._activeCaptions=e,this._searchOnCaptions&&this.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"),this.setButtonHideShow()}},{key:"onChangeSelection",value:function(e){this._activeCaptions!=e&&($(this._body).empty(),null==e?(this._select.value="",$(this._input).prop("disabled",!0)):($(this._input).prop("disabled",!1),this._select.value=e,this._searchOnCaptions&&this.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list")),this._activeCaptions=e,this.setButtonHideShow())}},{key:"action",value:function(){switch(this._browserLang=base.dictionary.currentLanguage(),this._autoScroll=!0,this._open){case 0:this._browserLang&&null==paella.captions.getActiveCaptions()&&this.selectDefaultBrowserLang(this._browserLang),this._open=1,paella.keyManager.enabled=!1;break;case 1:paella.keyManager.enabled=!0,this._open=0}}},{key:"buildContent",value:function(e){var t=this;t._parent=document.createElement("div"),t._parent.className="captionsPluginContainer",t._bar=document.createElement("div"),t._bar.className="captionsBar",t._searchOnCaptions&&(t._body=document.createElement("div"),t._body.className="captionsBody",t._parent.appendChild(t._body),$(t._body).scroll(function(){t._autoScroll=!1}),t._input=document.createElement("input"),t._input.className="captionsBarInput",t._input.type="text",t._input.id="captionsBarInput",t._input.name="captionsString",t._input.placeholder=base.dictionary.translate("Search captions"),t._bar.appendChild(t._input),$(t._input).change(function(){var e=$(t._input).val();t.doSearch(e)}),$(t._input).keyup(function(){var e=$(t._input).val();null!=t._searchTimer&&t._searchTimer.cancel(),t._searchTimer=new base.Timer(function(a){t.doSearch(e)},t._searchTimerTime)})),t._select=document.createElement("select"),t._select.className="captionsSelector";var a=document.createElement("option");a.text=base.dictionary.translate("None"),a.value="",t._select.add(a),paella.captions.getAvailableLangs().forEach(function(e){var a=document.createElement("option");a.text=e.lang.txt,a.value=e.id,t._select.add(a)}),t._bar.appendChild(t._select),t._parent.appendChild(t._bar),$(t._select).change(function(){t.changeSelection()}),t._editor=document.createElement("button"),t._editor.className="editorButton",t._editor.innerText="",t._bar.appendChild(t._editor),$(t._editor).prop("disabled",!0),$(t._editor).click(function(){var e=paella.captions.getActiveCaptions();paella.userTracking.log("paella:caption:edit",{id:e._captionsProvider+":"+e._id,lang:e._lang}),e.goToEdit()}),e.appendChild(t._parent)}},{key:"selectDefaultBrowserLang",value:function(e){var t=null;paella.captions.getAvailableLangs().forEach(function(a){a.lang.code==e&&(t=a.id)}),t&&paella.captions.setActiveCaptions(t)}},{key:"doSearch",value:function(e){var t=this,a=paella.captions.getActiveCaptions();a&&(""==e?t.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"):a.search(e,function(e,a){e||t.buildBodyContent(a,"search")}))}},{key:"setButtonHideShow",value:function(){var e=$(".editorButton"),t=paella.captions.getActiveCaptions(),a=null;null!=t?($(this._select).width("39%"),t.canEdit(function(e,t){a=t}),a?($(e).prop("disabled",!1),$(e).show()):($(e).prop("disabled",!0),$(e).hide(),$(this._select).width("47%"))):($(e).prop("disabled",!0),$(e).hide(),$(this._select).width("47%")),this._searchOnCaptions||(a?$(this._select).width("92%"):$(this._select).width("100%"))}},{key:"buildBodyContent",value:function(e,t){var a=this;paella.player.videoContainer.trimming().then(function(n){var i=a;$(i._body).empty(),e.forEach(function(e){n.enabled&&(e.end<n.start||e.begin>n.end)||(i._inner=document.createElement("div"),i._inner.className="bodyInnerContainer",i._inner.innerText=e.content,"list"==t&&(i._inner.setAttribute("sec-begin",e.begin),i._inner.setAttribute("sec-end",e.end),i._inner.setAttribute("sec-id",e.id),i._autoScroll=!0),"search"==t&&i._inner.setAttribute("sec-begin",e.time),i._body.appendChild(i._inner),$(i._inner).hover(function(){$(this).css("background-color","rgba(250, 161, 102, 0.5)")},function(){$(this).removeAttr("style")}),$(i._inner).click(function(){var e=$(this).attr("sec-begin");paella.player.videoContainer.trimming().then(function(t){var a=t.enabled?t.start:0;paella.player.videoContainer.seekToTime(e-a+.1)})}))})})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"checkEnabled",value:function(e){this.containerId="paella_plugin_CaptionsOnScreen",this.container=null,this.innerContainer=null,this.top=null,this.actualPos=null,this.lastEvent=null,this.controlsPlayback=null,this.captions=!1,this.captionProvider=null,e(!paella.player.isLiveStream())}},{key:"setup",value:function(){}},{key:"getEvents",value:function(){return[paella.events.controlBarDidHide,paella.events.resize,paella.events.controlBarDidShow,paella.events.captionsEnabled,paella.events.captionsDisabled,paella.events.timeUpdate]}},{key:"onEvent",value:function(e,t){switch(e){case paella.events.controlBarDidHide:if(this.lastEvent==e||0==this.captions)break;this.moveCaptionsOverlay("down");break;case paella.events.resize:if(0==this.captions)break;paella.player.controls.isHidden()?this.moveCaptionsOverlay("down"):this.moveCaptionsOverlay("top");break;case paella.events.controlBarDidShow:if(this.lastEvent==e||0==this.captions)break;this.moveCaptionsOverlay("top");break;case paella.events.captionsEnabled:this.buildContent(t),this.captions=!0,paella.player.controls.isHidden()?this.moveCaptionsOverlay("down"):this.moveCaptionsOverlay("top");break;case paella.events.captionsDisabled:this.hideContent(),this.captions=!1;break;case paella.events.timeUpdate:this.captions&&this.updateCaptions(t)}this.lastEvent=e}},{key:"buildContent",value:function(e){this.captionProvider=e,null==this.container?(this.container=document.createElement("div"),this.container.className="CaptionsOnScreen",this.container.id=this.containerId,this.innerContainer=document.createElement("div"),this.innerContainer.className="CaptionsOnScreenInner",this.container.appendChild(this.innerContainer),null==this.controlsPlayback&&(this.controlsPlayback=$("#playerContainer_controls_playback")),paella.player.videoContainer.domElement.appendChild(this.container)):$(this.container).show()}},{key:"updateCaptions",value:function(e){var t=this;this.captions&&paella.player.videoContainer.trimming().then(function(a){var n=a.enabled?a.start:0,i=paella.captions.getActiveCaptions().getCaptionAtTime(e.currentTime+n);i?($(t.container).show(),t.innerContainer.innerText=i.content,t.moveCaptionsOverlay("auto")):(t.innerContainer.innerText="",t.hideContent())})}},{key:"hideContent",value:function(){$(this.container).hide()}},{key:"moveCaptionsOverlay",value:function(e){if(null==this.controlsPlayback&&(this.controlsPlayback=$("#playerContainer_controls_playback")),"auto"!=e&&null!=e||(e=paella.player.controls.isHidden()?"down":"top"),"down"==e){var t=this.container.offsetHeight;t-=this.innerContainer.offsetHeight+10,this.innerContainer.style.bottom=0-t+"px"}if("top"==e){var a=this.controlsPlayback.offset().top;a-=this.innerContainer.offsetHeight+10,this.innerContainer.style.bottom=0-a+"px"}}},{key:"getIndex",value:function(){return 1050}},{key:"getName",value:function(){return"es.upv.paella.overlayCaptionsPlugin"}}]),t}()}),function(){var e=function(e){function t(e,a,n,i,r,o,l){var s;_classCallCheck(this,t),(s=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,"canvas",n,i,r,o)))._posterFrame=null,s._currentQuality=null,s._autoplay=!1,s._streamName=null,s._streamName=l||"chroma";var u=_assertThisInitialized(s);return s._stream.sources[s._streamName]&&s._stream.sources[s._streamName].sort(function(e,t){return e.res.h-t.res.h}),s.video=null,new paella.Timer(function(e){!function(){if(u.canvasController){var e=u.canvasController.canvas.domElement;u.canvasController.reshape($(e).width(),$(e).height())}}()},500).repeat=!0,s}return _inherits(t,paella.VideoElementBase),_createClass(t,[{key:"defaultProfile",value:function(){return"chroma"}},{key:"_setVideoElem",value:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)}},{key:"_loadDeps",value:function(){return new Promise(function(e,t){window.$paella_bg2e?defer.resolve(window.$paella_bg2e):paella.require(paella.baseUrl+"resources/deps/bg2e.js").then(function(){window.$paella_bg2e=bg,e(window.$paella_bg2e)}).catch(function(e){console.error(e.message),t()})})}},{key:"_deferredAction",value:function(e){var t=this;return new Promise(function(a,n){t.video?a(e()):$(t.video).bind("canplay",function(){t._ready=!0,a(e())})})}},{key:"_getQualityObject",value:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}}},{key:"allowZoom",value:function(){return!1}},{key:"getVideoData",value:function(){var e=this,t=this;return new Promise(function(a,n){e._deferredAction(function(){a({duration:t.video.duration,currentTime:t.video.currentTime,volume:t.video.volume,paused:t.video.paused,ended:t.video.ended,res:{w:t.video.videoWidth,h:t.video.videoHeight}})})})}},{key:"setPosterFrame",value:function(e){this._posterFrame=e}},{key:"setAutoplay",value:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)}},{key:"load",value:function(){var e=this;return new Promise(function(t,a){e._loadDeps().then(function(){var n=e._stream.sources[e._streamName];null===e._currentQuality&&e._videoQualityStrategy&&(e._currentQuality=e._videoQualityStrategy.getQualityIndex(n));var i=e._currentQuality<n.length?n[e._currentQuality]:null;e.video=null,e.domElement.parentNode.style.backgroundColor="transparent",i?(e.canvasController=null,function(e,t){var a=new(function(e){function t(e){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).stream=e,a._chroma=bg.Color.White(),a._crop=new bg.Vector4(.3,.01,.3,.01),a._transform=bg.Matrix4.Identity().translate(.6,-.04,0),a._bias=.01,a}return _inherits(t,bg.app.WindowController),_createClass(t,[{key:"loaded",value:function(){var e=this;return new Promise(function(t){!function a(){e.video?t(e):setTimeout(a,100)}()})}},{key:"buildShape",value:function(){this.plist=new bg.base.PolyList(this.gl),this.plist.vertex=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],this.plist.texCoord0=[0,0,1,0,1,1,0,1],this.plist.index=[0,1,2,2,3,0],this.plist.build()}},{key:"buildShader",value:function(){this.shader=new bg.base.Shader(this.gl),this.shader.addShaderSource(bg.base.ShaderType.VERTEX,"\n\t\t\t\t\t\tattribute vec4 position;\n\t\t\t\t\t\tattribute vec2 texCoord;\n\t\t\t\t\t\tuniform mat4 inTransform;\n\t\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\t\tvoid main() {\n\t\t\t\t\t\t\tgl_Position = inTransform * position;\n\t\t\t\t\t\t\tvTexCoord = texCoord;\n\t\t\t\t\t\t}\n\t\t\t\t\t"),this.shader.addShaderSource(bg.base.ShaderType.FRAGMENT,"\n\t\t\t\t\t\tprecision mediump float;\n\t\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\t\tuniform sampler2D inTexture;\n\t\t\t\t\t\tuniform vec4 inChroma;\n\t\t\t\t\t\tuniform float inBias;\n\t\t\t\t\t\tuniform vec4 inCrop;\n\t\t\t\t\t\tvoid main() {\n\t\t\t\t\t\t\tvec4 result = texture2D(inTexture,vTexCoord);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif ((result.r>=inChroma.r-inBias && result.r<=inChroma.r+inBias &&\n\t\t\t\t\t\t\t\tresult.g>=inChroma.g-inBias && result.g<=inChroma.g+inBias &&\n\t\t\t\t\t\t\t\tresult.b>=inChroma.b-inBias && result.b<=inChroma.b+inBias) ||\n\t\t\t\t\t\t\t\t(vTexCoord.x<inCrop.x || vTexCoord.x>inCrop.z || vTexCoord.y<inCrop.w || vTexCoord.y>inCrop.y)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tgl_FragColor = result;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t"),status=this.shader.link(),this.shader.status||(console.log(this.shader.compileError),console.log(this.shader.linkError)),this.shader.initVars(["position","texCoord"],["inTransform","inTexture","inChroma","inBias","inCrop"])}},{key:"init",value:function(){var e=this;bg.Engine.Set(new bg.webgl1.Engine(this.gl)),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),this.buildShape(),this.buildShader(),this.pipeline=new bg.base.Pipeline(this.gl),bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.clearColor=bg.Color.Transparent(),bg.base.Loader.Load(this.gl,this.stream.src).then(function(t){e.texture=t})}},{key:"frame",value:function(e){this.texture&&this.texture.update()}},{key:"display",value:function(){this.pipeline.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),this.texture&&(this.shader.setActive(),this.shader.setInputBuffer("position",this.plist.vertexBuffer,3),this.shader.setInputBuffer("texCoord",this.plist.texCoord0Buffer,2),this.shader.setMatrix4("inTransform",this.transform),this.shader.setTexture("inTexture",this.texture||bg.base.TextureCache.WhiteTexture(this.gl),bg.base.TextureUnit.TEXTURE_0),this.shader.setVector4("inChroma",this.chroma),this.shader.setValueFloat("inBias",this.bias),this.shader.setVector4("inCrop",new bg.Vector4(this.crop.x,1-this.crop.y,1-this.crop.z,this.crop.w)),this.plist.draw(),this.shader.disableInputBuffer("position"),this.shader.disableInputBuffer("texCoord"),this.shader.clearActive())}},{key:"reshape",value:function(e,t){var a=this.canvas.domElement;a.width=e,a.height=t,this.pipeline.viewport=new bg.Viewport(0,0,e,t)}},{key:"mouseMove",value:function(e){this.postRedisplay()}},{key:"chroma",get:function(){return this._chroma},set:function(e){this._chroma=e}},{key:"bias",get:function(){return this._bias},set:function(e){this._bias=e}},{key:"crop",get:function(){return this._crop},set:function(e){this._crop=e}},{key:"transform",get:function(){return this._transform},set:function(e){this._transform=e}},{key:"video",get:function(){return this.texture?this.texture.video:null}}]),t}())(e),n=bg.app.MainLoop.singleton;return n.updateMode=bg.app.FrameUpdate.AUTO,n.canvas=t,n.run(a),a.loaded()}(i,e.domElement).then(function(a){e.canvasController=a,e.video=a.video,e.video.pause(),i.crop&&(e.canvasController.crop=new bg.Vector4(i.crop.left,i.crop.top,i.crop.right,i.crop.bottom)),i.displacement&&(e.canvasController.transform=bg.Matrix4.Translation(i.displacement.x,i.displacement.y,0)),i.chromaColor&&(e.canvasController.chroma=new bg.Color(i.chromaColor[0],i.chromaColor[1],i.chromaColor[2],i.chromaColor[3])),i.chromaBias&&(e.canvasController.bias=i.chromaBias),t(i)})):a(new Error("Could not load video: invalid quality stream index"))})})}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t,a){setTimeout(function(){var a=[],n=e._stream.sources[e._streamName],i=-1;n.forEach(function(t){i++,a.push(e._getQualityObject(i,t))}),t(a)},10)})}},{key:"setQuality",value:function(e){var t=this;return new Promise(function(a){var n=t.video.paused,i=t._stream.sources[t._streamName];t._currentQuality=e<i.length?e:0;var r=t.video.currentTime;t.freeze().then(function(){return t._ready=!1,t.load()}).then(function(){n||t.play(),$(t.video).on("seeked",function(){t.unFreeze(),a(),$(t.video).off("seeked")}),t.video.currentTime=r})})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t){t(e._getQualityObject(e._currentQuality,e._stream.sources[e._streamName][e._currentQuality]))})}},{key:"play",value:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,e.video.play()})}},{key:"pause",value:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,e.video.pause()})}},{key:"isPaused",value:function(){var e=this;return this._deferredAction(function(){return e.video.paused})}},{key:"duration",value:function(){var e=this;return this._deferredAction(function(){return e.video.duration})}},{key:"setCurrentTime",value:function(e){var t=this;return this._deferredAction(function(){t.video.currentTime=e,$(t.video).on("seeked",function(){t.canvasController.postRedisplay(),$(t.video).off("seeked")})})}},{key:"currentTime",value:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})}},{key:"setVolume",value:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e})}},{key:"volume",value:function(){var e=this;return this._deferredAction(function(){return e.video.volume})}},{key:"setPlaybackRate",value:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})}},{key:"playbackRate",value:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})}},{key:"goFullScreen",value:function(){var e=this;return this._deferredAction(function(){var t=e.video;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitEnterFullscreen&&t.webkitEnterFullscreen()})}},{key:"unFreeze",value:function(){var e=this;return this._deferredAction(function(){var t=document.getElementById(e.video.className+"canvas");$(t).remove()})}},{key:"freeze",value:function(){return this._deferredAction(function(){})}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}}]),t}();paella.ChromaVideo=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"isStreamCompatible",value:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("chroma"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.ChromaVideo(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.ChromaVideoFactory=t}(),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"extendedTabAdapterPlugin"}},{key:"getIconClass",value:function(){return"icon-folder"}},{key:"getIndex",value:function(){return 2030}},{key:"getMinWindowSize",value:function(){return 550}},{key:"getName",value:function(){return"es.upv.paella.extendedTabAdapterPlugin"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Extended Tab Adapter")}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"buildContent",value:function(e){e.appendChild(paella.extendedAdapter.bottomContainer)}},{key:"currentUrl",get:function(){return this._currentUrl},set:function(e){this._currentUrl=e}},{key:"currentMaster",get:function(){return this._currentMaster},set:function(e){this._currentMaster=e}},{key:"currentSlave",get:function(){return this._currentSlave},set:function(e){this._currentSlave=e}},{key:"availableMasters",get:function(){return this._availableMasters},set:function(e){this._availableMasters=e}},{key:"availableSlaves",get:function(){return this._availableSlaves},set:function(e){this._availableSlaves=e}},{key:"showWidthRes",get:function(){return this._showWidthRes},set:function(e){this._showWidthRes=e}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"footPrints"}},{key:"getIconClass",value:function(){return"icon-stats"}},{key:"getIndex",value:function(){return 590}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Show statistics")}},{key:"getName",value:function(){return"es.upv.paella.footprintsPlugin"}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.timeLineButton}},{key:"setup",value:function(){this._INTERVAL_LENGTH=5;var e=this;switch(paella.events.bind(paella.events.timeUpdate,function(t){e.onTimeUpdate()}),this.config.skin){case"custom":this.fillStyle=this.config.fillStyle,this.strokeStyle=this.config.strokeStyle;break;case"dark":this.fillStyle="#727272",this.strokeStyle="#424242";break;case"light":default:this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff"}}},{key:"checkEnabled",value:function(e){e(!paella.player.isLiveStream())}},{key:"buildContent",value:function(e){var t=document.createElement("div");t.className="footPrintsContainer",this.canvas=document.createElement("canvas"),this.canvas.id="footPrintsCanvas",this.canvas.className="footPrintsCanvas",t.appendChild(this.canvas),e.appendChild(t)}},{key:"onTimeUpdate",value:function(){var e=this,t=-1;paella.player.videoContainer.currentTime().then(function(e){return t=e,paella.player.videoContainer.trimming()}).then(function(a){var n=Math.round(t+(a.enabled?a.start:0));e.inPosition<=n&&n<=e.inPosition+e.INTERVAL_LENGTH?(e.outPosition=n,e.inPosition+e.INTERVAL_LENGTH===e.outPosition&&(e.trackFootPrint(e.inPosition,e.outPosition),e.inPosition=e.outPosition)):(e.trackFootPrint(e.inPosition,e.outPosition),e.inPosition=n,e.outPosition=n)})}},{key:"trackFootPrint",value:function(e,t){var a={in:e,out:t};paella.data.write("footprints",{id:paella.initDelegate.getId()},a)}},{key:"willShowContent",value:function(){var e=this;this.loadFootprints(),this.footPrintsTimer=new base.Timer(function(t){e.loadFootprints()},5e3),this.footPrintsTimer.repeat=!0}},{key:"didHideContent",value:function(){null!=this.footPrintsTimer&&(this.footPrintsTimer.cancel(),this.footPrintsTimer=null)}},{key:"loadFootprints",value:function(){var e=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(t,a){var n={};paella.player.videoContainer.duration().then(function(a){for(var i=Math.floor(paella.player.videoContainer.trimStart()),r=-1,o=0,l=0;l<t.length;l++){var s=t[l].position-i;if(s<a){var u=t[l].views;if(s-1!=r)for(var c=r+1;c<s;c++)n[c]=o;n[s]=u,r=s,o=u}}e.drawFootPrints(n)})})}},{key:"drawFootPrints",value:function(e){if(this.canvas){var t,a=Object.keys(e).length,n=this.canvas.getContext("2d"),i=20;for(t=0;t<a;++t)e[t]>i&&(i=e[t]);for(this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",i),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.fillStyle=this.fillStyle,n.strokeStyle=this.strokeStyle,n.lineWidth=2,n.webkitImageSmoothingEnabled=!1,n.mozImageSmoothingEnabled=!1,t=0;t<a-1;++t)n.beginPath(),n.moveTo(t,i),n.lineTo(t,i-e[t]),n.lineTo(t+1,i-e[t+1]),n.lineTo(t+1,i),n.closePath(),n.fill(),n.beginPath(),n.moveTo(t,i-e[t]),n.lineTo(t+1,i-e[t+1]),n.closePath(),n.stroke()}}},{key:"INTERVAL_LENGTH",get:function(){return this._INTERVAL_LENGTH},set:function(e){this._INTERVAL_LENGTH=e}},{key:"inPosition",get:function(){return this._inPosition},set:function(e){this._inPosition=e}},{key:"outPosition",get:function(){return this._outPosition},set:function(e){this._outPosition=e}},{key:"canvas",get:function(){return this._canvas},set:function(e){this._canvas=e}},{key:"footPrintsTimer",get:function(){return this._footPrintsTimer},set:function(e){this._footPrintsTimer=e}},{key:"footPrintsData",get:function(){return this._footPrintsData},set:function(e){this._footPrintsData=e}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.SearchServicePlugIn),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.frameCaptionsSearchPlugin"}},{key:"search",value:function(e,t){var a=RegExp(e,"i"),n=[];for(var i in paella.player.videoLoader.frameList){var r=paella.player.videoLoader.frameList[i];"object"==_typeof(r)&&a.test(r.caption)&&n.push({time:i,content:r.caption,score:0})}t&&t(!1,n)}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"frameControl"}},{key:"getIconClass",value:function(){return"icon-photo"}},{key:"getIndex",value:function(){return 510}},{key:"getMinWindowSize",value:function(){return 450}},{key:"getName",value:function(){return"es.upv.paella.frameControlPlugin"}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.timeLineButton}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Navigate by slides")}},{key:"checkEnabled",value:function(e){this._img=null,this._searchTimer=null,this._searchTimerTime=250,null==paella.initDelegate.initParams.videoLoader.frameList?e(!1):0===paella.initDelegate.initParams.videoLoader.frameList.length?e(!1):0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length?e(!1):e(!0)}},{key:"setup",value:function(){this._showFullPreview=this.config.showFullPreview||"auto";var e,t=this,a=1,n=0,i=-1,r=13,o=27,l=37,s=39;$(this.button).keyup(function(u){var c=Math.floor(t.contx.offsetWidth/100),d=t.buttons.length%c,p=Math.floor(t.buttons.length/c);t.isPopUpOpen()&&(u.keyCode==l?i>0&&(t.buttons[i].className=e,a>p&&(n=c-d),--i==c*(a-1)-1-n&&0!=i&&(t.navButtons.left.scrollContainer.scrollLeft-=105*c,--a),this.hiResFrame&&t.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||t.buttons[i].frameControl.onMouseOver(null,t.buttons[i].frameData),e=t.buttons[i].className,t.buttons[i].className="frameControlItem selected"):u.keyCode==s?i<t.buttons.length-1&&(i>=0&&(t.buttons[i].className=e),1==a&&(n=0),++i==c*a-n&&(t.navButtons.left.scrollContainer.scrollLeft+=105*c,++a),this.hiResFrame&&t.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||t.buttons[i].frameControl.onMouseOver(null,t.buttons[i].frameData),e=t.buttons[i].className,t.buttons[i].className="frameControlItem selected"):u.keyCode==r?(t.buttons[i].frameControl.onClick(null,t.buttons[i].frameData),e="frameControlItem current"):u.keyCode==o&&t.removeHiResFrame())})}},{key:"buildContent",value:function(e){var t=this,a=this;this.frames=[];var n=document.createElement("div");n.className="frameControlContainer",a.contx=n;var i=document.createElement("div");i.className="frameControlContent",this.navButtons={left:document.createElement("div"),right:document.createElement("div")},this.navButtons.left.className="frameControl navButton left",this.navButtons.right.className="frameControl navButton right";var r=this.getFrame(null);e.appendChild(this.navButtons.left),e.appendChild(n),n.appendChild(i),e.appendChild(this.navButtons.right),this.navButtons.left.scrollContainer=n,$(this.navButtons.left).click(function(e){this.scrollContainer.scrollLeft-=100}),this.navButtons.right.scrollContainer=n,$(this.navButtons.right).click(function(e){this.scrollContainer.scrollLeft+=100}),i.appendChild(r);var o=$(r).outerWidth(!0);i.innerText="",$(window).mousemove(function(e){($(i).offset().top>e.pageY||!$(i).is(":visible")||$(i).offset().top+$(i).height()<e.pageY)&&a.removeHiResFrame()});var l,s=paella.initDelegate.initParams.videoLoader.frameList;if(s){var u=Object.keys(s);l=u.length,u.map(function(e){return Number(e,10)}).sort(function(e,t){return e-t}).forEach(function(e){var t=a.getFrame(s[e]);i.appendChild(t,"frameContrlItem_"+l),a.frames.push(t)})}$(i).css({width:l*o+"px"}),paella.events.bind(paella.events.setTrim,function(e,a){t.updateFrameVisibility(a.trimEnabled,a.trimStart,a.trimEnd)}),paella.player.videoContainer.trimming().then(function(e){t.updateFrameVisibility(e.enabled,e.start,e.end)}),paella.events.bind(paella.events.timeupdate,function(e,a){return t.onTimeUpdate(a.currentTime)})}},{key:"showHiResFrame",value:function(e,t){var a=document.createElement("div"),n=document.createElement("div"),i=document.createElement("img");if(this._img=i,i.className="frameHiRes",i.setAttribute("src",e),i.setAttribute("style","width: 100%;"),$(n).append(i),$(a).append(n),a.setAttribute("style","display: table;"),n.setAttribute("style","display: table-cell; vertical-align:middle;"),!0===this.config.showCaptions){var r=document.createElement("p");r.className="frameCaption",r.innerText=t||"",a.append(r),this._caption=r}var o=paella.player.videoContainer.overlayContainer;switch(this._showFullPreview){case"auto":1==(l=paella.initDelegate.initParams.videoLoader.streams).length?o.addElement(a,o.getVideoRect(0)):l.length>=2&&o.addElement(a,o.getVideoRect(1)),o.enableBackgroundMode(),this.hiResFrame=a;break;case"master":o.addElement(a,o.getVideoRect(0)),o.enableBackgroundMode(),this.hiResFrame=a;break;case"slave":var l;(l=paella.initDelegate.initParams.videoLoader.streams).length>=2&&(o.addElement(a,o.getVideoRect(0)),o.enableBackgroundMode(),this.hiResFrame=a)}}},{key:"removeHiResFrame",value:function(){var e=paella.player.videoContainer.overlayContainer;this.hiResFrame&&e.removeElement(this.hiResFrame),e.disableBackgroundMode(),this._img=null}},{key:"updateFrameVisibility",value:function(e,t,a){var n;if(e)for(n=0;n<this.frames.length;++n){var i=this.frames[n],r=i.frameData;r.time<t?this.frames.length>n+1&&this.frames[n+1].frameData.time>t?$(i).show():$(i).hide():r.time>a?$(i).hide():$(i).show()}else for(n=0;n<this.frames.length;++n)$(this.frames[n]).show()}},{key:"getFrame",value:function(e,t){var a=document.createElement("div");if(a.className="frameControlItem",t&&(a.id=t),e){this.buttons.push(a),a.frameData=e,a.frameControl=this;var n=e.thumb?e.thumb:e.url,i=paella.utils.timeParse.secondsToTime(e.time);a.innerHTML='<img src="'+n+'" alt="" class="frameControlImage" title="'+i+'" aria-label="'+i+'"></img>',base.userAgent.browser.IsMobileVersion||$(a).mouseover(function(e){this.frameControl.onMouseOver(e,this.frameData)}),$(a).mouseout(function(e){this.frameControl.onMouseOut(e,this.frameData)}),$(a).click(function(e){this.frameControl.onClick(e,this.frameData)})}return a}},{key:"onMouseOver",value:function(e,t){var a=paella.initDelegate.initParams.videoLoader.frameList[t.time];if(a){var n=a.url;this._img?(this._img.setAttribute("src",n),!0===this.config.showCaptions&&(this._caption.innerText=a.caption||"")):this.showHiResFrame(n,a.caption)}null!=this._searchTimer&&clearTimeout(this._searchTimer)}},{key:"onMouseOut",value:function(e,t){var a=this;this._searchTimer=setTimeout(function(e){return a.removeHiResFrame()},this._searchTimerTime)}},{key:"onClick",value:function(e,t){paella.player.videoContainer.trimming().then(function(e){var a=e.enabled?t.time-e.start:t.time;a>0?paella.player.videoContainer.seekToTime(a+1):paella.player.videoContainer.seekToTime(0)})}},{key:"onTimeUpdate",value:function(e){var t=this,a=null;paella.player.videoContainer.trimming().then(function(n){for(var i=n.enabled?e+n.start:e,r=0;r<t.frames.length&&(t.frames[r].frameData&&t.frames[r].frameData.time<=i);++r)a=t.frames[r];t.currentFrame!=a&&a&&(t.currentFrame&&(t.currentFrame.className="frameControlItem"),t.currentFrame=a,t.currentFrame.className="frameControlItem current")})}},{key:"frames",get:function(){return this._frames},set:function(e){this._frames=e}},{key:"highResFrames",get:function(){return this._highResFrames},set:function(e){this._highResFrames=e}},{key:"currentFrame",get:function(){return this._currentFrame},set:function(e){this._currentFrame=e}},{key:"navButtons",get:function(){return this._navButtons},set:function(e){this._navButtons=e}},{key:"buttons",get:function(){return this._buttons||(this._buttons=[]),this._buttons},set:function(e){this._buttons=e}},{key:"contx",get:function(){return this._contx},set:function(e){this._contx=e}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getIndex",value:function(){return 551}},{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"showFullScreenButton"}},{key:"getIconClass",value:function(){return"icon-fullscreen"}},{key:"getName",value:function(){return"es.upv.paella.fullScreenButtonPlugin"}},{key:"checkEnabled",value:function(e){this._reload=null,e(paella.player.checkFullScreenCapability())}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Go Fullscreen")}},{key:"setup",value:function(){var e=this;this._reload=!!this.config.reloadOnFullscreen&&this.config.reloadOnFullscreen.enabled,paella.events.bind(paella.events.enterFullscreen,function(t){return e.onEnterFullscreen()}),paella.events.bind(paella.events.exitFullscreen,function(t){return e.onExitFullscreen()})}},{key:"action",value:function(e){var t=this;if(paella.player.isFullScreen())paella.player.exitFullScreen();else{if((!paella.player.checkFullScreenCapability()||base.userAgent.browser.Explorer)&&window.location!==window.parent.location){var a=window.location.href;return paella.player.pause(),void paella.player.videoContainer.currentTime().then(function(e){var n=t.secondsToHours(e);window.open(a+"&time="+n.h+"h"+n.m+"m"+n.s+"s&autoplay=true")})}paella.player.goFullScreen()}paella.player.config.player.reloadOnFullscreen&&paella.player.videoContainer.supportAutoplay()&&setTimeout(function(){t._reload&&paella.player.videoContainer.setQuality(null).then(function(){})},1e3)}},{key:"secondsToHours",value:function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),n=Math.floor(e-3600*t-60*a),i={};return t<10&&(t="0"+t),a<10&&(a="0"+a),n<10&&(n="0"+n),i.h=t,i.m=a,i.s=n,i}},{key:"onEnterFullscreen",value:function(){this.setToolTip(base.dictionary.translate("Exit Fullscreen")),this.button.className=this.getButtonItemClass(!0),this.changeIconClass("icon-windowed")}},{key:"onExitFullscreen",value:function(){this.setToolTip(base.dictionary.translate("Go Fullscreen")),this.button.className=this.getButtonItemClass(!1),this.changeIconClass("icon-fullscreen"),setTimeout(function(){paella.player.onresize()},100)}},{key:"getButtonItemClass",value:function(e){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+(e?" active":"")}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getIndex",value:function(){return 509}},{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"helpButton"}},{key:"getIconClass",value:function(){return"icon-help"}},{key:"getName",value:function(){return"es.upv.paella.helpPlugin"}},{key:"getMinWindowSize",value:function(){return 650}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Show help")+" ("+base.dictionary.translate("Paella version:")+" "+paella.version+")"}},{key:"checkEnabled",value:function(e){e((this.config&&this.config.langs||[]).length>0)}},{key:"action",value:function(e){var t=base.dictionary.currentLanguage(),a=this.config&&this.config.langs||[],n=a.indexOf(t);n<0&&(n=0);var i="resources/style/help/help_"+a[n]+".html";base.userAgent.browser.IsMobileVersion?window.open(i):paella.messageBox.showFrame(i)}}]),t}()}),function(){var e=function(e){function t(e,a,n,i,r,o){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,n,i,r,o,"hls"))}return _inherits(t,paella.Html5Video),_createClass(t,[{key:"config",get:function(){var e={autoStartLoad:!0,startPosition:-1,capLevelToPlayerSize:!0,debug:!1,defaultAudioCodec:void 0,initialLiveManifestSize:1,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:10,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:500,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:500,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:500,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,appendErrorMaxRetry:3,enableWebVTT:!0,enableCEA708Captions:!0,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:5,abrEwmaSlowLive:9,abrEwmaFastVoD:4,abrEwmaSlowVoD:15,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,minAutoBitrate:0},t={};for(var a in paella.player.config.player.methods.some(function(e){if("HLSVideoFactory"==e.factory)return t=e.config,!0}),e)null!=t[a]&&(e[a]=t[a]);return e}}]),_createClass(t,[{key:"_loadDeps",value:function(){return new Promise(function(e,t){window.$paella_hls?e(window.$paella_hls):require(["resources/deps/hls.min.js"],function(t){window.$paella_hls=t,e(window.$paella_hls)})})}},{key:"allowZoom",value:function(){return!0}},{key:"load",value:function(){var e=this;if(this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),base.userAgent.system.iOS)return _get(_getPrototypeOf(t.prototype),"load",this).call(this);var a=this;return new Promise(function(t,n){var i=e._stream.sources.hls;i&&i.length>0?(i=i[0],e._loadDeps().then(function(e){if(e.isSupported()){var r=a.config;a._hls=new e(r),a._hls.loadSource(i.src),a._hls.attachMedia(a.video),a.autoQuality=!0,a._hls.on(e.Events.LEVEL_SWITCHED,function(e,t){a._qualities=a._qualities||[],a.qualityIndex=a.autoQuality?a._qualities.length-1:t.level,paella.events.trigger(paella.events.qualityChanged,{}),console&&console.log&&console.log("HLS: quality level changed to ".concat(t.level))}),a._hls.on(e.Events.ERROR,function(t,i){if(i.fatal)switch(i.type){case e.ErrorTypes.NETWORK_ERROR:base.log.error("paella.HLSPlayer: Fatal network error encountered, try to recover"),a._hls.startLoad();break;case e.ErrorTypes.MEDIA_ERROR:base.log.error("paella.HLSPlayer: Fatal media error encountered, try to recover"),a._hls.recoverMediaError();break;default:base.log.error("paella.HLSPlayer: Fatal Error. Can not recover"),a._hls.destroy(),n(new Error("invalid media"))}}),a._hls.on(e.Events.MANIFEST_PARSED,function(){a._deferredAction(function(){t()})})}})):n(new Error("Invalid source"))})}},{key:"getQualities",value:function(){var e=this;if(base.userAgent.system.iOS)return new Promise(function(e,t){e([{index:0,res:"",src:"",toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return 0}}])});var t=this;return new Promise(function(a){e._qualities&&0!=e._qualities.length||(t._qualities=[],t._hls.levels.forEach(function(e,a){t._qualities.push(t._getQualityObject(a,{index:a,res:{w:e.width,h:e.height},bitrate:e.bitrate}))}),t._qualities.push(t._getQualityObject(t._qualities.length,{index:t._qualities.length,res:{w:0,h:0},bitrate:0}))),t.qualityIndex=t._qualities.length-1,a(t._qualities)})}},{key:"printQualityes",value:function(){var e=this;return new Promise(function(t,a){e.getCurrentQuality().then(function(t){return e.getNextQuality()}).then(function(e){t()})})}},{key:"setQuality",value:function(e){if(base.userAgent.system.iOS)return Promise.resolve();if(null!==e){try{this.qualityIndex=e;var t=e;this.autoQuality=!1,e==this._qualities.length-1&&(t=-1,this.autoQuality=!0),this._hls.currentLevel=t}catch(e){}return Promise.resolve()}return Promise.resolve()}},{key:"getNextQuality",value:function(){var e=this;return new Promise(function(t,a){var n=e.qualityIndex;t(e._qualities[n])})}},{key:"getCurrentQuality",value:function(){var e=this;return base.userAgent.system.iOS?Promise.resolve(0):new Promise(function(t,a){t(e._qualities[e.qualityIndex])})}}]),t}();paella.HLSPlayer=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"isStreamCompatible",value:function(e){void 0===paella.videoFactories.HLSVideoFactory.s_instances&&(paella.videoFactories.HLSVideoFactory.s_instances=0);try{if(paella.videoFactories.HLSVideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("hls"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return++paella.videoFactories.HLSVideoFactory.s_instances,new paella.HLSPlayer(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.HLSVideoFactory=t}(),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.KeyPlugin),_createClass(t,[{key:"checkEnabled",value:function(e){e(!0)}},{key:"getName",value:function(){return"es.upv.paella.defaultKeysPlugin"}},{key:"setup",value:function(){}},{key:"onKeyPress",value:function(e){if(e.altKey&&e.ctrlKey){if(e.which==paella.Keys.P)return this.togglePlayPause(),!0;if(e.which==paella.Keys.S)return this.pause(),!0;if(e.which==paella.Keys.M)return this.mute(),!0;if(e.which==paella.Keys.U)return this.volumeUp(),!0;if(e.which==paella.Keys.D)return this.volumeDown(),!0}else{if(e.which==paella.Keys.Space)return this.togglePlayPause(),!0;if(e.which==paella.Keys.Up)return this.volumeUp(),!0;if(e.which==paella.Keys.Down)return this.volumeDown(),!0;if(e.which==paella.Keys.M)return this.mute(),!0}return!1}},{key:"togglePlayPause",value:function(){paella.player.videoContainer.paused().then(function(e){e?paella.player.play():paella.player.pause()})}},{key:"pause",value:function(){paella.player.pause()}},{key:"mute",value:function(){paella.player.videoContainer.volume().then(function(e){var t=0;0==e&&(t=1),paella.player.videoContainer.setVolume({master:t,slave:0})})}},{key:"volumeUp",value:function(){paella.player.videoContainer.volume().then(function(e){e=(e+=.1)>1?1:e,paella.player.videoContainer.setVolume(e)})}},{key:"volumeDown",value:function(){paella.player.videoContainer.volume().then(function(e){e=(e-=.1)<0?0:e,paella.player.videoContainer.setVolume(e)})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoOverlayButtonPlugin),_createClass(t,[{key:"getIndex",value:function(){return 0}},{key:"getSubclass",value:function(){return"legal"}},{key:"getAlignment",value:function(){return paella.player.config.plugins.list[this.getName()].position}},{key:"getDefaultToolTip",value:function(){return""}},{key:"checkEnabled",value:function(e){e(!0)}},{key:"setup",value:function(){var e=paella.player.config.plugins.list[this.getName()],t=document.createElement("a");t.innerText=e.label,this._url=e.legalUrl,t.className="",this.button.appendChild(t)}},{key:"action",value:function(e){window.open(this._url)}},{key:"getName",value:function(){return"es.upv.paella.legalPlugin"}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoOverlayButtonPlugin),_createClass(t,[{key:"isEditorVisible",value:function(){return null!=paella.editor.instance}},{key:"getIndex",value:function(){return 10}},{key:"getSubclass",value:function(){return"liveIndicator"}},{key:"getAlignment",value:function(){return"right"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("This video is a live stream")}},{key:"getName",value:function(){return"es.upv.paella.liveStreamingIndicatorPlugin"}},{key:"checkEnabled",value:function(e){e(paella.player.isLiveStream())}},{key:"setup",value:function(){}},{key:"action",value:function(e){paella.messageBox.showMessage(base.dictionary.translate("Live streaming mode: This is a live video, so, some capabilities of the player are disabled"))}}]),t}()}),function(){var e=function(e){function t(e,a,n,i,r,o){var l;return _classCallCheck(this,t),(l=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,n,i,r,o)))._posterFrame=null,l._player=null,l}return _inherits(t,paella.Html5Video),_createClass(t,[{key:"_loadDeps",value:function(){return new Promise(function(e,t){window.$paella_mpd?e(window.$paella_mpd):require(["resources/deps/dash.all.js"],function(){window.$paella_mpd=!0,e(window.$paella_mpd)})})}},{key:"_getQualityObject",value:function(e,t,a){var n=a.length,i=Math.round(100*t/n),r=0==t?"min":t==n-1?"max":i+"%";return{index:t,res:{w:null,h:null},bitrate:e.bitrate,src:null,toString:function(){return i},shortLabel:function(){return r},compare:function(e){return this.bitrate-e.bitrate}}}},{key:"load",value:function(){var e=this,t=this;return new Promise(function(a,n){var i=e._stream.sources.mpd;i&&i.length>0?(i=i[0],e._loadDeps().then(function(){var e=dashjs.MediaPlayer().create();e.initialize(t.video,i.src,!0),e.getDebug().setLogToBrowserConsole(!1),t._player=e,e.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,function(n,i){e.getBitrateInfoListFor("video");t._deferredAction(function(){t._firstPlay||(t._player.pause(),t._firstPlay=!0),a()})})})):n(new Error("Invalid source"))})}},{key:"supportAutoplay",value:function(){return!0}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t){e._deferredAction(function(){e._qualities||(e._qualities=[],e._player.getBitrateInfoListFor("video").sort(function(e,t){return e.bitrate-t.bitrate}).forEach(function(t,a,n){e._qualities.push(e._getQualityObject(t,a,n))}),e.autoQualityIndex=e._qualities.length,e._qualities.push({index:e.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return this.bitrate-e.bitrate}})),t(e._qualities)})})}},{key:"setQuality",value:function(e){var t=this;return new Promise(function(a,n){var i=t._player.getQualityFor("video");e==t.autoQualityIndex?(t._player.setAutoSwitchQuality(!0),a()):e!=i?(t._player.setAutoSwitchQuality(!1),t._player.off(dashjs.MediaPlayer.events.METRIC_CHANGED),t._player.on(dashjs.MediaPlayer.events.METRIC_CHANGED,function(e,n){"metricchanged"==e.type&&i!=t._player.getQualityFor("video")&&(i=t._player.getQualityFor("video"),a())}),t._player.setQualityFor("video",e)):a()})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t,a){if(e._player.getAutoSwitchQuality())t({index:e.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return this.bitrate-e.bitrate}});else{var n=e._player.getQualityFor("video");t(e._getQualityObject(e._qualities[n],n,e._player.getBitrateInfoListFor("video")))}})}},{key:"unFreeze",value:function(){return paella_DeferredNotImplemented()}},{key:"freeze",value:function(){return paella_DeferredNotImplemented()}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}}]),t}();paella.MpegDashVideo=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"isStreamCompatible",value:function(e){try{if(base.userAgent.system.iOS)return!1;for(var t in e.sources)if("mpd"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.MpegDashVideo(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.MpegDashVideoFactory=t}(),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"showMultipleQualitiesPlugin"}},{key:"getIconClass",value:function(){return"icon-screen"}},{key:"getIndex",value:function(){return 2030}},{key:"getMinWindowSize",value:function(){return 550}},{key:"getName",value:function(){return"es.upv.paella.multipleQualitiesPlugin"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Change video quality")}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"checkEnabled",value:function(e){var t=this;this._available=[],paella.player.videoContainer.getQualities().then(function(a){t._available=a,e(a.length>1)})}},{key:"setup",value:function(){var e=this;this.setQualityLabel(),paella.events.bind(paella.events.qualityChanged,function(t){return e.setQualityLabel()})}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"buildContent",value:function(e){var t=this;this._available.forEach(function(a){a.shortLabel();e.appendChild(t.getItemButton(a))})}},{key:"getItemButton",value:function(e){var t=this,a=document.createElement("div"),n=this;return paella.player.videoContainer.getCurrentQuality().then(function(i,r){var o=e.shortLabel();a.className=t.getButtonItemClass(o,e.index==i),a.id=o,a.innerText=o,a.data=e,$(a).click(function(e){$(".multipleQualityItem").removeClass("selected"),$(".multipleQualityItem."+this.data.toString()).addClass("selected"),paella.player.videoContainer.setQuality(this.data.index).then(function(){paella.player.controls.hidePopUp(n.getName()),n.setQualityLabel()})})}),a}},{key:"setQualityLabel",value:function(){var e=this;paella.player.videoContainer.getCurrentQuality().then(function(t){e.setText(t.shortLabel())})}},{key:"getButtonItemClass",value:function(e,t){return"multipleQualityItem "+e+(t?" selected":"")}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getIndex",value:function(){return 551}},{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"PIPModeButton"}},{key:"getIconClass",value:function(){return"icon-pip"}},{key:"getName",value:function(){return"es.upv.paella.pipModePlugin"}},{key:"checkEnabled",value:function(e){var t=paella.player.videoContainer.masterVideo().video;t&&t.webkitSetPresentationMode?e(!0):t&&"pictureInPictureEnabled"in document?e(!0):e(!1)}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Set picture-in-picture mode.")}},{key:"setup",value:function(){}},{key:"action",value:function(e){var t=paella.player.videoContainer.masterVideo().video;t.webkitSetPresentationMode?"picture-in-picture"==t.webkitPresentationMode?t.webkitSetPresentationMode("inline"):t.webkitSetPresentationMode("picture-in-picture"):"pictureInPictureEnabled"in document&&(t!==document.pictureInPictureElement?t.requestPictureInPicture():document.exitPictureInPicture())}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).playIconClass="icon-play",e.pauseIconClass="icon-pause",e.playSubclass="playButton",e.pauseSubclass="pauseButton",e}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"left"}},{key:"getSubclass",value:function(){return this.playSubclass}},{key:"getIconClass",value:function(){return this.playIconClass}},{key:"getName",value:function(){return"es.upv.paella.playPauseButtonPlugin"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Play")}},{key:"getIndex",value:function(){return 110}},{key:"checkEnabled",value:function(e){e(!0)}},{key:"setup",value:function(){var e=this;paella.player.playing()&&this.changeIconClass(this.playIconClass),paella.events.bind(paella.events.play,function(t){e.changeIconClass(e.pauseIconClass),e.changeSubclass(e.pauseSubclass),e.setToolTip(paella.dictionary.translate("Pause"))}),paella.events.bind(paella.events.pause,function(t){e.changeIconClass(e.playIconClass),e.changeSubclass(e.playSubclass),e.setToolTip(paella.dictionary.translate("Play"))})}},{key:"action",value:function(e){paella.player.videoContainer.paused().then(function(e){e?paella.player.play():paella.player.pause()})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).containerId="paella_plugin_PlayButtonOnScreen",e.container=null,e.enabled=!0,e.isPlaying=!1,e.showIcon=!0,e.firstPlay=!1,e}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"checkEnabled",value:function(e){e(!paella.player.isLiveStream()||base.userAgent.system.Android||base.userAgent.system.iOS||!paella.player.videoContainer.supportAutoplay())}},{key:"getIndex",value:function(){return 1010}},{key:"getName",value:function(){return"es.upv.paella.playButtonOnScreenPlugin"}},{key:"setup",value:function(){var e=this;this.container=document.createElement("div"),this.container.className="playButtonOnScreen",this.container.id=this.containerId,this.container.style.width="100%",this.container.style.height="100%",paella.player.videoContainer.domElement.appendChild(this.container),$(this.container).click(function(t){e.onPlayButtonClick()});var t=document.createElement("canvas");function a(){var a=jQuery(e.container).innerWidth(),n=jQuery(e.container).innerHeight();t.width=a,t.height=n;var i=a<n?a/3:n/3,r=t.getContext("2d");r.translate((a-i)/2,(n-i)/2),r.beginPath(),r.arc(i/2,i/2,i/2,0,2*Math.PI,!0),r.closePath(),r.strokeStyle="white",r.lineWidth=10,r.stroke(),r.fillStyle="#8f8f8f",r.fill(),r.beginPath(),r.moveTo(i/3,i/4),r.lineTo(3*i/4,i/2),r.lineTo(i/3,3*i/4),r.lineTo(i/3,i/4),r.closePath(),r.fillStyle="white",r.fill(),r.stroke()}t.className="playButtonOnScreenIcon",this.container.appendChild(t),paella.events.bind(paella.events.resize,a),a()}},{key:"getEvents",value:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor]}},{key:"onEvent",value:function(e,t){switch(e){case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor()}}},{key:"onPlayButtonClick",value:function(){this.firstPlay=!0,this.checkStatus()}},{key:"endVideo",value:function(){this.isPlaying=!1,this.checkStatus()}},{key:"play",value:function(){this.isPlaying=!0,this.showIcon=!1,this.checkStatus()}},{key:"pause",value:function(){this.isPlaying=!1,this.showIcon=!0,this.checkStatus()}},{key:"showEditor",value:function(){this.enabled=!1,this.checkStatus()}},{key:"hideEditor",value:function(){this.enabled=!0,this.checkStatus()}},{key:"checkStatus",value:function(){this.enabled&&this.isPlaying||!this.enabled||!this.showIcon?$(this.container).hide():$(this.container).show()}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"left"}},{key:"getSubclass",value:function(){return"showPlaybackRateButton"}},{key:"getIconClass",value:function(){return"icon-screen"}},{key:"getIndex",value:function(){return 140}},{key:"getMinWindowSize",value:function(){return 500}},{key:"getName",value:function(){return"es.upv.paella.playbackRatePlugin"}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Set playback rate")}},{key:"checkEnabled",value:function(e){this.buttonItems=null,this.buttons=[],this.selected_button=null,this.defaultRate=null,this._domElement=null,this.available_rates=null,e(!base.userAgent.browser.IsMobileVersion&&null!=dynamic_cast("paella.Html5Video",paella.player.videoContainer.masterVideo()))}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"setup",value:function(){this.defaultRate=1,this.available_rates=this.config.availableRates||[.75,1,1.25,1.5]}},{key:"buildContent",value:function(e){var t=this;this._domElement=e,this.buttonItems={},this.available_rates.forEach(function(a){e.appendChild(t.getItemButton(a+"x",a))})}},{key:"getItemButton",value:function(e,t){var a=document.createElement("div");return a.className=1==t?this.getButtonItemClass(e,!0):this.getButtonItemClass(e,!1),a.id=e+"_button",a.innerText=e,a.data={label:e,rate:t,plugin:this},$(a).click(function(e){this.data.plugin.onItemClick(this,this.data.label,this.data.rate)}),a}},{key:"onItemClick",value:function(e,t,a){paella.player.videoContainer.setPlaybackRate(a),this.setText(t),paella.player.controls.hidePopUp(this.getName());for(var n=this._domElement.children,i=0;i<n.length;i++)n[i].className=this.getButtonItemClass(i,!1);e.className=this.getButtonItemClass(i,!0)}},{key:"getText",value:function(){return"1x"}},{key:"getProfileItemButton",value:function(e,t){var a=document.createElement("div");return a.className=this.getButtonItemClass(e,!1),a.id=e+"_button",a.data={profile:e,profileData:t,plugin:this},$(a).click(function(e){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),a}},{key:"getButtonItemClass",value:function(e,t){return"playbackRateItem "+e+(t?" selected":"")}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"rateButtonPlugin"}},{key:"getIconClass",value:function(){return"icon-star"}},{key:"getIndex",value:function(){return 540}},{key:"getMinWindowSize",value:function(){return 500}},{key:"getName",value:function(){return"es.upv.paella.ratePlugin"}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Rate this video")}},{key:"checkEnabled",value:function(e){var t=this;this.buttonItems=null,this.buttons=[],this.selected_button=null,this.score=0,this.count=0,this.myScore=0,this.canVote=!1,this.scoreContainer={header:null,rateButtons:null},paella.data.read("rate",{id:paella.initDelegate.getId()},function(a,n){a&&"object"==_typeof(a)&&(t.score=Number(a.mean).toFixed(1),t.count=a.count,t.myScore=a.myScore,t.canVote=a.canVote),e(n)})}},{key:"setup",value:function(){}},{key:"setScore",value:function(e){this.score=e,this.updateScore()}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"updateHeader",value:function(){var e=base.dictionary.translate("Not rated");this.count>0&&(e='<i class="glyphicon glyphicon-star"></i>',e+=" ".concat(this.score," ").concat(this.count," ").concat(base.dictionary.translate("votes"))),this.scoreContainer.header.innerHTML="\n\t\t\t<div>\n\t\t\t\t<h4>".concat(base.dictionary.translate("Video score"),":</h4>\n\t\t\t\t<h5>\n\t\t\t\t\t").concat(e,"\n\t\t\t\t</h5>\n\t\t\t\t</h4>\n\t\t\t\t<h4>").concat(base.dictionary.translate("Vote:"),"</h4>\n\t\t\t</div>\n\t\t\t")}},{key:"updateRateButtons",value:function(){if(this.scoreContainer.rateButtons.className="rateButtons",this.buttons=[],this.canVote){this.scoreContainer.rateButtons.innerText="";for(var e=0;e<5;++e){var t=this.getStarButton(e+1);this.buttons.push(t),this.scoreContainer.rateButtons.appendChild(t)}}else this.scoreContainer.rateButtons.innerHTML="<h5>".concat(base.dictionary.translate("Login to vote"),"</h5>");this.updateVote()}},{key:"buildContent",value:function(e){this._domElement=e;var t=document.createElement("div");e.appendChild(t),t.className="rateContainerHeader",this.scoreContainer.header=t,this.updateHeader();var a=document.createElement("div");this.scoreContainer.rateButtons=a,e.appendChild(a),this.updateRateButtons()}},{key:"getStarButton",value:function(e){var t=this,a=document.createElement("i");return a.data={score:e,active:!1},a.className="starButton glyphicon glyphicon-star-empty",$(a).click(function(e){t.vote(this.data.score)}),a}},{key:"vote",value:function(e){var t=this;this.myScore=e;var a={mean:this.score,count:this.count,myScore:e,canVote:this.canVote};paella.data.write("rate",{id:paella.initDelegate.getId()},a,function(e){paella.data.read("rate",{id:paella.initDelegate.getId()},function(e,a){e&&"object"==_typeof(e)&&(t.score=Number(e.mean).toFixed(1),t.count=e.count,t.myScore=e.myScore,t.canVote=e.canVote),t.updateHeader(),t.updateRateButtons()})})}},{key:"updateVote",value:function(){var e=this;this.buttons.forEach(function(t,a){t.className=a<e.myScore?"starButton glyphicon glyphicon-star":"starButton glyphicon glyphicon-star-empty"})}}]),t}()}),function(){var e=function(e){function t(e,a,n,i,r,o){var l;_classCallCheck(this,t),(l=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,"div",n,i,r,o)))._posterFrame=null,l._currentQuality=null,l._duration=0,l._paused=!0,l._streamName=null,l._flashId=null,l._swfContainer=null,l._flashVideo=null,l._volume=1,l._flashId=e+"Movie",l._streamName="rtmp";var s=_assertThisInitialized(l);l._stream.sources.rtmp.sort(function(e,t){return e.res.h-t.res.h});var u=function(e,t){t=t.split(",");for(var a={},n=0;n<t.length;++n){var i=t[n].split(":"),r=i[0],o=i[1];"NaN"==o?o=NaN:/^true$/i.test(o)?o=!0:/^false$/i.test(o)?o=!1:isNaN(parseFloat(o))||(o=parseFloat(o)),a[r]=o}!function(e,t){if("loadedmetadata"==e||"pause"==e||s._isReady||(s._isReady=!0,s._duration=t.duration,$(s.swfContainer).trigger("paella:flashvideoready")),"progress"==e){try{s.flashVideo.setVolume(s._volume)}catch(e){}base.log.debug("Flash video event: "+e+", progress: "+s.flashVideo.currentProgress())}else"ended"==e?(base.log.debug("Flash video event: "+e),paella.events.trigger(paella.events.pause),paella.player.controls.showControls()):base.log.debug("Flash video event: "+e)}(e,a)};return paella.events.bind(paella.events.flashVideoEvent,function(e,t){s.flashId==t.source&&u(t.eventName,t.values)}),l}return _inherits(t,paella.VideoElementBase),_createClass(t,[{key:"_createSwfObject",value:function(e,t){var a=this.identifier,n=document.createElement("div");if(this.domElement.appendChild(n),n.id=a+"Movie",this._swfContainer=n,swfobject.hasFlashPlayerVersion("9.0.0"))swfobject.embedSWF(e,n.id,"100%","100%","9.0.0","",t,{wmode:"transparent"},null,function(e){if(0==e.success){var t=document.createElement("div"),a=document.createElement("h3");a.innerText=base.dictionary.translate("Flash player problem");var n=document.createElement("div");n.innerHTML=base.dictionary.translate("A problem occurred trying to load flash player.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>")+"<br>"+base.dictionary.translate("If the problem presist, contact us.");var i=document.createElement("a");i.setAttribute("href","http://www.adobe.com/go/getflash"),i.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',t.appendChild(a),t.appendChild(n),t.appendChild(i),paella.messageBox.showError(t.innerHTML)}});else{var i=document.createElement("div"),r=document.createElement("h3");r.innerText=base.dictionary.translate("Flash player needed");var o=document.createElement("div");o.innerHTML=base.dictionary.translate("You need at least Flash player 9 installed.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>");var l=document.createElement("a");l.setAttribute("href","http://www.adobe.com/go/getflash"),l.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',i.appendChild(r),i.appendChild(o),i.appendChild(l),paella.messageBox.showError(i.innerHTML)}return $("#"+n.id)[0]}},{key:"_deferredAction",value:function(e){var t=this;return new Promise(function(a,n){t.ready?a(e()):$(t.swfContainer).bind("paella:flashvideoready",function(){t._ready=!0,a(e())})})}},{key:"_getQualityObject",value:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}}},{key:"getVideoData",value:function(){var e=this,t=this;return new Promise(function(a,n){e._deferredAction(function(){var e={duration:t.flashVideo.duration(),currentTime:t.flashVideo.getCurrentTime(),volume:t.flashVideo.getVolume(),paused:t._paused,ended:t._ended,res:{w:t.flashVideo.getWidth(),h:t.flashVideo.getHeight()}};a(e)})})}},{key:"setPosterFrame",value:function(e){if(null==this._posterFrame){this._posterFrame=e;var t=document.createElement("img");t.src=e,t.className="videoPosterFrameImage",t.alt="poster frame",this.domElement.appendChild(t),this._posterFrameElement=t}}},{key:"setAutoplay",value:function(e){this._autoplay=e}},{key:"load",value:function(){var e=this._stream.sources.rtmp;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(t){if(function(e){return e.src&&"object"==_typeof(e.src)&&e.src.server&&e.src.stream}(t)){var a=!1;void 0===t.src.requiresSubscription&&paella.player.config.player.rtmpSettings?a=paella.player.config.player.rtmpSettings.requiresSubscription||!1:t.src.requiresSubscription&&(a=t.src.requiresSubscription);var n={};return this._autoplay&&(n.autoplay=this._autoplay),"true"==base.parameters.get("debug")&&(n.debugMode=!0),n.playerId=this.flashId,n.isLiveStream=void 0!==t.isLiveStream&&t.isLiveStream,n.server=t.src.server,n.stream=t.src.stream,n.subscribe=a,paella.player.config.player.rtmpSettings&&void 0!==paella.player.config.player.rtmpSettings.bufferTime&&(n.bufferTime=paella.player.config.player.rtmpSettings.bufferTime),this._flashVideo=this._createSwfObject("resources/deps/player_streaming.swf",n),$(this.swfContainer).trigger("paella:flashvideoready"),this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Invalid video data"))}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t,a){setTimeout(function(){var a=[],n=e._stream.sources.rtmp,i=-1;n.forEach(function(t){i++,a.push(e._getQualityObject(i,t))}),t(a)},50)})}},{key:"setQuality",value:function(e){var t=this;return e=null!=e?e:0,new Promise(function(a,n){t._paused;var i=t._stream.sources.rtmp;t._currentQuality=e<i.length?e:0;i[e];t._ready=!1,t._isReady=!1,t.load().then(function(){a()})})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t,a){t(e._getQualityObject(e._currentQuality,e._stream.sources.rtmp[e._currentQuality]))})}},{key:"play",value:function(){var e=this;return this._deferredAction(function(){e._posterFrameElement&&(e._posterFrameElement.parentNode.removeChild(e._posterFrameElement),e._posterFrameElement=null),e._paused=!1,e.flashVideo.play()})}},{key:"pause",value:function(){var e=this;return this._deferredAction(function(){e._paused=!0,e.flashVideo.pause()})}},{key:"isPaused",value:function(){var e=this;return this._deferredAction(function(){return e._paused})}},{key:"duration",value:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.duration()})}},{key:"setCurrentTime",value:function(e){var t=this;return this._deferredAction(function(){var a=t.flashVideo.duration();t.flashVideo.seekTo(100*e/a)})}},{key:"currentTime",value:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.getCurrentTime()})}},{key:"setVolume",value:function(e){var t=this;return this._volume=e,this._deferredAction(function(){t.flashVideo.setVolume(e)})}},{key:"volume",value:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.getVolume()})}},{key:"setPlaybackRate",value:function(e){var t=this;return this._deferredAction(function(){t._playbackRate=e})}},{key:"playbackRate",value:function(){var e=this;return this._deferredAction(function(){return e._playbackRate})}},{key:"goFullScreen",value:function(){return paella_DeferredNotImplemented()}},{key:"unFreeze",value:function(){return this._deferredAction(function(){})}},{key:"freeze",value:function(){return this._deferredAction(function(){})}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}},{key:"swfContainer",get:function(){return this._swfContainer}},{key:"flashId",get:function(){return this._flashId}},{key:"flashVideo",get:function(){return this._flashVideo}}]),t}();paella.RTMPVideo=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"isStreamCompatible",value:function(e){try{if(base.userAgent.system.iOS||base.userAgent.system.Android)return!1;for(var t in e.sources)if("rtmp"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return new paella.RTMPVideo(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.RTMPVideoFactory=t}(),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.SearchServicePlugIn),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.search.captionsSearchPlugin"}},{key:"search",value:function(e,t){paella.captions.search(e,t)}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"searchButton"}},{key:"getIconClass",value:function(){return"icon-binoculars"}},{key:"getMinWindowSize",value:function(){return 550}},{key:"getName",value:function(){return"es.upv.paella.searchPlugin"}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Search")}},{key:"getIndex",value:function(){return 510}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"checkEnabled",value:function(e){this._open=!1,this._sortDefault="time",this._colorSearch=!1,this._localImages=null,this._searchTimer=null,this._searchTimerTime=1500,this._searchBody=null,this._trimming=null,e(!0)}},{key:"setup",value:function(){var e=this;$(".searchButton").click(function(t){e._open?e._open=!1:(e._open=!0,setTimeout(function(){$("#searchBarInput").focus()},0))}),e._localImages=paella.initDelegate.initParams.videoLoader.frameList,e._colorSearch=e.config.colorSearch||!1,e._sortDefault=e.config.sortType||"time",paella.events.bind(paella.events.controlBarWillHide,function(t){e._open&&paella.player.controls.cancelHideBar()}),paella.player.videoContainer.trimming().then(function(t){e._trimming=t})}},{key:"prettyTime",value:function(e){var t=Math.floor(e/3600)%24;t=("00"+t).slice(t.toString().length);var a=Math.floor(e/60)%60;a=("00"+a).slice(a.toString().length);var n=Math.floor(e%60);return t+":"+a+":"+(n=("00"+n).slice(n.toString().length))}},{key:"search",value:function(e,t){paella.searchService.search(e,t)}},{key:"getPreviewImage",value:function(e){var t=Object.keys(this._localImages);t.push(e),t.sort(function(e,t){return parseInt(e)-parseInt(t)});var a=t.indexOf(e)-1,n=t[a=a>0?a:0];return n=parseInt(n),this._localImages[n].url}},{key:"createLoadingElement",value:function(e){var t=document.createElement("div");t.className="loader";t.innerHTML='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve"><path fill="#000" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"><animateTransform attributeType="xml"attributeName="transform"type="rotate"from="0 25 25"to="360 25 25"dur="0.6s"repeatCount="indefinite"/></path></svg>',e.appendChild(t);var a=document.createElement("p");a.className="sBodyText",a.innerText=base.dictionary.translate("Searching")+"...",e.appendChild(a)}},{key:"createNotResultsFound",value:function(e){var t=document.createElement("div");t.className="noResults",t.innerText=base.dictionary.translate("Sorry! No results found."),e.appendChild(t)}},{key:"doSearch",value:function(e,t){var a=this;$(t).empty(),a.createLoadingElement(t),a.search(e,function(e,n){if($(t).empty(),!e)if(0==n.length)a.createNotResultsFound(t);else for(var i=0;i<n.length;i++)if(!(a._trimming.enabled&&n[i].time<=a._trimming.start)){"score"==a._sortDefault&&n.sort(function(e,t){return t.score-e.score}),"time"==a._sortDefault&&n.sort(function(e,t){return e.time-t.time});var r=document.createElement("div");r.className="sBodyInnerContainer",a._colorSearch&&(n[i].score<=.3&&$(r).addClass("redScore"),n[i].score>=.7&&$(r).addClass("greenScore"));var o=document.createElement("div");o.className="TimePicContainer";var l=document.createElement("img");l.className="sBodyPicture",l.src=a.getPreviewImage(n[i].time);var s=document.createElement("p");s.className="sBodyText";var u=a._trimming.enabled?n[i].time-a._trimming.start:n[i].time;s.innerHTML="<span class='timeSpan'>"+a.prettyTime(u)+"</span>"+paella.AntiXSS.htmlEscape(n[i].content),o.appendChild(l),r.appendChild(o),r.appendChild(s),t.appendChild(r),r.setAttribute("sec",u),$(r).hover(function(){$(this).css("background-color","#faa166")},function(){$(this).removeAttr("style")}),$(r).click(function(){var e=$(this).attr("sec");paella.player.videoContainer.seekToTime(parseInt(e)),paella.player.play()})}})}},{key:"buildContent",value:function(e){var t=this,a=document.createElement("div");a.className="searchPluginContainer";var n=document.createElement("div");n.className="searchBody",a.appendChild(n),t._searchBody=n;var i=document.createElement("div");i.className="searchBar",a.appendChild(i);var r=document.createElement("input");r.className="searchBarInput",r.type="text",r.id="searchBarInput",r.name="searchString",r.placeholder=base.dictionary.translate("Search"),i.appendChild(r),$(r).change(function(){var e=$(r).val();null!=t._searchTimer&&t._searchTimer.cancel(),""!=e&&t.doSearch(e,n)}),$(r).keyup(function(e){if(13!=e.keyCode){var a=$(r).val();null!=t._searchTimer&&t._searchTimer.cancel(),""!=a?t._searchTimer=new base.Timer(function(e){t.doSearch(a,n)},t._searchTimerTime):$(t._searchBody).empty()}}),$(r).focus(function(){paella.keyManager.enabled=!1}),$(r).focusout(function(){paella.keyManager.enabled=!0}),e.appendChild(a)}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoOverlayButtonPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.showEditorPlugin"}},{key:"getSubclass",value:function(){return"showEditorButton"}},{key:"getIconClass",value:function(){return"icon-pencil"}},{key:"getAlignment",value:function(){return"right"}},{key:"getIndex",value:function(){return 10}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Enter editor mode")}},{key:"checkEnabled",value:function(e){this.config.editorUrl?paella.initDelegate.initParams.accessControl.canWrite().then(function(t){e(t)}):e(!1)}},{key:"action",value:function(e){var t=this.config.editorUrl.replace("{id}",paella.player.videoIdentifier);window.location.href=t}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"showSocialPluginButton"}},{key:"getIconClass",value:function(){return"icon-social"}},{key:"getIndex",value:function(){return 560}},{key:"getMinWindowSize",value:function(){return 600}},{key:"getName",value:function(){return"es.upv.paella.socialPlugin"}},{key:"checkEnabled",value:function(e){e(!0)}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Share this video")}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"setup",value:function(){if(this.buttonItems=null,this.socialMedia=null,this.buttons=[],this.selected_button=null,"es"==base.dictionary.currentLanguage()){base.dictionary.addDictionary({"Custom size:":"Tamao personalizado:","Choose your embed size. Copy the text and paste it in your html page.":"Elija el tamao del video a embeber. Copie el texto y pguelo en su pgina html.","Width:":"Ancho:","Height:":"Alto:"})}var e=this,t=13,a=38,n=40;$(this.button).keyup(function(i){e.isPopUpOpen()&&(i.keyCode==a?e.selected_button>0&&(e.selected_button<e.buttons.length&&(e.buttons[e.selected_button].className="socialItemButton "+e.buttons[e.selected_button].data.mediaData),e.selected_button--,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):i.keyCode==n?e.selected_button<e.buttons.length-1&&(e.selected_button>=0&&(e.buttons[e.selected_button].className="socialItemButton "+e.buttons[e.selected_button].data.mediaData),e.selected_button++,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):i.keyCode==t&&e.onItemClick(e.buttons[e.selected_button].data.mediaData))})}},{key:"buildContent",value:function(e){var t=this;this.buttonItems={},this.socialMedia=["facebook","twitter","embed"],this.socialMedia.forEach(function(a){var n=t.getSocialMediaItemButton(a);t.buttonItems[t.socialMedia.indexOf(a)]=n,e.appendChild(n),t.buttons.push(n)}),this.selected_button=this.buttons.length}},{key:"getSocialMediaItemButton",value:function(e){var t=document.createElement("div");return t.className="socialItemButton "+e,t.id=e+"_button",t.data={mediaData:e,plugin:this},$(t).click(function(e){this.data.plugin.onItemClick(this.data.mediaData)}),t}},{key:"onItemClick",value:function(e){var t=this.getVideoUrl();switch(e){case"twitter":window.open("http://twitter.com/home?status="+t);break;case"facebook":window.open("http://www.facebook.com/sharer.php?u="+t);break;case"embed":this.embedPress()}paella.player.controls.hidePopUp(this.getName())}},{key:"getVideoUrl",value:function(){return document.location.href}},{key:"embedPress",value:function(){var e=document.location.protocol+"//"+document.location.host,t=document.location.pathname.split("/");t.length>0&&(t[t.length-1]="embed.html");var a=paella.initDelegate.getId(),n=e+t.join("/")+"?id="+a,i="<div id='embedContent' style='text-align:left; font-size:14px; color:black;'><div id=''>"+("<div style='display:inline-block;'>     <div class='embedSizeButton' style='width:110px; height:73px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 620x349 </span></div>    <div class='embedSizeButton' style='width:100px; height:65px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 540x304 </span></div>    <div class='embedSizeButton' style='width:90px;  height:58px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 460x259 </span></div>    <div class='embedSizeButton' style='width:80px;  height:50px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 380x214 </span></div>    <div class='embedSizeButton' style='width:70px;  height:42px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 300x169 </span></div></div><div style='display:inline-block; vertical-align:bottom; margin-left:10px;'>    <div>"+base.dictionary.translate("Custom size:")+"</div>    <div>"+base.dictionary.translate("Width:")+" <input id='social_embed_width-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div>    <div>"+base.dictionary.translate("Height:")+" <input id='social_embed_height-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div></div>")+"</div> <div id=''>"+base.dictionary.translate("Choose your embed size. Copy the text and paste it in your html page.")+"</div> <div id=''><textarea id='social_embed-textarea' class='social_embed-textarea' rows='4' cols='1' style='font-size:12px; width:95%; overflow:auto; margin-top:5px; color:black;'></textarea></div>  </div>";paella.messageBox.showMessage(i,{closeButton:!0,width:"750px",height:"210px",onClose:function(){}});var r=$("#social_embed_width-input")[0],o=$("#social_embed_height-input")[0];r.onkeyup=function(e){var t=parseInt(r.value),a=parseInt(o.value);isNaN(t)?r.value="":t<300?$("#social_embed-textarea")[0].value="Embed width too low. The minimum value is a width of 300.":(isNaN(a)&&(a=(t/(16/9)).toFixed(),o.value=a),$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+n+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+t+'" height="'+a+'"></iframe>')};for(var l=$(".embedSizeButton"),s=0;s<l.length;s+=1){l[s].onclick=function(e){var t=e.target?e.target.textContent:e.toElement.textContent;if(t){var a=t.trim().split("x");r.value=a[0],o.value=a[1],$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+n+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+a[0]+'" height="'+a[1]+'"></iframe>'}}}}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.test.videoLoadPlugin"}},{key:"checkEnabled",value:function(e){if(this.startTime=0,this.endTime=0,this.startTime=Date.now(),"es"==base.dictionary.currentLanguage()){base.dictionary.addDictionary({"Video loaded in {0} seconds":"Video cargado en {0} segundos"})}e(!0)}},{key:"getEvents",value:function(){return[paella.events.loadComplete]}},{key:"onEvent",value:function(e,t){switch(e){case paella.events.loadComplete:this.onLoadComplete()}}},{key:"onLoadComplete",value:function(){this.endTime=Date.now();var e=(this.endTime-this.startTime)/1e3;this.showOverlayMessage(base.dictionary.translate("Video loaded in {0} seconds").replace(/\{0\}/g,e))}},{key:"showOverlayMessage",value:function(e){var t=paella.player.videoContainer.overlayContainer,a=document.createElement("div");a.className="videoLoadTestOverlay";var n=document.createElement("div");n.className="btn",n.innerText="X",n.onclick=function(){t.removeElement(a)};var i=document.createElement("div");i.className="videoLoadTest",i.innerText=e,i.appendChild(n),a.appendChild(i),t.addElement(a,{left:40,top:50,width:430,height:80})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"themeChooserPlugin"}},{key:"getIconClass",value:function(){return"icon-paintbrush"}},{key:"getIndex",value:function(){return 2030}},{key:"getMinWindowSize",value:function(){return 600}},{key:"getName",value:function(){return"es.upv.paella.themeChooserPlugin"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Change theme")}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"checkEnabled",value:function(e){this.currentUrl=null,this.currentMaster=null,this.currentSlave=null,this.availableMasters=[],this.availableSlaves=[],paella.player.config.skin&&paella.player.config.skin.available&&paella.player.config.skin.available instanceof Array&&paella.player.config.skin.available.length>0?e(!0):e(!1)}},{key:"buildContent",value:function(e){var t=this;paella.player.config.skin.available.forEach(function(a){var n=document.createElement("div");n.className="themebutton",n.innerText=a.replace("-"," ").replace("_"," "),$(n).click(function(e){paella.utils.skin.set(a),paella.player.controls.hidePopUp(t.getName())}),e.appendChild(n)})}}]),t}()}),paella.addDataDelegate("cameraTrack",function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.DataDelegate),_createClass(t,[{key:"read",value:function(e,t,a){var n=paella.player.videoLoader.getVideoUrl();n?(n+="trackhd.json",paella.utils.ajax.get({url:n},function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}e.positions.sort(function(e,t){return e.time-t.time}),a(e)},function(){return a(null)})):a(null)}},{key:"write",value:function(e,t,a,n){}},{key:"remove",value:function(e,t,a){}}]),t}()}),function(){var e=null;function t(e,t){var a=t?1e3*(t.time-e.time):100;a>2e3&&(a=2e3);var n=e&&e.rect||[0,0,0,0],i=Math.abs(n[0]),r=Math.abs(n[1]),o=n[2],l=(n[3],this._videoData.originalWidth/o),s=i/this._videoData.originalWidth,u=r/this._videoData.originalHeight;paella.player.videoContainer.masterVideo().setZoom(100*l,s*l*100,u*l*100,a)}paella.addPlugin(function(){return function(a){function n(){var t;return _classCallCheck(this,n),t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this)),e=_assertThisInitialized(t),t._videoData={},t._trackData=[],t._enabled=!0,t}return _inherits(n,paella.EventDrivenPlugin),_createClass(n,[{key:"checkEnabled",value:function(e){var t=this;paella.data.read("cameraTrack",{id:paella.initDelegate.getId()},function(a){a?(t._videoData.width=a.width,t._videoData.height=a.height,t._videoData.originalWidth=a.originalWidth,t._videoData.originalHeight=a.originalHeight,t._trackData=a.positions,t._enabled=!0):t._enabled=!1,e(t._enabled)})}},{key:"getName",value:function(){return"es.upv.paella.track4kPlugin"}},{key:"getEvents",value:function(){return[paella.events.timeupdate,paella.events.play,paella.events.seekToTime]}},{key:"onEvent",value:function(e,t){this._trackData.length&&(e===paella.events.play||(e===paella.events.timeupdate?this.updateZoom(t.currentTime):e===paella.events.seekToTime&&this.seekTo(t.newPosition)))}},{key:"updateZoom",value:function(e){if(this._enabled){var a=function(e){var t=null;return e=Math.round(e),this._trackData.some(function(a,n,i){return a.time<=e&&(i[n+1]?i[n+1].time>e&&(t=a):t=a),null!==t}),t}.apply(this,[e]),n=function(e){var t=-1;return e=Math.round(e),this._trackData.some(function(a,n){return a.time>=e&&(t=n),-1!==t}),this._trackData.length>t+1?this._trackData[t+1]:null}.apply(this,[e]);a&&this._lastPosition!==a&&(this._lastPosition=a,t.apply(this,[a,n]))}}},{key:"seekTo",value:function(e){var a=function(e){var t=this._trackData[0];return e=Math.round(e),this._trackData.some(function(a,n,i){return!i[n+1]||a.time<=e&&i[n+1].time>e||(t=a,!1)}),t}.apply(this,[e]);a&&this._enabled&&(this._lastPosition=a,t.apply(this,[a]))}},{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled=e,this._enabled){var t=this;paella.player.videoContainer.currentTime().then(function(e){t.updateZoom(e)})}}}]),n}()}),paella.addPlugin(function(){return function(t){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}return _inherits(a,paella.ButtonPlugin),_createClass(a,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"videoZoomToolbar"}},{key:"getIconClass",value:function(){return"icon-screen"}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"getIndex",value:function(){return 2030}},{key:"getMinWindowSize",value:function(){return paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||600}},{key:"getName",value:function(){return"es.upv.paella.videoZoomTrack4kPlugin"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Set video zoom")}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"checkEnabled",value:function(t){var a=paella.player.videoContainer.streamProvider.videoPlayers,n=paella.player.config.plugins.list[this.getName()],i=n.targetStreamIndex,r=n.autoModeByDefault;this.targetPlayer=a.length>i?a[i]:null,e.enabled=r,t(paella.player.config.player.videoZoom.enabled&&this.targetPlayer&&this.targetPlayer.allowZoom())}},{key:"setup",value:function(){this.config.autoModeByDefault?this.zoomAuto():this.resetZoom()}},{key:"buildContent",value:function(t){var a=this;function n(e,t,a){var n=document.createElement("div");return n.className="videoZoomToolbarItem ".concat(e),a?n.innerText=a:n.innerHTML='<i class="glyphicon glyphicon-'.concat(e,'"></i>'),$(n).click(t),n}this.changeIconClass("icon-mini-zoom-in"),e.updateTrackingStatus=function(){e.enabled?($(".zoom-auto").addClass("autoTrackingActivated"),$(".icon-mini-zoom-in").addClass("autoTrackingActivated")):($(".zoom-auto").removeClass("autoTrackingActivated"),$(".icon-mini-zoom-in").removeClass("autoTrackingActivated"))},paella.events.bind(paella.events.videoZoomChanged,function(t,a){e.updateTrackingStatus}),e.updateTrackingStatus,t.appendChild(n("zoom-in",function(e){a.zoomIn()})),t.appendChild(n("zoom-out",function(e){a.zoomOut()})),t.appendChild(n("picture",function(e){a.resetZoom()})),t.appendChild(n("zoom-auto",function(e){a.zoomAuto(),paella.player.controls.hidePopUp(a.getName())},"auto"))}},{key:"zoomIn",value:function(){e.enabled=!1,this.targetPlayer.zoomIn()}},{key:"zoomOut",value:function(){e.enabled=!1,this.targetPlayer.zoomOut()}},{key:"resetZoom",value:function(){e.enabled=!1,this.targetPlayer.setZoom(100,0,0,500),e.updateTrackingStatus&&e.updateTrackingStatus()}},{key:"zoomAuto",value:function(){e.enabled=!e.enabled,e.updateTrackingStatus&&e.updateTrackingStatus()}}]),a}()})}(),paella.plugins.translectures={},paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.userTracking.SaverPlugIn),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.usertracking.elasticsearchSaverPlugin"}},{key:"checkEnabled",value:function(e){this.type="userTrackingSaverPlugIn",this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking";var t=!0;null==this._url&&(t=!1,base.log.debug("No ElasticSearch URL found in config file. Disabling ElasticSearch PlugIn")),e(t)}},{key:"log",value:function(e,t){var a=this,n=t;"object"!=_typeof(n)&&(n={value:n});var i=0;paella.player.videoContainer.currentTime().then(function(e){return i=e,paella.player.videoContainer.paused()}).then(function(t){var r={date:new Date,video:paella.initDelegate.getId(),playing:!t,time:parseInt(i+paella.player.videoContainer.trimStart()),event:e,params:n};paella.ajax.post({url:a._url+"/"+a._index+"/"+a._type+"/",params:JSON.stringify(r)})})}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.userTracking.SaverPlugIn),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.usertracking.GoogleAnalyticsSaverPlugin"}},{key:"checkEnabled",value:function(e){var t,a,n,i,r,o,l=this.config.trackingID,s=this.config.domain||"auto";l?(base.log.debug("Google Analitycs Enabled"),t=window,a=document,n="script",i="__gaTracker",t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,r=a.createElement(n),o=a.getElementsByTagName(n)[0],r.async=1,r.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(r,o),__gaTracker("create",l,s),__gaTracker("send","pageview"),e(!0)):(base.log.debug("No Google Tracking ID found in config file. Disabling Google Analitycs PlugIn"),e(!1))}},{key:"log",value:function(e,t){if(void 0===this.config.category||!0===this.config.category){var a=this.config.category||"PaellaPlayer",n=e,i="";try{i=JSON.stringify(t)}catch(e){}__gaTracker("send","event",a,n,i)}}}]),t}()});var _paq=_paq||[];function onYouTubeIframeAPIReady(){paella.youtubePlayerVars.apiReadyPromise.resolve()}paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.userTracking.SaverPlugIn),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.usertracking.piwikSaverPlugIn"}},{key:"checkEnabled",value:function(e){this.config.tracker&&this.config.siteId?(_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var t=this.config.tracker;_paq.push(["setTrackerUrl",t+"/piwik.php"]),_paq.push(["setSiteId",this.config.siteId]);var a=document,n=a.createElement("script"),i=a.getElementsByTagName("script")[0];n.type="text/javascript",n.async=!0,n.defer=!0,n.src=t+"piwik.js",i.parentNode.insertBefore(n,i),e(!0)}()):e(!1)}},{key:"log",value:function(e,t){var a=this.config.category||"PaellaPlayer",n=e,i="";try{i=JSON.stringify(t)}catch(e){}_paq.push(["trackEvent",a,n,i])}}]),t}()}),function(){var e=function(e){function t(e,a,n,i,r,o,l){var s;_classCallCheck(this,t),(s=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,"canvas",0,0,1280,720)))._posterFrame=null,s._currentQuality=null,s._autoplay=!1,s._streamName=null,s._streamName=l||"video360";var u=_assertThisInitialized(s);return paella.player.videoContainer.disablePlayOnClick(),s._stream.sources[s._streamName]&&s._stream.sources[s._streamName].sort(function(e,t){return e.res.h-t.res.h}),s.video=null,new paella.Timer(function(e){u.canvasController&&u.canvasController.canvas.domElement},500).repeat=!0,s}return _inherits(t,paella.VideoElementBase),_createClass(t,[{key:"defaultProfile",value:function(){return"chroma"}},{key:"_setVideoElem",value:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)}},{key:"_loadDeps",value:function(){return new Promise(function(e,t){window.$paella_bg2e?defer.resolve(window.$paella_bg2e):paella.require(paella.baseUrl+"resources/deps/bg2e.js").then(function(){window.$paella_bg2e=bg,e(window.$paella_bg2e)}).catch(function(e){console.error(e.message),t()})})}},{key:"_deferredAction",value:function(e){var t=this;return new Promise(function(a,n){t.video?a(e()):$(t.video).bind("canplay",function(){t._ready=!0,a(e())})})}},{key:"_getQualityObject",value:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}}},{key:"allowZoom",value:function(){return!1}},{key:"getVideoData",value:function(){var e=this,t=this;return new Promise(function(a,n){e._deferredAction(function(){a({duration:t.video.duration,currentTime:t.video.currentTime,volume:t.video.volume,paused:t.video.paused,ended:t.video.ended,res:{w:t.video.videoWidth,h:t.video.videoHeight}})})})}},{key:"setPosterFrame",value:function(e){this._posterFrame=e}},{key:"setAutoplay",value:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)}},{key:"load",value:function(){var e=this;return new Promise(function(t,a){e._loadDeps().then(function(){var n=e._stream.sources[e._streamName];null===e._currentQuality&&e._videoQualityStrategy&&(e._currentQuality=e._videoQualityStrategy.getQualityIndex(n));var i=e._currentQuality<n.length?n[e._currentQuality]:null;e.video=null,i?(e.canvasController=null,function(e,t){var a=new(function(e){function t(e){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).stream=e,a}return _inherits(t,bg.app.WindowController),_createClass(t,[{key:"loaded",value:function(){var e=this;return new Promise(function(t){!function a(){e.video?t(e):setTimeout(a,100)}()})}},{key:"buildScene",value:function(){var e=this;this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(function(t){e.texture=t;var a=bg.scene.PrimitiveFactory.Sphere(e.gl,1,50),n=new bg.scene.Node(e.gl);n.addComponent(a),a.getMaterial(0).texture=t,a.getMaterial(0).lightEmission=1,a.getMaterial(0).lightEmissionMaskInvert=!0,a.getMaterial(0).cullFace=!1,e._root.addChild(n),e.postRedisplay()});var t=new bg.scene.Node(this.gl,"Light");this._root.addChild(t),this._camera=new bg.scene.Camera;var a=new bg.scene.Node("Camera");a.addComponent(this._camera),a.addComponent(new bg.scene.Transform);var n=new bg.manipulation.OrbitCameraController;a.addComponent(n),n.maxPitch=90,n.minPitch=-90,n.maxDistance=0,n.minDistace=0,this._root.addChild(a)}},{key:"init",value:function(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor}},{key:"frame",value:function(e){this.texture&&this.texture.update(),this._renderer.frame(this._root,e)}},{key:"display",value:function(){this._renderer.display(this._root,this._camera)}},{key:"reshape",value:function(e,t){this._camera.viewport=new bg.Viewport(0,0,e,t),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)}},{key:"mouseDown",value:function(e){this._inputVisitor.mouseDown(this._root,e)}},{key:"mouseDrag",value:function(e){this._inputVisitor.mouseDrag(this._root,e),this.postRedisplay()}},{key:"mouseWheel",value:function(e){this._inputVisitor.mouseWheel(this._root,e),this.postRedisplay()}},{key:"touchStart",value:function(e){this._inputVisitor.touchStart(this._root,e)}},{key:"touchMove",value:function(e){this._inputVisitor.touchMove(this._root,e),this.postRedisplay()}},{key:"mouseUp",value:function(e){this._inputVisitor.mouseUp(this._root,e)}},{key:"mouseMove",value:function(e){this._inputVisitor.mouseMove(this._root,e)}},{key:"mouseOut",value:function(e){this._inputVisitor.mouseOut(this._root,e)}},{key:"touchEnd",value:function(e){this._inputVisitor.touchEnd(this._root,e)}},{key:"video",get:function(){return this.texture?this.texture.video:null}}]),t}())(e),n=bg.app.MainLoop.singleton;return n.updateMode=bg.app.FrameUpdate.AUTO,n.canvas=t,n.run(a),a.loaded()}(i,e.domElement).then(function(a){e.canvasController=a,e.video=a.video,e.video.pause(),e.disableEventCapture(),t(i)})):a(new Error("Could not load video: invalid quality stream index"))})})}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t,a){setTimeout(function(){var a=[],n=e._stream.sources[e._streamName],i=-1;n.forEach(function(t){i++,a.push(e._getQualityObject(i,t))}),t(a)},10)})}},{key:"setQuality",value:function(e){var t=this;return new Promise(function(a){var n=t.video.paused,i=t._stream.sources[t._streamName];t._currentQuality=e<i.length?e:0;var r=t.video.currentTime;t.freeze().then(function(){return t._ready=!1,t.load()}).then(function(){n||t.play(),$(t.video).on("seeked",function(){t.unFreeze(),a(),$(t.video).off("seeked")}),t.video.currentTime=r})})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t){t(e._getQualityObject(e._currentQuality,e._stream.sources[e._streamName][e._currentQuality]))})}},{key:"play",value:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,e.video.play()})}},{key:"pause",value:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,e.video.pause()})}},{key:"isPaused",value:function(){var e=this;return this._deferredAction(function(){return e.video.paused})}},{key:"duration",value:function(){var e=this;return this._deferredAction(function(){return e.video.duration})}},{key:"setCurrentTime",value:function(e){var t=this;return this._deferredAction(function(){t.video.currentTime=e,$(t.video).on("seeked",function(){t.canvasController.postRedisplay(),$(t.video).off("seeked")})})}},{key:"currentTime",value:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})}},{key:"setVolume",value:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e})}},{key:"volume",value:function(){var e=this;return this._deferredAction(function(){return e.video.volume})}},{key:"setPlaybackRate",value:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})}},{key:"playbackRate",value:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})}},{key:"goFullScreen",value:function(){var e=this;return this._deferredAction(function(){var t=e.video;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitEnterFullscreen&&t.webkitEnterFullscreen()})}},{key:"unFreeze",value:function(){var e=this;return this._deferredAction(function(){var t=document.getElementById(e.video.className+"canvas");$(t).remove()})}},{key:"freeze",value:function(){return this._deferredAction(function(){})}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}}]),t}();paella.Video360=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"isStreamCompatible",value:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("video360"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Video360(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.Video360Factory=t}(),function(){function e(e,t){function a(e,t,a){var n,i,r=(n=((e+90)/180-1)*Math.PI,i=(.5-t/180)*Math.PI,new bg.Vector3(Math.cos(i)*Math.cos(n),Math.cos(i)*Math.sin(n),Math.sin(i))),o=function(e,t,a){var n=a;return a<-1?n=-1:a>1&&(n=1),new bg.Vector2(Math.atan2(t,e),Math.acos(n)/Math.PI)}(Math.sin(-.5*Math.PI)*r.z+Math.cos(-.5*Math.PI)*r.x,r.y,Math.cos(-.5*Math.PI)*r.z-Math.sin(-.5*Math.PI)*r.x),l=0===a?.883*o.y*Math.cos(o.x)*.5+.25:.883*(1-o.y)*Math.cos(-1*o.x+Math.PI)*.5+.75,s=0===a?.784888888888881*o.y*Math.sin(o.x)+.55555555555556:.784888888888881*(1-o.y)*Math.sin(-1*o.x+Math.PI)+.55555555555556;return new bg.Vector2(l,s)}var n=new(function(e){function t(e){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).stream=e,a}return _inherits(t,bg.app.WindowController),_createClass(t,[{key:"loaded",value:function(){var e=this;return new Promise(function(t){!function a(){e.video?t(e):setTimeout(a,100)}()})}},{key:"buildScene",value:function(){var e=this;this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(function(t){e.texture=t;var n=function(e){var t=new bg.scene.Node(e),n=new bg.scene.Drawable;t.addComponent(n);for(var i=new bg.base.PolyList(e),r=[],o=[],l=[],s=0;s<=180;s+=5){for(var u=0;u<=360;u+=5)r.push(new bg.Vector3(Math.sin(Math.PI*s/180)*Math.sin(Math.PI*u/180)*1,1*Math.cos(Math.PI*s/180),Math.sin(Math.PI*s/180)*Math.cos(Math.PI*u/180)*1)),o.push(new bg.Vector3(0,0,-1));for(var c=0;c<=180;c+=5)l.push(a(c,s,0));for(var d=180;d<=360;d+=5)l.push(a(d,s,1))}function p(e,t,a,n,r,o,l,s,u){i.vertex.push(e.x),i.vertex.push(e.y),i.vertex.push(e.z),i.vertex.push(t.x),i.vertex.push(t.y),i.vertex.push(t.z),i.vertex.push(a.x),i.vertex.push(a.y),i.vertex.push(a.z),i.normal.push(n.x),i.normal.push(n.y),i.normal.push(n.z),i.normal.push(r.x),i.normal.push(r.y),i.normal.push(r.z),i.normal.push(o.x),i.normal.push(o.z),i.normal.push(o.z),i.texCoord0.push(l.x),i.texCoord0.push(l.y),i.texCoord0.push(s.x),i.texCoord0.push(s.y),i.texCoord0.push(u.x),i.texCoord0.push(u.y),i.index.push(i.index.length),i.index.push(i.index.length),i.index.push(i.index.length)}for(var h=0;h<36;h++)for(var v=0;v<72;v++){var f=73*h+v,m=v<36?74*h+v:74*h+v+1;l[m+0],l[m+1],l[m+74],l[m+1],l[m+75],l[m+74];var g=r[f+0],y=o[f+0],_=l[m+0],b=r[f+1],k=o[f+1],C=l[m+1],A=r[f+73],P=o[f+73],w=l[m+74],E=r[f+74],T=o[f+74],x=l[m+75];p(g,b,A,y,k,P,_,C,w),p(b,E,A,k,T,P,C,x,w)}i.build(),n.addPolyList(i);var S=bg.Matrix4.Scale(-1,1,1);return t.addComponent(new bg.scene.Transform(S)),t}(e.gl),i=n.component("bg.scene.Drawable");i.getMaterial(0).texture=t,i.getMaterial(0).lightEmission=1,i.getMaterial(0).lightEmissionMaskInvert=!0,i.getMaterial(0).cullFace=!1,e._root.addChild(n),e.postRedisplay()});var t=new bg.scene.Node(this.gl,"Light");this._root.addChild(t),this._camera=new bg.scene.Camera;var n=new bg.scene.Node("Camera");n.addComponent(this._camera),n.addComponent(new bg.scene.Transform);var i=new bg.manipulation.OrbitCameraController;n.addComponent(i),i.maxPitch=90,i.minPitch=-90,i.maxDistance=0,i.minDistace=0,this._root.addChild(n)}},{key:"init",value:function(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor}},{key:"frame",value:function(e){this.texture&&this.texture.update(),this._renderer.frame(this._root,e)}},{key:"display",value:function(){this._renderer.display(this._root,this._camera)}},{key:"reshape",value:function(e,t){this._camera.viewport=new bg.Viewport(0,0,e,t),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)}},{key:"mouseDown",value:function(e){this._inputVisitor.mouseDown(this._root,e)}},{key:"mouseDrag",value:function(e){this._inputVisitor.mouseDrag(this._root,e),this.postRedisplay()}},{key:"mouseWheel",value:function(e){this._inputVisitor.mouseWheel(this._root,e),this.postRedisplay()}},{key:"touchStart",value:function(e){this._inputVisitor.touchStart(this._root,e)}},{key:"touchMove",value:function(e){this._inputVisitor.touchMove(this._root,e),this.postRedisplay()}},{key:"mouseUp",value:function(e){this._inputVisitor.mouseUp(this._root,e)}},{key:"mouseMove",value:function(e){this._inputVisitor.mouseMove(this._root,e)}},{key:"mouseOut",value:function(e){this._inputVisitor.mouseOut(this._root,e)}},{key:"touchEnd",value:function(e){this._inputVisitor.touchEnd(this._root,e)}},{key:"video",get:function(){return this.texture?this.texture.video:null}}]),t}())(e),i=bg.app.MainLoop.singleton;return i.updateMode=bg.app.FrameUpdate.AUTO,i.canvas=t,i.run(n),n.loaded()}var t=function(t){function a(e,t,n,i,r,o,l){var s;_classCallCheck(this,a),(s=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e,t,"canvas",0,0,1280,720)))._posterFrame=null,s._currentQuality=null,s._autoplay=!1,s._streamName=null,s._streamName=l||"video360theta";var u=_assertThisInitialized(s);return paella.player.videoContainer.disablePlayOnClick(),s._stream.sources[s._streamName]&&s._stream.sources[s._streamName].sort(function(e,t){return e.res.h-t.res.h}),s.video=null,new paella.Timer(function(e){u.canvasController&&u.canvasController.canvas.domElement},500).repeat=!0,s}return _inherits(a,paella.VideoElementBase),_createClass(a,[{key:"defaultProfile",value:function(){return"chroma"}},{key:"_setVideoElem",value:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)}},{key:"_loadDeps",value:function(){return new Promise(function(e,t){window.$paella_bg2e?defer.resolve(window.$paella_bg2e):paella.require(paella.baseUrl+"resources/deps/bg2e.js").then(function(){window.$paella_bg2e=bg,e(window.$paella_bg2e)}).catch(function(e){console.error(e.message),t()})})}},{key:"_deferredAction",value:function(e){var t=this;return new Promise(function(a,n){t.video?a(e()):$(t.video).bind("canplay",function(){t._ready=!0,a(e())})})}},{key:"_getQualityObject",value:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}}},{key:"allowZoom",value:function(){return!1}},{key:"getVideoData",value:function(){var e=this,t=this;return new Promise(function(a,n){e._deferredAction(function(){a({duration:t.video.duration,currentTime:t.video.currentTime,volume:t.video.volume,paused:t.video.paused,ended:t.video.ended,res:{w:t.video.videoWidth,h:t.video.videoHeight}})})})}},{key:"setPosterFrame",value:function(e){this._posterFrame=e}},{key:"setAutoplay",value:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)}},{key:"load",value:function(){var t=this;return new Promise(function(a,n){t._loadDeps().then(function(){var i=t._stream.sources[t._streamName];null===t._currentQuality&&t._videoQualityStrategy&&(t._currentQuality=t._videoQualityStrategy.getQualityIndex(i));var r=t._currentQuality<i.length?i[t._currentQuality]:null;t.video=null,r?(t.canvasController=null,e(r,t.domElement).then(function(e){t.canvasController=e,t.video=e.video,t.video.pause(),t.disableEventCapture(),a(r)})):n(new Error("Could not load video: invalid quality stream index"))})})}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t,a){setTimeout(function(){var a=[],n=e._stream.sources[e._streamName],i=-1;n.forEach(function(t){i++,a.push(e._getQualityObject(i,t))}),t(a)},10)})}},{key:"setQuality",value:function(e){var t=this;return new Promise(function(a){var n=t.video.paused,i=t._stream.sources[t._streamName];t._currentQuality=e<i.length?e:0;var r=t.video.currentTime;t.freeze().then(function(){return t._ready=!1,t.load()}).then(function(){n||t.play(),$(t.video).on("seeked",function(){t.unFreeze(),a(),$(t.video).off("seeked")}),t.video.currentTime=r})})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t){t(e._getQualityObject(e._currentQuality,e._stream.sources[e._streamName][e._currentQuality]))})}},{key:"play",value:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,e.video.play()})}},{key:"pause",value:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,e.video.pause()})}},{key:"isPaused",value:function(){var e=this;return this._deferredAction(function(){return e.video.paused})}},{key:"duration",value:function(){var e=this;return this._deferredAction(function(){return e.video.duration})}},{key:"setCurrentTime",value:function(e){var t=this;return this._deferredAction(function(){t.video.currentTime=e,$(t.video).on("seeked",function(){t.canvasController.postRedisplay(),$(t.video).off("seeked")})})}},{key:"currentTime",value:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})}},{key:"setVolume",value:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e})}},{key:"volume",value:function(){var e=this;return this._deferredAction(function(){return e.video.volume})}},{key:"setPlaybackRate",value:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})}},{key:"playbackRate",value:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})}},{key:"goFullScreen",value:function(){var e=this;return this._deferredAction(function(){var t=e.video;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitEnterFullscreen&&t.webkitEnterFullscreen()})}},{key:"unFreeze",value:function(){var e=this;return this._deferredAction(function(){var t=document.getElementById(e.video.className+"canvas");$(t).remove()})}},{key:"freeze",value:function(){return this._deferredAction(function(){})}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}}]),a}();paella.Video360Theta=t;var a=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"isStreamCompatible",value:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("video360theta"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Video360Theta(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.Video360ThetaFactory=a}(),paella.addDataDelegate("metadata",function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.DataDelegate),_createClass(t,[{key:"read",value:function(e,t,a){a(paella.player.videoLoader.getMetadata()[t],!0)}},{key:"write",value:function(e,t,a,n){n({},!0)}},{key:"remove",value:function(e,t,a){a({},!0)}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoOverlayButtonPlugin),_createClass(t,[{key:"getIndex",value:function(){return 10}},{key:"getSubclass",value:function(){return"videoData"}},{key:"getAlignment",value:function(){return"left"}},{key:"getDefaultToolTip",value:function(){return""}},{key:"checkEnabled",value:function(e){var t=paella.player.config.plugins.list["es.upv.paella.videoDataPlugin"],a=t&&t.excludeLocations||[],n=t&&t.excludeParentLocations||[],i=a.some(function(e){return RegExp(e,"i").test(location.href)});window!=window.parent&&(i=i||n.some(function(e){var t=RegExp(e,"i");try{return t.test(parent.location.href)}catch(e){return!1}})),e(!i)}},{key:"setup",value:function(){var e=document.createElement("h1");e.innerText="",e.className="videoTitle",this.button.appendChild(e),paella.data.read("metadata","title",function(t){e.innerText=t})}},{key:"action",value:function(e){}},{key:"getName",value:function(){return"es.upv.paella.videoDataPlugin"}}]),t}()}),paella.addPlugin(function(){var e=320,t=180;return function(a){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,_getPrototypeOf(n).apply(this,arguments))}return _inherits(n,paella.VideoOverlayButtonPlugin),_createClass(n,[{key:"getIndex",value:function(){return 10}},{key:"getSubclass",value:function(){return"videoZoom"}},{key:"getAlignment",value:function(){return"right"}},{key:"getDefaultToolTip",value:function(){return""}},{key:"checkEnabled",value:function(e){e(!0)}},{key:"setup",value:function(){var a=this;function n(){var e=$(".videoZoomButton"),t=$(".videoZoom");this._visible&&this._available?(e.show(),t.show()):(e.hide(),t.hide())}this._thumbnails=[],this._visible=!1,this._available=!1,paella.player.videoContainer.streamProvider.videoPlayers.forEach(function(i,r){i.allowZoom()&&(a._available=i.zoomAvailable(),a._visible=a._available,function(e){var t=e.parent.domElement,a=document.createElement("div");t.appendChild(a),a.className="videoZoomButton btn zoomIn",a.innerHTML='<i class="glyphicon glyphicon-zoom-in"></i>',$(a).on("mousedown",function(){paella.player.videoContainer.disablePlayOnClick(),e.zoomIn()}),$(a).on("mouseup",function(){setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10)}),a=document.createElement("div"),t.appendChild(a),a.className="videoZoomButton btn zoomOut",a.innerHTML='<i class="glyphicon glyphicon-zoom-out"></i>',$(a).on("mousedown",function(){paella.player.videoContainer.disablePlayOnClick(),e.zoomOut()}),$(a).on("mouseup",function(){setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10)})}.apply(a,[i]),i.supportsCaptureFrame().then(function(o){if(o){var l=document.createElement("div");l.className="zoom-container";var s=function(a){var n=document.createElement("canvas");return n.width=e,n.height=t,n.className="zoom-thumbnail",n.id="zoomContainer"+a,n}.apply(a,[r]),u=function(){var e=document.createElement("div");return e.className="zoom-rect",e}.apply(a);a.button.appendChild(l),l.appendChild(s),l.appendChild(u),$(l).hide(),a._thumbnails.push({player:i,thumbContainer:l,zoomRect:u,canvas:s}),n.apply(a)}}))});var i=!1;paella.events.bind(paella.events.play,function(n){i=!0,function n(){a._thumbnails.forEach(function(a){var n,i,r;i=(n=a).player,r=n.canvas,i.captureFrame().then(function(a){r.getContext("2d").drawImage(a.source,0,0,e,t)})}),i&&setTimeout(function(){n()},2e3)}()}),paella.events.bind(paella.events.pause,function(e){i=!1}),paella.events.bind(paella.events.videoZoomChanged,function(e,t){a._thumbnails.some(function(e){if(e.player==t.video){if(e.player.zoom>100){$(e.thumbContainer).show();var a=100*t.video.zoomOffset.x/t.video.zoom,n=100*t.video.zoomOffset.y/t.video.zoom,i=e.zoomRect;$(i).css({left:a+"%",top:n+"%",width:1e4/t.video.zoom+"%",height:1e4/t.video.zoom+"%"})}else $(e.thumbContainer).hide();return!0}})}),paella.events.bind(paella.events.zoomAvailabilityChanged,function(e,t){a._available=t.available,a._visible=t.available,n.apply(a)}),paella.events.bind(paella.events.controlBarDidHide,function(){a._visible=!1,n.apply(a)}),paella.events.bind(paella.events.controlBarDidShow,function(){a._visible=!0,n.apply(a)})}},{key:"action",value:function(e){}},{key:"getName",value:function(){return"es.upv.paella.videoZoomPlugin"}}]),n}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"videoZoomToolbar"}},{key:"getIconClass",value:function(){return"icon-screen"}},{key:"getIndex",value:function(){return 2030}},{key:"getMinWindowSize",value:function(){return paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||600}},{key:"getName",value:function(){return"es.upv.paella.videoZoomToolbarPlugin"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Set video zoom")}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"checkEnabled",value:function(e){var t=paella.player.videoContainer.streamProvider.videoPlayers,a=paella.player.config.plugins.list["es.upv.paella.videoZoomToolbarPlugin"].targetStreamIndex;this.targetPlayer=t.length>a?t[a]:null,e(paella.player.config.player.videoZoom.enabled&&this.targetPlayer&&this.targetPlayer.allowZoom())}},{key:"buildContent",value:function(e){var t=this;function a(e,t){var a=document.createElement("div");return a.className="videoZoomToolbarItem ".concat(e),a.innerHTML='<i class="glyphicon glyphicon-'.concat(e,'"></i>'),$(a).click(t),a}paella.events.bind(paella.events.videoZoomChanged,function(e,a){t.setText(Math.round(a.video.zoom)+"%")}),this.setText("100%"),e.appendChild(a("zoom-in",function(e){t.targetPlayer.zoomIn()})),e.appendChild(a("zoom-out",function(e){t.targetPlayer.zoomOut()}))}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"showViewModeButton"}},{key:"getIconClass",value:function(){return"icon-presentation-mode"}},{key:"getIndex",value:function(){return 540}},{key:"getMinWindowSize",value:function(){return 300}},{key:"getName",value:function(){return"es.upv.paella.viewModePlugin"}},{key:"getButtonType",value:function(){return paella.ButtonPlugin.type.popUpButton}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Change video layout")}},{key:"checkEnabled",value:function(e){this.buttonItems=null,this.buttons=[],this.selected_button=null,this.active_profiles=null,this.active_profiles=this.config.activeProfiles,e(!paella.player.videoContainer.isMonostream)}},{key:"closeOnMouseOut",value:function(){return!0}},{key:"setup",value:function(){var e=this,t=13,a=38,n=40;paella.events.bind(paella.events.setProfile,function(t,a){e.onProfileChange(a.profileName)}),$(this.button).keyup(function(i){e.isPopUpOpen()&&(i.keyCode==a?e.selected_button>0&&(e.selected_button<e.buttons.length&&(e.buttons[e.selected_button].className="viewModeItemButton "+e.buttons[e.selected_button].data.profile),e.selected_button--,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):i.keyCode==n?e.selected_button<e.buttons.length-1&&(e.selected_button>=0&&(e.buttons[e.selected_button].className="viewModeItemButton "+e.buttons[e.selected_button].data.profile),e.selected_button++,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):i.keyCode==t&&e.onItemClick(e.buttons[e.selected_button],e.buttons[e.selected_button].data.profile,e.buttons[e.selected_button].data.profile))})}},{key:"rebuildProfileList",value:function(){var e=this;this.buttonItems={},this.domElement.innerText="",paella.profiles.profileList.forEach(function(t){if(!t.hidden){if(e.active_profiles){var a=!1;if(e.active_profiles.forEach(function(e){e==profile&&(a=!0)}),0==a)return}var n=e.getProfileItemButton(t.id,t);e.buttonItems[t.id]=n,e.domElement.appendChild(n),e.buttons.push(n),paella.player.selectedProfile==t.id&&(e.buttonItems[t.id].className=e.getButtonItemClass(t.id,!0))}}),this.selected_button=this.buttons.length}},{key:"buildContent",value:function(e){var t=this;this.domElement=e,this.rebuildProfileList(),paella.events.bind(paella.events.profileListChanged,function(){t.rebuildProfileList()})}},{key:"getProfileItemButton",value:function(e,t){var a=document.createElement("div");a.className=this.getButtonItemClass(e,!1);var n=this.getButtonItemIcon(t);return n=n.replace(/\\/gi,"/"),a.style.backgroundImage="url(".concat(n,")"),a.id=e+"_button",a.data={profile:e,profileData:t,plugin:this},$(a).click(function(e){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),a}},{key:"onProfileChange",value:function(e){var t=this,a=this.buttonItems[e],n=this.buttonItems;Object.keys(n).forEach(function(e){t.buttonItems[e].className=t.getButtonItemClass(e,!1)}),a&&(a.className=t.getButtonItemClass(e,!0))}},{key:"onItemClick",value:function(e,t,a){this.buttonItems[t]&&paella.player.setProfile(t),paella.player.controls.hidePopUp(this.getName())}},{key:"getButtonItemClass",value:function(e,t){return"viewModeItemButton "+e+(t?" selected":"")}},{key:"getButtonItemIcon",value:function(e){return"".concat(paella.baseUrl,"resources/style/").concat(e.icon)}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.ButtonPlugin),_createClass(t,[{key:"getAlignment",value:function(){return"left"}},{key:"getSubclass",value:function(){return"volumeRangeButton"}},{key:"getIconClass",value:function(){return"icon-volume-high"}},{key:"getName",value:function(){return"es.upv.paella.volumeRangePlugin"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Volume")}},{key:"getIndex",value:function(){return 120}},{key:"getAriaLabel",value:function(){return base.dictionary.translate("Volume")}},{key:"checkEnabled",value:function(e){this._tempMasterVolume=0,this._inputMaster=null,this._control_NotMyselfEvent=!0,this._storedValue=!1,e(!base.userAgent.browser.IsMobileVersion)}},{key:"setup",value:function(){var e=this;paella.events.bind(paella.events.videoUnloaded,function(t,a){e.storeVolume()}),paella.events.bind(paella.events.singleVideoReady,function(t,a){e.loadStoredVolume(a)}),paella.events.bind(paella.events.setVolume,function(t,a){e.updateVolumeOnEvent(a)}),this._preMutedVolume=1}},{key:"updateVolumeOnEvent",value:function(e){this._control_NotMyselfEvent?this._inputMaster=e.master:this._control_NotMyselfEvent=!0}},{key:"storeVolume",value:function(){var e=this;paella.player.videoContainer.streamProvider.mainAudioPlayer.volume().then(function(t){e._tempMasterVolume=t,e._storedValue=!0})}},{key:"loadStoredVolume",value:function(e){0==this._storedValue&&this.storeVolume(),this._tempMasterVolume&&paella.player.videoContainer.setVolume(this._tempMasterVolume),this._storedValue=!1}},{key:"action",value:function(e){var t=this;paella.player.videoContainer.volume().then(function(e){0==e?paella.player.videoContainer.setVolume(t._preMutedVolume):(t._preMutedVolume=e,paella.player.videoContainer.setVolume(0))})}},{key:"getExpandableContent",value:function(){var e=this,t=document.createElement("input");this._inputMaster=t,t.type="range",t.min=0,t.max=1,t.step=.01,paella.player.videoContainer.audioPlayer.volume().then(function(e){t.value=e});var a=function(){var a=$(t).val();e._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume(a)};return $(t).bind("input",function(e){a()}),$(t).change(function(){a()}),paella.events.bind(paella.events.setVolume,function(a,n){t.value=n.master,e.updateClass()}),t}},{key:"updateClass",value:function(){var e=this,t="";paella.player.videoContainer.volume().then(function(a){t=void 0===a?"icon-volume-mid":0==a?"icon-volume-mute":a<.33?"icon-volume-low":a<.66?"icon-volume-mid":"icon-volume-high",e.changeIconClass(t)})}}]),t}()}),function(){var e=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"webmCapable",value:function(){var e=document.createElement("video");return!!e.canPlayType&&""!==e.canPlayType('video/webm; codecs="vp8, vorbis"')}},{key:"isStreamCompatible",value:function(e){try{if(!this.webmCapable())return!1;for(var t in e.sources)if("webm"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return new paella.Html5Video(e,t,a.x,a.y,a.w,a.h,"webm")}}]),t}();paella.videoFactories.WebmVideoFactory=e}(),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getName",value:function(){return"es.upv.paella.windowTitlePlugin"}},{key:"checkEnabled",value:function(e){var t=this;this._initDone=!1,paella.player.videoContainer.masterVideo().duration().then(function(e){t.loadTitle()}),e(!0)}},{key:"loadTitle",value:function(){var e=paella.player.videoLoader.getMetadata()&&paella.player.videoLoader.getMetadata().title;document.title=e||document.title,this._initDone=!0}}]),t}()}),function(){var e=function(e){function t(e,a,n,i,r,o){var l;return _classCallCheck(this,t),(l=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,a,"div",n,i,r,o)))._posterFrame=null,l._currentQuality=null,l._autoplay=!1,l._readyPromise=null,l._readyPromise=$.Deferred(),l}return _inherits(t,paella.VideoElementBase),_createClass(t,[{key:"_deferredAction",value:function(e){var t=this;return new Promise(function(a,n){t._readyPromise.then(function(){a(e())},function(){n()})})}},{key:"_getQualityObject",value:function(e,t){var a=0;switch(t){case"small":a=1;break;case"medium":a=2;break;case"large":a=3;break;case"hd720":a=4;break;case"hd1080":a=5;break;case"highres":a=6}return{index:e,res:{w:null,h:null},src:null,label:t,level:a,bitrate:a,toString:function(){return this.label},shortLabel:function(){return this.label},compare:function(e){return this.level-e.level}}}},{key:"_onStateChanged",value:function(e){console.log("On state changed")}},{key:"getVideoData",value:function(){var e=this,t=this;return new Promise(function(a,n){var i=e._stream.sources.youtube[0];e._deferredAction(function(){var e={duration:t.video.getDuration(),currentTime:t.video.getCurrentTime(),volume:t.video.getVolume(),paused:!t._playing,ended:t.video.ended,res:{w:i.res.w,h:i.res.h}};a(e)})})}},{key:"setPosterFrame",value:function(e){this._posterFrame=e}},{key:"setAutoplay",value:function(e){this._autoplay=e}},{key:"setRect",value:function(e,t){this._rect=JSON.parse(JSON.stringify(e));var a=new paella.RelativeVideoSize,n={top:a.percentVSize(e.top)+"%",left:a.percentWSize(e.left)+"%",width:a.percentWSize(e.width)+"%",height:a.percentVSize(e.height)+"%",position:"absolute"};if(t){this.disableClassName();var i=this;$("#"+this.identifier).animate(n,400,function(){i.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:i})}),this.enableClassNameAfter(400)}else $("#"+this.identifier).css(n),paella.events.trigger(paella.events.setComposition,{video:this})}},{key:"setVisible",value:function(e,t){"true"==e&&t?($("#"+this.identifier).show(),$("#"+this.identifier).animate({opacity:1},300)):"true"!=e||t?"false"==e&&t?$("#"+this.identifier).animate({opacity:0},300):"false"!=e||t||$("#"+this.identifier).hide():$("#"+this.identifier).show()}},{key:"setLayer",value:function(e){$("#"+this.identifier).css({zIndex:e})}},{key:"load",value:function(){var e=this,t=this;return new Promise(function(a,n){e._qualityListReadyPromise=$.Deferred(),paella.youtubePlayerVars.apiReadyPromise.then(function(){var i=e._stream.sources.youtube[0];i?(e._youtubePlayer=new YT.Player(t.identifier,{height:"390",width:"640",videoId:i.id,playerVars:{controls:0,disablekb:1},events:{onReady:function(e){t._readyPromise.resolve()},onStateChanged:function(e){console.log("state changed")},onPlayerStateChange:function(e){console.log("state changed")}}}),a()):n(new Error("Could not load video: invalid quality stream index"))})})}},{key:"getQualities",value:function(){var e=this;return new Promise(function(t,a){e._qualityListReadyPromise.then(function(a){var n=[],i=-1;e._qualities={},a.forEach(function(t){i++,e._qualities[t]=e._getQualityObject(i,t),n.push(e._qualities[t])}),t(n)})})}},{key:"setQuality",value:function(e){var t=this;return new Promise(function(a,n){t._qualityListReadyPromise.then(function(n){for(var i in t._qualities){var r=t._qualities[i];if("object"==_typeof(r)&&r.index==e){t.video.setPlaybackQuality(r.label);break}}a()})})}},{key:"getCurrentQuality",value:function(){var e=this;return new Promise(function(t,a){e._qualityListReadyPromise.then(function(a){t(e._qualities[e.video.getPlaybackQuality()])})})}},{key:"play",value:function(){var e=this,t=this;return new Promise(function(a,n){t._playing=!0,t.video.playVideo(),new base.Timer(function(t){var n=e.video.getAvailableQualityLevels();n.length?(t.repeat=!1,e._qualityListReadyPromise.resolve(n),a()):t.repeat=!0},500)})}},{key:"pause",value:function(){var e=this;return this._deferredAction(function(){e._playing=!1,e.video.pauseVideo()})}},{key:"isPaused",value:function(){var e=this;return this._deferredAction(function(){return!e._playing})}},{key:"duration",value:function(){var e=this;return this._deferredAction(function(){return e.video.getDuration()})}},{key:"setCurrentTime",value:function(e){var t=this;return this._deferredAction(function(){t.video.seekTo(e)})}},{key:"currentTime",value:function(){var e=this;return this._deferredAction(function(){return e.video.getCurrentTime()})}},{key:"setVolume",value:function(e){var t=this;return this._deferredAction(function(){t.video.setVolume&&t.video.setVolume(100*e)})}},{key:"volume",value:function(){var e=this;return this._deferredAction(function(){return e.video.getVolume()/100})}},{key:"setPlaybackRate",value:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})}},{key:"playbackRate",value:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})}},{key:"goFullScreen",value:function(){var e=this;return this._deferredAction(function(){var t=e.video;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitEnterFullscreen&&t.webkitEnterFullscreen()})}},{key:"unFreeze",value:function(){var e=this;return this._deferredAction(function(){var t=document.getElementById(e.video.className+"canvas");$(t).remove()})}},{key:"freeze",value:function(){var e=this;return this._deferredAction(function(){var t=document.createElement("canvas");t.id=e.video.className+"canvas",t.width=e.video.videoWidth,t.height=e.video.videoHeight,t.style.cssText=e.video.style.cssText,t.style.zIndex=2,t.getContext("2d").drawImage(e.video,0,0,16*Math.ceil(t.width/16),16*Math.ceil(t.height/16)),e.video.parentElement.appendChild(t)})}},{key:"unload",value:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}},{key:"getDimensions",value:function(){return paella_DeferredNotImplemented()}},{key:"video",get:function(){return this._youtubePlayer}}]),t}();paella.YoutubeVideo=e;var t=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.VideoFactory),_createClass(t,[{key:"initYoutubeApi",value:function(){if(!this._initialized){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),paella.youtubePlayerVars={apiReadyPromise:new $.Deferred},this._initialized=!0}}},{key:"isStreamCompatible",value:function(e){try{for(var t in e.sources)if("youtube"==t)return!0}catch(e){}return!1}},{key:"getVideoObject",value:function(e,t,a){return this.initYoutubeApi(),new paella.YoutubeVideo(e,t,a.x,a.y,a.w,a.h)}}]),t}();paella.videoFactories.YoutubeVideoFactory=t}(),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.EventDrivenPlugin),_createClass(t,[{key:"getIndex",value:function(){return 20}},{key:"getAlignment",value:function(){return"right"}},{key:"getSubclass",value:function(){return"zoomButton"}},{key:"getDefaultToolTip",value:function(){return base.dictionary.translate("Zoom")}},{key:"getEvents",value:function(){return[paella.events.timeUpdate,paella.events.setComposition,paella.events.loadPlugins,paella.events.play]}},{key:"onEvent",value:function(e,t){switch(e){case paella.events.timeUpdate:this.imageUpdate(e,t);break;case paella.events.setComposition:this.compositionChanged(e,t);break;case paella.events.loadPlugins:this.loadPlugin(e,t);break;case paella.events.play:this.exitPhotoMode()}}},{key:"checkEnabled",value:function(e){if(paella.player.videoContainer.sourceData.length<2)return this._zImages=null,this._imageNumber=null,this._isActivated=!1,this._isCreated=!1,this._keys=null,this._ant=null,this._next=null,this._videoLength=null,this._compChanged=!1,this._restartPlugin=!1,this._actualImage=null,this._zoomIncr=null,this._maxZoom=null,this._minZoom=null,this._dragMode=!1,this._mouseDownPosition=null,void e(!1);paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image")?e(!0):e(!1)}},{key:"setupIcons",value:function(){var e=this,t=$(".zoomFrame").width(),a=document.createElement("div");a.className="arrowsLeft",a.style.display="none";var n=document.createElement("div");n.className="arrowsRight",n.style.display="none",n.style.left=t-24+"px",$(a).click(function(){e.arrowCallLeft(),event.stopPropagation()}),$(n).click(function(){e.arrowCallRight(),event.stopPropagation()});var i=document.createElement("div");i.className="iconsFrame";var r=document.createElement("button");r.className="zoomActionButton buttonZoomIn",r.style.display="none";var o=document.createElement("button");o.className="zoomActionButton buttonZoomOut",o.style.display="none";var l=document.createElement("button");l.className="zoomActionButton buttonSnapshot",l.style.display="none";var s=document.createElement("button");s.className="zoomActionButton buttonZoomOn",$(i).append(s),$(i).append(l),$(i).append(r),$(i).append(o),$(".newframe").append(i),$(".newframe").append(a),$(".newframe").append(n),$(s).click(function(){e._isActivated?(e.exitPhotoMode(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")):(e.enterPhotoMode(),$(".zoomActionButton.buttonZoomOn").addClass("clicked")),event.stopPropagation()}),$(l).click(function(){null!=e._actualImage&&window.open(e._actualImage,"_blank"),event.stopPropagation()}),$(r).click(function(){e.zoomIn(),event.stopPropagation()}),$(o).click(function(){e.zoomOut(),event.stopPropagation()})}},{key:"enterPhotoMode",value:function(){$(".zoomFrame").show(),$(".zoomFrame").css("opacity","1"),this._isActivated=!0,$(".buttonSnapshot").show(),$(".buttonZoomOut").show(),$(".buttonZoomIn").show(),$(".arrowsRight").show(),$(".arrowsLeft").show(),paella.player.pause(),this._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),this._imageNumber>=this._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}},{key:"exitPhotoMode",value:function(){$(".zoomFrame").hide(),this._isActivated=!1,$(".buttonSnapshot").hide(),$(".buttonZoomOut").hide(),$(".buttonZoomIn").hide(),$(".arrowsRight").hide(),$(".arrowsLeft").hide(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")}},{key:"setup",value:function(){this._maxZoom=this.config.maxZoom||500,this._minZoom=this.config.minZoom||100,this._zoomIncr=this.config.zoomIncr||10,this._zImages={},this._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,this._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,this._keys=Object.keys(this._zImages),this._keys=this._keys.sort(function(e,t){return e=e.slice(6),t=t.slice(6),parseInt(e)-parseInt(t)}),this._next=0,this._ant=0}},{key:"loadPlugin",value:function(){0==this._isCreated&&(this.createOverlay(),this.setupIcons(),$(".zoomFrame").hide(),this._isActivated=!1,this._isCreated=!0)}},{key:"imageUpdate",value:function(e,t){var a=Math.round(t.currentTime),n=$(".zoomFrame").css("background-image");if($(".newframe").length>0){if(this._zImages.hasOwnProperty("frame_"+a)){if(n==this._zImages["frame_"+a])return;n=this._zImages["frame_"+a]}else{if(!(a>this._next||a<this._ant||this._compChanged))return;this._compChanged&&(this._compChanged=!1),n=this.returnSrc(a)}$("#photo_01").attr("src",n).load();var i=new Image;i.onload=function(){$(".zoomFrame").css("background-image","url("+n+")")},i.src=n,this._actualImage=n,this._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),this._imageNumber>=this._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}}},{key:"returnSrc",value:function(e){var t=0;for(i=0;i<this._keys.length;i++){var a=parseInt(this._keys[i].slice(6)),n=parseInt(this._keys[this._keys.length-1].slice(6));if(e<a)return this._next=a,this._ant=t,this._imageNumber=i-1,this._zImages["frame_"+t];if(e>n&&e<this._videoLength)return this._next=this._videoLength,this._ant=n,this._zImages["frame_"+t];t=a}}},{key:"arrowCallLeft",value:function(){if(this._imageNumber-1>=0){var e=this._keys[this._imageNumber-1];this._imageNumber-=1,paella.player.videoContainer.seekToTime(parseInt(e.slice(6)))}}},{key:"arrowCallRight",value:function(){if(this._imageNumber+1<=this._keys.length){var e=this._keys[this._imageNumber+1];this._imageNumber+=1,paella.player.videoContainer.seekToTime(parseInt(e.slice(6)))}}},{key:"createOverlay",value:function(){var e=this,t=document.createElement("div");t.className="newframe",overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(t,overlayContainer.getVideoRect(0));var a=document.createElement("div");a.className="zoomFrame",t.insertBefore(a,t.firstChild),$(a).click(function(e){e.stopPropagation()}),$(a).bind("mousewheel",function(t){t.originalEvent.wheelDelta/120>0?e.zoomIn():e.zoomOut()}),$(a).mousedown(function(t){e.mouseDown(t.clientX,t.clientY)}),$(a).mouseup(function(t){e.mouseUp()}),$(a).mouseleave(function(t){e.mouseLeave()}),$(a).mousemove(function(t){e.mouseMove(t.clientX,t.clientY)})}},{key:"mouseDown",value:function(e,t){this._dragMode=!0,this._mouseDownPosition={x:e,y:t}}},{key:"mouseUp",value:function(){this._dragMode=!1}},{key:"mouseLeave",value:function(){this._dragMode=!1}},{key:"mouseMove",value:function(e,t){if(this._dragMode){$(".zoomFrame")[0];var a=this._backgroundPosition?this._backgroundPosition:{left:0,top:0},n=($(".zoomFrame").width(),$(".zoomFrame").height(),this._mouseDownPosition.x-e),i=this._mouseDownPosition.y-t,r=a.left+n,o=a.top+i;r=(r=r>=0?r:0)<=100?r:100,o=(o=o>=0?o:0)<=100?o:100,$(".zoomFrame").css("background-position",r+"% "+o+"%"),this._backgroundPosition={left:r,top:o},this._mouseDownPosition.x=e,this._mouseDownPosition.y=t}}},{key:"zoomIn",value:function(){var e=$(".zoomFrame").css("background-size");e=e.split(" "),(e=parseInt(e[0]))<this._maxZoom&&$(".zoomFrame").css("background-size",e+this._zoomIncr+"% auto")}},{key:"zoomOut",value:function(){var e=$(".zoomFrame").css("background-size");e=e.split(" "),(e=parseInt(e[0]))>this._minZoom&&$(".zoomFrame").css("background-size",e-this._zoomIncr+"% auto")}},{key:"imageUpdateOnPause",value:function(e){var t=Math.round(e),a=$(".zoomFrame").css("background-image");if($(".newframe").length>0&&a!=this._actualImage){if(this._zImages.hasOwnProperty("frame_"+t)){if(a==this._zImages["frame_"+t])return;a=this._zImages["frame_"+t]}else this._compChanged=!1,a=this.returnSrc(t);$("#photo_01").attr("src",a).load();var n=new Image;n.onload=function(){$(".zoomFrame").css("background-image","url("+a+")")},n.src=a,this._actualImage=a}}},{key:"compositionChanged",value:function(e,t){var a=this;$(".newframe").remove(),this._isCreated=!1,paella.player.videoContainer.getMasterVideoRect().visible&&(this.loadPlugin(),paella.player.paused()&&paella.player.videoContainer.currentTime().then(function(e){a.imageUpdateOnPause(e)})),this._compChanged=!0}},{key:"getName",value:function(){return"es.upv.paella.zoomPlugin"}}]),t}()}),paella.addPlugin(function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,paella.userTracking.SaverPlugIn),_createClass(t,[{key:"getName",value:function(){return"org.opencast.usertracking.MatomoSaverPlugIn"}},{key:"checkEnabled",value:function(e){var t=this.config.site_id,a=this.config.server,n=this.config.heartbeat,i=this;a&&t?("/"!=a.substr(-1)&&(a+="/"),require([a+"piwik.js"],function(e){base.log.debug("Matomo Analytics Enabled"),paella.userTracking.matomotracker=Piwik.getAsyncTracker(a+"piwik.php",t),paella.userTracking.matomotracker.client_id=i.config.client_id,n&&n>0&&paella.userTracking.matomotracker.enableHeartBeatTimer(n),Piwik&&Piwik.MediaAnalytics&&paella.events.bind(paella.events.videoReady,function(){Piwik.MediaAnalytics.scanForMedia()}),i.registerVisit()}),e(!0)):(base.log.debug("No Matomo Site ID found in config file. Disabling Matomo Analytics PlugIn"),e(!1))}},{key:"registerVisit",value:function(){var e,t,a,n,i;paella.opencast&&paella.opencast._episode?(e=paella.opencast._episode.dcTitle,t=paella.opencast._episode.id,i=paella.opencast._episode.dcCreator,paella.userTracking.matomotracker.setCustomVariable(5,"client",paella.userTracking.matomotracker.client_id||"Paella Opencast")):paella.userTracking.matomotracker.setCustomVariable(5,"client",paella.userTracking.matomotracker.client_id||"Paella Standalone"),paella.opencast&&paella.opencast._episode&&paella.opencast._episode.mediapackage&&(n=paella.opencast._episode.mediapackage.series,a=paella.opencast._episode.mediapackage.seriestitle),e&&paella.userTracking.matomotracker.setCustomVariable(1,"event",e+" ("+t+")","page"),a&&paella.userTracking.matomotracker.setCustomVariable(2,"series",a+" ("+n+")","page"),i&&paella.userTracking.matomotracker.setCustomVariable(3,"presenter",i,"page"),paella.userTracking.matomotracker.setCustomVariable(4,"view_mode",void 0,"page"),e&&i?(paella.userTracking.matomotracker.setDocumentTitle(e+" - "+(i||"Unknown")),paella.userTracking.matomotracker.trackPageView(e+" - "+(i||"Unknown"))):paella.userTracking.matomotracker.trackPageView()}},{key:"log",value:function(e,t){if(void 0!==paella.userTracking.matomotracker){if(void 0===this.config.category||!0===this.config.category){var a="";try{a=JSON.stringify(t)}catch(e){}switch(e){case paella.events.play:paella.userTracking.matomotracker.trackEvent("Player.Controls","Play");break;case paella.events.pause:paella.userTracking.matomotracker.trackEvent("Player.Controls","Pause");break;case paella.events.endVideo:paella.userTracking.matomotracker.trackEvent("Player.Status","Ended");break;case paella.events.showEditor:paella.userTracking.matomotracker.trackEvent("Player.Editor","Show");break;case paella.events.hideEditor:paella.userTracking.matomotracker.trackEvent("Player.Editor","Hide");break;case paella.events.enterFullscreen:paella.userTracking.matomotracker.trackEvent("Player.View","Fullscreen");break;case paella.events.exitFullscreen:paella.userTracking.matomotracker.trackEvent("Player.View","ExitFullscreen");break;case paella.events.loadComplete:paella.userTracking.matomotracker.trackEvent("Player.Status","LoadComplete");break;case paella.events.showPopUp:paella.userTracking.matomotracker.trackEvent("Player.PopUp","Show",a);break;case paella.events.hidePopUp:paella.userTracking.matomotracker.trackEvent("Player.PopUp","Hide",a);break;case paella.events.captionsEnabled:paella.userTracking.matomotracker.trackEvent("Player.Captions","Enabled",a);break;case paella.events.captionsDisabled:paella.userTracking.matomotracker.trackEvent("Player.Captions","Disabled",a);break;case paella.events.setProfile:paella.userTracking.matomotracker.trackEvent("Player.View","Profile",a);break;case paella.events.seekTo:case paella.events.seekToTime:paella.userTracking.matomotracker.trackEvent("Player.Controls","Seek",a);break;case paella.events.setVolume:paella.userTracking.matomotracker.trackEvent("Player.Settings","Volume",a);break;case paella.events.resize:paella.userTracking.matomotracker.trackEvent("Player.View","resize",a);break;case paella.events.setPlaybackRate:paella.userTracking.matomotracker.trackEvent("Player.Controls","PlaybackRate",a)}}}else base.log.debug("Matomo Tracker is missing")}}]),t}()});